var jscv={};jscv.coredt={},jscv.utility={},jscv.math={},jscv.imgproc={},jscv.cv={},jscv.geometry={},jscv.coredt.Type=function(){function a(a,b,c,d,e){return this.typeName=a,this.byteLength=b,this.isFloat=c,this.isSignedInt=d,this.isUnsignedInt=e,this}function b(){return"[Type "+this.typeName+"]"}return a.prototype={toString:b},a}(),jscv.uint8=new jscv.coredt.Type("uint8",1,!1,!1,!0),jscv.uint8Clamped=new jscv.coredt.Type("uint8Clamped",1,!1,!1,!0),jscv.uint16=new jscv.coredt.Type("uint16",2,!1,!1,!0),jscv.uint32=new jscv.coredt.Type("uint32",4,!1,!1,!0),jscv.int8=new jscv.coredt.Type("int8",1,!1,!0,!1),jscv.int16=new jscv.coredt.Type("int16",2,!1,!0,!1),jscv.int32=new jscv.coredt.Type("int32",4,!1,!0,!1),jscv.float32=new jscv.coredt.Type("float32",4,!0,!1,!1),jscv.float64=new jscv.coredt.Type("float64",8,!0,!1,!1),jscv.SUPPORT_DATA_TYPE=[jscv.uint8,jscv.uint8Clamped,jscv.uint16,jscv.uint32,jscv.int8,jscv.int16,jscv.int32,jscv.float32,jscv.float64],jscv.FLOAT_TYPE=[jscv.float32,jscv.float64],jscv.UNSIGNED_INT_TYPE=[jscv.uint8,jscv.uint8Clamped,jscv.uint16,jscv.uint32],jscv.SIGNED_INT_TYPE=[jscv.int8,jscv.int16,jscv.int32],jscv.utility.canUseTypedObject=function(){return"undefined"!=typeof TypedObject},jscv.COLOR_GRAY=0,jscv.COLOR_RGBA=1,jscv.COLOR_HSV=2,jscv.COLOR_HLS=3,jscv.COLOR_CIEXYZ=4,jscv.SUPPORT_COLOR_MODE=[jscv.COLOR_GRAY,jscv.COLOR_RGBA,jscv.COLOR_HSV,jscv.COLOR_HLS,jscv.COLOR_CIEXYZ],jscv.MAP_COLOR_MODE_TO_NCHANNEL=[],jscv.MAP_COLOR_MODE_TO_NCHANNEL[jscv.COLOR_GRAY]=1,jscv.MAP_COLOR_MODE_TO_NCHANNEL[jscv.COLOR_RGBA]=4,jscv.MAP_COLOR_MODE_TO_NCHANNEL[jscv.COLOR_HSV]=3,jscv.MAP_COLOR_MODE_TO_NCHANNEL[jscv.COLOR_HLS]=3,jscv.MAP_COLOR_MODE_TO_NCHANNEL[jscv.COLOR_CIEXYZ]=3,jscv.MAP_COLOR_MODE_TO_NAME=[],jscv.MAP_COLOR_MODE_TO_NAME[jscv.COLOR_GRAY]="GRAYSCALE",jscv.MAP_COLOR_MODE_TO_NAME[jscv.COLOR_RGBA]="RGBA",jscv.MAP_COLOR_MODE_TO_NAME[jscv.COLOR_HSV]="HSV",jscv.MAP_COLOR_MODE_TO_NAME[jscv.COLOR_HLS]="HLS",jscv.MAP_COLOR_MODE_TO_NAME[jscv.COLOR_CIEXYZ]="CIE XYZ",jscv.MAP_COLOR_MODE_TO_DATA_TYPE=[],jscv.MAP_COLOR_MODE_TO_DATA_TYPE[jscv.COLOR_GRAY]=jscv.uint8Clamped,jscv.MAP_COLOR_MODE_TO_DATA_TYPE[jscv.COLOR_RGBA]=jscv.uint8Clamped,jscv.MAP_COLOR_MODE_TO_DATA_TYPE[jscv.COLOR_HSV]=jscv.float64,jscv.MAP_COLOR_MODE_TO_DATA_TYPE[jscv.COLOR_HLS]=jscv.float64,jscv.MAP_COLOR_MODE_TO_DATA_TYPE[jscv.COLOR_CIEXYZ]=jscv.float64,jscv.THRESH_BINARY="0",jscv.THRESH_BINARY_INV="1",jscv.THRESH_TRUNC="2",jscv.THRESH_TOZERO="3",jscv.THRESH_TOZERO_INV="4",jscv.SUPPORT_THRESH_TYPE=[jscv.THRESH_BINARY,jscv.THRESH_BINARY_INV,jscv.THRESH_TRUNC,jscv.THRESH_TOZERO,jscv.THRESH_TOZERO_INV],jscv.USE_OTSU={otsu:!0},jscv.ADAPTIVE_THRESH_MEAN={mean:!0},jscv.ADAPTIVE_THRESH_GAUSSIAN={gauss:!0},jscv.SUPPORT_ADAPTIVE_METHOD=[jscv.ADAPTIVE_THRESH_MEAN,jscv.ADAPTIVE_THRESH_GAUSSIAN],jscv.FREEMAN_CHAIN_CODE=0,jscv.CHAIN_APPROX_SIMPLE=1,jscv.RETRIEVE_OUTMOST=0,jscv.RETRIEVE_TREE=1,jscv.MATCH_SHAPE_I1=0,jscv.MATCH_SHAPE_I2=1,jscv.MATCH_SHAPE_I3=2,jscv.SUPPORT_MATCH_SHAPE=[jscv.MATCH_SHAPE_I1,jscv.MATCH_SHAPE_I2,jscv.MATCH_SHAPE_I3],jscv.DEFAULT_ZERO_THRESHOLD_FLOAT64=1e-10,jscv.DEFAULT_ZERO_THRESHOLD_FLOAT32=1e-6,jscv.BORDER_CONSTANT="0",jscv.BORDER_REPLICATE="1",jscv.BORDER_WRAP="2",jscv.BORDER_REFLECT="3",jscv.BORDER_REFLECT_101="4",jscv.SUPPORT_BORDER_TYPE=[jscv.BORDER_CONSTANT,jscv.BORDER_REPLICATE,jscv.BORDER_WRAP,jscv.BORDER_REFLECT,jscv.BORDER_REFLECT_101],jscv.GAUSS_METHOD={gauss_elim:!0},jscv.LU_METHOD={lu:!0},jscv.GENERAL_MAT="0",jscv.LOWER_TRAPEZOIDAL_MAT="1",jscv.UPPER_TRAPEZOIDAL_MAT="2",jscv.SYMMETRIC_MAT="3",jscv.POSITIVE_DEFINITE_MAT="4",jscv.DEFAULT_PIXEL_DISTANCE_STEP_HOUGH=1,jscv.DEFAULT_DEGREE_ANGLE_STEP_HOUGH=1,jscv.DEFAULT_THRESHOLD_HOUGH=50,jscv.FOUR_CONNECTED="4",jscv.EIGHT_CONNECTED="8",jscv.SUPPORT_CONNECTIVITY_TYPE=[jscv.FOUR_CONNECTED,jscv.EIGHT_CONNECTED],jscv.FLOODFILL_COMPARE_SEED={seed:!0},jscv.FLOODFILL_COMPARE_NEIGHBOR={neighbor:!0},jscv.X_DIRECTION=0,jscv.Y_DIRECTION=1,jscv.OPTICAL_FLOW_USE_MIN_EIGVALUE=!0,jscv.OPTICAL_FLOW_LK_DEFAULT_WINDOW_SIZE=[21,21],jscv.OPTICAL_FLOW_LK_DEFAULT_MAX_NUM_PYRAMID_LEVEL=3,jscv.OPTICAL_FLOW_LK_DEFAULT_MAX_NUM_ITERATION=30,jscv.OPTICAL_FLOW_LK_DEFAULT_STOP_EPSILON=.01,jscv.OPTICAL_FLOW_LK_DEFAULT_MIN_EIGEN_THRESHOLD=.04,jscv.USE_JS_ARRAY_FLAG_=!1,jscv.utility.canUseTypedObject()||(jscv.USE_JS_ARRAY_FLAG_=!0),jscv.MIN_MATRIX_SIZE_FOR_PARALLEL=500,jscv.ENFORCE_PARALLEL_INT_=0,jscv.ENFORCE_SEQUENTIAL_INT_=1,jscv.NO_ENFORCE_INT_=2,jscv.RunConfig_=function(){function a(a){return this.mode=a,this}return a}(),jscv.ENFORCE_PARALLEL=new jscv.RunConfig_(jscv.ENFORCE_PARALLEL_INT_),jscv.ENFORCE_SEQUENTIAL=new jscv.RunConfig_(jscv.ENFORCE_SEQUENTIAL_INT_),jscv.NO_ENFORCE=new jscv.RunConfig_(jscv.NO_ENFORCE_INT_),jscv.DEFAULT_ENFORCE_MODE=jscv.ENFORCE_SEQUENTIAL,jscv.GLOBAL_ENFORCE_MODE=jscv.NO_ENFORCE,jscv.DISPATCH_DEBUG_ON=!1,jscv.utility.processUserConfig_=function(a){return jscv.USE_JS_ARRAY_FLAG_?jscv.ENFORCE_SEQUENTIAL:jscv.GLOBAL_ENFORCE_MODE.mode!=jscv.NO_ENFORCE_INT_?jscv.GLOBAL_ENFORCE_MODE:a instanceof jscv.RunConfig_?a.mode==jscv.ENFORCE_SEQUENTIAL_INT_?jscv.ENFORCE_SEQUENTIAL:a.mode==jscv.ENFORCE_PARALLEL_INT_?jscv.ENFORCE_PARALLEL:jscv.NO_ENFORCE:jscv.DEFAULT_ENFORCE_MODE},jscv.cv.briskFeatureDetect=function(){var a=arguments.length,b=arguments[0],c=30,d=4,e=void 0,f=0;if(arguments[a-1]instanceof jscv.RunConfig_&&(e=arguments[a-1],f=1),a>=2+f&&(c=arguments[1]),a>=3+f&&(d=arguments[2]),b.colorMode!=jscv.COLOR_GRAY)throw"brisk feature detection available for grayscale images only";var g=jscv.utility.processUserConfig_(e);return g==jscv.ENFORCE_SEQUENTIAL?jscv.cv.briskFeatureDetectSeq_(b,c,d):g==jscv.ENFORCE_PARALLEL?jscv.cv.briskFeatureDetectPar_(b,c,d):jscv.cv.briskFeatureDetectPar_(b,c,d)},jscv.cv.briskFeatureDetectPar_=function(a,b,c){var d=jscv.ENFORCE_PARALLEL,e=jscv.imgproc.buildPyramid(a,c,d);jscv.cv.briskFeatureDetect.insertPyramidIntraoctaves_(e,d);for(var f=new Array,g=0;g<e.length;g++){var h=e[g];f.push(jscv.cv.fastCornerDetect(h,b,!0,d))}var i=jscv.cv.briskFeatureDetect.calculateGradient_(e,f,d);return jscv.cv.briskFeatureDetect.suppressPyramidKeypoints_(i,d),refinedPyramidKeypoints},jscv.cv.briskFeatureDetectSeq_=function(a,b,c){var d=jscv.ENFORCE_SEQUENTIAL,e=jscv.imgproc.buildPyramid(a,c,d);jscv.cv.briskFeatureDetect.insertPyramidIntraoctaves_(e,d);for(var f=new Array,g=0;g<e.length;g++){var h=e[g];f.push(jscv.cv.fastCornerDetect(h,b,!0,d))}var i=jscv.cv.briskFeatureDetect.calculateGradient_(e,f,d),j=jscv.cv.briskFeatureDetect.suppressPyramidKeypoints_(i,d);return j},jscv.cv.briskFeatureDetect.insertPyramidIntraoctaves_=function(a,b){for(var c=a.length,d=1;c>d;d++){var e=a[c-d-1],f=new jscv.coredt.Image(Math.floor(2*e.width/3),Math.floor(2*e.height/3),e.elementalType,e.colorMode);jscv.imgproc.resizeFit(e,f,b),a.splice(c-d,0,f)}},jscv.cv.briskFeatureDetect.suppressPyramidKeypoints_=function(a){for(var b=new Array,c=3,d=0;d<a.length;d++){var e=Math.pow(2,Math.floor(d/2)),f=1;1==d%2&&(intralVal=1.5);for(var g=c*e*f,h=a[d],i=e*(f+.5),j=0;j<h.length;j++){currentPoint=h[j];var k;if(d<a.length-1)for(var l=a[d+1],m=0;m<l.length;m++)if(currentUpperPoint=l[m],Math.abs(3*currentUpperPoint[0].x/2-currentPoint[0].x)<=1&&Math.abs(3*currentUpperPoint[0].y/2-currentPoint[0].y)<=1&&currentUpperPoint[1]==currentPoint[1]){k=currentUpperPoint;break}var n;if(d>0)for(var o=a[d-1],m=0;m<o.length;m++)if(currentLowerPoint=o[m],Math.abs(currentLowerPoint[0].x-3*currentPoint[0].x/2)<=1&&Math.abs(currentLowerPoint[0].y-3*currentPoint[0].y/2)<=1&&currentLowerPoint[1]==currentPoint[1]){n=currentLowerPoint;break}var p=!1,q=!1;if("undefined"==typeof k?p=!0:currentPoint[2]>k[2]&&(p=!0),"undefined"==typeof n?q=!0:currentPoint[2]>n[2]&&(q=!0),p&&q){if(d>0)var r=new jscv.coredt.Circle(Math.floor((currentPoint[0].x+.5)*i-1),Math.floor((currentPoint[0].y+.5)*i-1),g);else var r=new jscv.coredt.Circle(currentPoint[0].x,currentPoint[0].y,g);1==f&&b.push([r,currentPoint[1]])}}}return b},jscv.cv.briskFeatureDetect.calculateGradient_=function(a,b){for(var c=0,d=1,e=2,f=3,g=Math.tan(Math.PI/8),h=Math.tan(3*Math.PI/8),i=function(a){return a>0?1:0>a?-1:0},j=new Array,k=0;k<a.length;k++){currentLayer=a[k];for(var l=jscv.imgproc.sobel(currentLayer,jscv.X_DIRECTION),m=jscv.imgproc.sobel(currentLayer,jscv.Y_DIRECTION),n=new Array,o=0;o<b[k].length;o++){currentScoredPoint=b[k][o],currentPoint=currentScoredPoint[0];var p,q=l.data.get(currentPoint.y,currentPoint.x),r=m.data.get(currentPoint.y,currentPoint.x);p=Math.abs(r)<Math.abs(q)*g?c:Math.abs(r)>Math.abs(q)*h?e:i(r)==i(q)?d:f,n.push([currentScoredPoint[0],p,currentScoredPoint[1]])}j.push(n)}return j},jscv.cv.CLOCKWISE_DIRECTION_OFFSET=[[-1,0],[-1,1],[0,1],[1,1],[1,0],[1,-1],[0,-1],[-1,-1]],jscv.cv.findContours=function(a,b){void 0==b&&(b=jscv.CHAIN_APPROX_SIMPLE);for(var c=new jscv.coredt.Matrix(a.data.shape,jscv.int32),d=c.data.length,e=a.data,f=0;d>f;f++)e.data[f]&&(c.data[f]=1);var g=function(a,b){return a.contour.isHole?b.contour.isHole?b.parentId:b.id:b.contour.isHole?b.id:b.parentId},h=new Array,i=new jscv.coredt.Contour(new jscv.coredt.Point(-1,-1),b,!0);h.push(new jscv.coredt.ContourNode(0,0,i));for(var j=1,k=0,l=0;l<c.nRow;l++)for(var m=1,n=0;n<c.nCol;n++){if(c.data[k]){var o=!1,p=!1;if(1==c.data[k]&&n-1>=0&&0==c.data[k-1]?(p=!1,o=!0):c.data[k]>=1&&n+1<c.nCol&&0==c.data[k+1]&&(p=!0,o=!0,c.data[k]>1&&(m=c.data[k])),o){j++;var q=new jscv.coredt.ContourNode(j-1,new jscv.coredt.Contour(new jscv.coredt.Point(n,l),b,p));q.parentId=g(q,h[m-1]),h.push(q),h[q.parentId].neighborList.push(q.id),q.contour.seqData=jscv.cv.followContour_(c,[l,n],j,p,b)}1!=c.data[k]&&(m=Math.abs(c.data[k]))}k++}return h},jscv.cv.followContour_=function(a,b,c,d,e){void 0==e&&(e=jscv.CHAIN_APPROX_SIMPLE);var f,g,h,i,j,k,l,m,n=a.nRow,o=a.nCol,p=b[0],q=b[1];h=p,i=d?q+1:q-1;var r;r=new Array;var s=jscv.cv.list8Neighbors_([p,q],[h,i],[n,o],!0);f=-1,g=-1;for(var t=0;t<s.length;t++)if(a.data[s[t][0]*o+s[t][1]]){f=s[t][0],g=s[t][1];break}if(0>f)return a.data[p*o+q]=-c,e==jscv.CHAIN_APPROX_SIMPLE&&r.push(new jscv.coredt.Point(q,p)),r;for(h=f,i=g,j=p,k=q;;){s=jscv.cv.list8Neighbors_([j,k],[h,i],[n,o],!1),s.push(new Array(h,i));for(var u=-1,t=1;t<s.length;t++)if(a.data[s[t][0]*o+s[t][1]]){l=s[t][0],m=s[t][1],u=t;break}if(o>k+1&&0==a.data[j*o+k+1]){for(var v=!1,t=1;u>t;t++)if(s[t][0]==j&&s[t][1]==k+1){a.data[j*o+k]=-c,v=!0;break}v||1!=a.data[j*o+k]||(a.data[j*o+k]=c)}if(o>k+1&&a.data[j*o+k+1]&&1==a.data[j*o+k]&&(a.data[j*o+k]=c),e==jscv.CHAIN_APPROX_SIMPLE)r.push(new jscv.coredt.Point(k,j));else if(l!=p||m!=q){var w=jscv.cv.findDirection_([j,k],[l,m]);r.push(w)}if(l==p&&m==q&&j==f&&k==g)break;h=j,i=k,j=l,k=m}return r},jscv.cv.convertContourApprox=function(a,b){if(a.approxMethod==b)return new jscv.coredt.Contour(a);var c;if(a.approxMethod==jscv.FREEMAN_CHAIN_CODE&&b==jscv.CHAIN_APPROX_SIMPLE){c=new jscv.coredt.Contour(a.origin,jscv.CHAIN_APPROX_SIMPLE,a.isHole);var d=a.origin.y,e=a.origin.x;c.seqData.push(new jscv.coredt.Point(a.origin));for(var f=0;f<a.seqData.length;f++)d+=jscv.cv.CLOCKWISE_DIRECTION_OFFSET[a.seqData[f]][0],e+=jscv.cv.CLOCKWISE_DIRECTION_OFFSET[a.seqData[f]][1],c.seqData.push(new jscv.coredt.Point(e,d));return c}if(a.approxMethod==jscv.CHAIN_APPROX_SIMPLE&&b==jscv.FREEMAN_CHAIN_CODE){c=new jscv.coredt.Contour(a.origin,jscv.FREEMAN_CHAIN_CODE,a.isHole);for(var g,h,f=1;f<a.seqData.length;f++)g=[a.seqData[f-1].y,a.seqData[f-1].x],h=[a.seqData[f].y,a.seqData[f].x],c.seqData.push(jscv.cv.findDirection_(g,h));return c}throw new Error("No conversion available for the specified contour approximation method")},jscv.cv.list8Neighbors_=function(a,b,c,d){void 0==d&&(d=!0);var e=function(a,b){return a[0]<0||a[1]<0||a[0]>=b[0]||a[1]>=b[1]?!1:!0};if(!e(a,c)||!e(b,c))return[];var f=jscv.cv.findDirection_(a,b);if(0>f)return[];var g=new Array;g.push(new Array(b[0],b[1]));var h=d?1:-1,i=f+h;for(0>i&&(i=jscv.cv.CLOCKWISE_DIRECTION_OFFSET.length-1),i>=jscv.cv.CLOCKWISE_DIRECTION_OFFSET.length&&(i=0);i!=f;){var j=a[0]+jscv.cv.CLOCKWISE_DIRECTION_OFFSET[i][0],k=a[1]+jscv.cv.CLOCKWISE_DIRECTION_OFFSET[i][1];e([j,k],c)&&g.push(new Array(j,k)),i+=h,0>i&&(i=jscv.cv.CLOCKWISE_DIRECTION_OFFSET.length-1),i>=jscv.cv.CLOCKWISE_DIRECTION_OFFSET.length&&(i=0)}return g},jscv.cv.findDirection_=function(a,b){for(var c=b[0]-a[0],d=b[1]-a[1],e=0;e<jscv.cv.CLOCKWISE_DIRECTION_OFFSET.length;e++)if(jscv.cv.CLOCKWISE_DIRECTION_OFFSET[e][0]==c&&jscv.cv.CLOCKWISE_DIRECTION_OFFSET[e][1]==d)return e;return-1},jscv.cv.fastCornerDetect_={},jscv.cv.DELTA_CIRCLE=[[3,0],[3,1],[2,2],[1,3],[0,3],[-1,3],[-2,2],[-3,1],[-3,0],[-3,-1],[-2,-2],[-1,-3],[0,-3],[1,-3],[2,-2],[3,-1]],jscv.cv.fastCornerDetect_.deltaIndArray_=[],jscv.cv.fastCornerDetect=function(){var a=arguments.length,b=arguments[0],c=arguments[1],d=!1;if(b.width<=7||b.height<=7||b.colorMode!=jscv.COLOR_GRAY)return b;for(var e=jscv.cv.fastCornerDetect_.deltaIndArray_,f=0;f<jscv.cv.DELTA_CIRCLE.length;f++)e[f]=jscv.cv.DELTA_CIRCLE[f][1]*b.width+jscv.cv.DELTA_CIRCLE[f][0];var g=void 0;if(arguments[a-1]instanceof jscv.RunConfig_?(g=arguments[a-1],4==a&&(d=arguments[2])):3==a&&(d=arguments[2]),"boolean"!=typeof d)throw new Error("scoresFlag for whether to include FAST score of point must be a boolean");var h=jscv.utility.processUserConfig_(g);return h==jscv.ENFORCE_SEQUENTIAL?jscv.cv.fastCornerDetectSeq_(b,c,d):h==jscv.ENFORCE_PARALLEL?jscv.cv.fastCornerDetectPar_(b,c,d):jscv.cv.fastCornerDetectPar_(b,c,d)},jscv.cv.fastCornerDetectPar_=function(a,b,c){for(var d=new jscv.coredt.Matrix(a.height,a.width,jscv.uint32),e=d.getNdView(),f=new Array,g=jscv.cv.fastCornerDetect_.fourPointCheck_,h=jscv.cv.fastCornerDetect_.circumferenceCount_,i=function(c,d,e){var f=0;if(3>d||3>e||e>=a.width-3||d>=a.height-3)return f;var i=g(a,b,e,d);return i[0]>0&&(f=h(a,b,e,d,i[1])),f},j=e.mapPar(2,i),k=3;k<a.height-3;k++)for(var l=3;l<a.width-3;l++)j[k][l]>0&&f.push(new jscv.coredt.Point(l,k));for(var m=new Array,k=0;k<f.length;k++){for(var n=f[k],o=n.x,p=n.y,q=j[p][o],r=!0,s=Math.max(3,p-1);s<Math.min(p+1,d.height-3);s++)for(var t=Math.max(3,o-1);t<Math.min(o+1,d.width-3);t++)t!=o&&s!=p&&q<j[s][t]&&(r=!1);r&&(c?m.push([n,q]):m.push(n))}return m},jscv.cv.fastCornerDetectSeq_=function(a,b,c){for(var d=jscv.cv.fastCornerDetect_.fourPointCheck_,e=jscv.cv.fastCornerDetect_.circumferenceCount_,f=new jscv.coredt.Matrix(a.height,a.width,jscv.uint32),g=a.width,h=new Array,i=3*g+3,j=3;j<a.height-3;j++){for(var k=i,l=3;l<a.width-3;l++){var m=0,n=d(a,b,l,j);n[0]>0&&(m=e(a,b,l,j,n[1])),f.data[k]=m,m>0&&h.push(new jscv.coredt.Point(l,j)),k++}i+=g}for(var o=new Array,j=0;j<h.length;j++){var p=h[j],q=p.x,r=p.y,s=f.data[r*g+q],t=!0;i=Math.max(3,r-1)*g+Math.max(3,q-1);for(var u=Math.max(3,r-1);u<Math.min(r+1,f.nRow-3);u++){for(var k=i,v=Math.max(3,q-1);v<Math.min(q+1,f.nCol-3);v++)v!=q&&u!=r&&s<f.data[k]&&(t=!1),k++;i+=g}t&&(c?o.push([p,s]):o.push(p))}return o},jscv.cv.fastCornerDetect_.fourPointCheck_=function(a,b,c,d){for(var e=a.data.data,f=a.width,g=d*f+c,h=e[g],i=h-b,j=h+b,k=0,l=0,m=[0,0],n=-3*f-3,o=-3;3>=o;o+=6){for(var p=n,q=-3;3>=q;q+=6)e[g+p]<=i?l+=1:e[g+p]>=j&&(k+=1),p+=6;n+=6*f}return k>=3?(m[0]=1,m[1]=1):l>=3&&(m[0]=1,m[1]=-1),m},jscv.cv.fastCornerDetect_.circumferenceCount_=function(a,b,c,d,e){for(var f=a.data.data,g=a.data.nCol,h=f[d*g+c],i=h+b*e,j=d*g+c,k=new Array,l=jscv.cv.fastCornerDetect_.deltaIndArray_,m=0;16>m;m++){var n=f[j+l[m]];n*e>=i*e?k.push(Math.abs(h-n)):k.push(-1)}for(var m=0;15>m;m++)k.push(k[m]);for(var o=0,p=0,q=0,r=0,m=0;m<k.length;m++)if(-1!=k[m]){if(!(16>r)){o=p,q=r;break}r+=1,p+=k[m]}else r>q&&(q=r,o=p),r=0,p=0;return q>=12?o:0},jscv.cv.featureDetect_BRISK=function(){var a,b,c,d,e,f,g=50,h=2,i=1,j=.5,k=7;if(a=arguments[0],b=g,c=h,d=i,e=j,f=k,arguments.length>=2&&(b=arguments[1]),arguments.length>=3&&(c=arguments[2]),arguments.length>=4&&(d=arguments[3]),arguments.length>=5&&(e=arguments[4]),6==arguments.length&&(f=arguments[5]),a.colorMode!=jscv.COLOR_GRAY)throw"Feature detect available for grayscale images only";var l=Math.floor(c/e);if(3>l)throw"Invalid sigma range: scale space must be at least depth 3.";for(var m=new jscv.coredt.Matrix([l,a.height,a.width],a.colorMode,0),n=0;l>n;n++){var o=Math.pow(Math.E,d+n*e),p=new jscv.coredt.Matrix(f,f,1,jscv.float32,jscv.imgproc.laplacianOfGaussianKernel(f,o*o)),q=new jscv.coredt.Matrix(a.data);q=jscv.math.convolveMat(q,p);for(var r=0;r<a.height;r++)for(var s=0;s<a.width;s++)m.data[n][r][s]=q.data[r][s]}jscv.imgproc.resizeFitSequential},jscv.cv.featureCompare_BRISK=function(){},jscv.cv.featureDetect_BRISK.halfsample=function(a){for(var b=new jscv.coredt.Image(Math.ceil(a.width/2),Math.ceil(a.height/2),a.elementalType,a.colorMode),c=0;c<b.height;c++)for(var d=0;d<b.width;d++)b.data.data[c][d]=a.data.data[2*c][2*d];return b},jscv.cv.featureDetect_BRISK.gaussianBlurKernel=function(a,b){function c(a,b,c){var d=Math.pow(f,-((a*a+b*b)/(2*c))),e=1/(2*Math.PI*c)*d;return e}for(var d=[],e=0,f=2.7182818284,g=Math.floor(a/2),h=0;a>h;h++){d[h]=[];for(var i=0;a>i;i++){var j;j=h>g&&g>i?d[a-h-1][i]:g>h&&i>g?d[h][a-i-1]:h>g&&i>g?d[a-h-1][a-i-1]:c(h-g,i-g,b),d[h][i]=j,e+=j}}for(var i=0;a>i;i++)for(var h=0;a>h;h++){var j=d[h][i];d[h][i]=j/e}return d},jscv.cv.houghLineStandard=function(a,b,c,d,e){if(a.colorMode!=jscv.COLOR_GRAY)throw new Error("Input image is not grayscale. Only grayscale images are supported in jscv.cv.houghLineStandard");if((void 0==b||0>=b)&&(b=jscv.DEFAULT_PIXEL_DISTANCE_STEP_HOUGH),(void 0==c||0>=c)&&(c=jscv.DEFAULT_DEGREE_ANGLE_STEP_HOUGH),void 0==d&&(d=jscv.DEFAULT_THRESHOLD_HOUGH),void 0==e&&(e=-1),0==e)return[];for(var f=a.height,g=a.width,h=Math.sqrt(f*f+g*g),i=Math.ceil((h+h)/b)+1,j=Math.ceil(180/c)+1,k=new jscv.coredt.Matrix([j,i],jscv.uint32,0),l=new Float64Array(j),m=new Float64Array(j),n=0,o=0;j>o;o++)l[o]=Math.cos(n*Math.PI/180),m[o]=Math.sin(n*Math.PI/180),n+=c;for(var p=a.data.data,q=k.data,r=k.nCol,s=0,t=0;f>t;t++)for(var u=0;g>u;u++){if(p[s])for(var v=0;j>v;v++){var w=u*l[v]+t*m[v]+h;w/=b,w=Math.round(w),q[v*r+w]++}s++}for(var x=function(a,b,c,d){for(var e=0,f=-a.nCol,g=-1;1>=g;g++){for(var h=-1;1>=h;h++){var i=c+g,j=d+h;i>=0&&i<a.nRow&&j>=0&&j<a.nCol&&(e+=a.data[b+f+h])}f+=a.nCol}return e},y=new jscv.coredt.Matrix(k.shape,jscv.uint32),z=0,A=0;j>A;A++)for(var B=0;i>B;B++)y.data[z]=x(k,z,A,B),z++;var C=function(a,b,c,d){for(var e=-a.nCol,f=-1;1>=f;f++){for(var g=-1;1>=g;g++){var h=c+f,i=d+g;if(h>=0&&i>=0&&h<a.nRow&&i<a.nCol&&(h!=c||i!=d)&&a.data[b+e+g]>a.data[b])return!1}e+=a.nCol}return!0},D=[];z=0;for(var A=0;j>A;A++)for(var B=0;i>B;B++)q[z]>=d&&C(y,z,A,B)&&D.push([A,B,z]),z++;0>e&&(e=D.length);var E=Math.min(e,D.length);if(0==E)return[];E<D.length&&D.sort(function(a,b){return-(q[a[2]]-q[b[2]])});for(var F=[],z=0;E>z;z++){var v=D[z][0],w=D[z][1];w=w*b-h;var G=new jscv.coredt.Point,H=new jscv.coredt.Point;jscv.utility.isZero(l[v])?(G.x=-1,G.y=w/m[v],H.y=G.y,H.x=f+1):jscv.utility.isZero(m[v])?(G.x=w/l[v],H.x=G.x,G.y=-1,H.y=g+1):(G.x=0,G.y=w/m[v],H.y=0,H.x=w/l[v]),F.push(new jscv.coredt.Line(G,H))}return F},jscv.cv.laplace=function(a){var b=arguments.length,c=30,d=2,e=1,f=.5,g=7,h=0,i=void 0;if(arguments[b-1]instanceof jscv.RunConfig_&&(i=arguments[b-1],h=1),b>=2+h&&(c=arguments[1]),b>=3+h&&(d=arguments[2]),b>=4+h&&(e=arguments[3]),b>=5+h&&(f=arguments[4]),b==6+h&&(g=arguments[5]),a.colorMode!=jscv.COLOR_GRAY)throw new Error("Blob detect available for grayscale images only");var j=jscv.utility.processUserConfig_(i);return j==jscv.ENFORCE_SEQUENTIAL?jscv.cv.laplaceSeq_(a,c,d,e,f,g):j==jscv.ENFORCE_PARALLEL?jscv.cv.laplacePar_(a,c,d,e,f,g):jscv.cv.laplacePar_(a,c,d,e,f,g)},jscv.cv.laplacePar_=function(a,b,c,d,e,f){var g=Math.floor(c/e);if(3>g)throw new Error("Invalid sigma range: scale space must be at least depth 3");for(var h=jscv.BORDER_REPLICATE,i=new jscv.coredt.Matrix([g,a.height,a.width],a.colorMode,0),j=0;g>j;j++){var k=Math.pow(Math.E,d+j*e),l=new jscv.coredt.Matrix(f,f,1,jscv.float32,jscv.cv.laplacianOfGaussianKernel(f,k*k)),m=new jscv.coredt.Matrix(a.data);m=jscv.math.convolveMat(m,l,h,jscv.ENFORCE_PARALLEL);var n=function(a,b,c,d){return b!=j?a:m.data[c*m.nCol+d]};i.data=i.data.mapPar(3,n)}for(var o=function(a,c,d){for(var e=0,f=0,h=i.get(a,c,d),j=0,k=0,l=0,m=Math.max(a-1,0);m<Math.min(a+2,g);m++)for(var n=c-1;c+1>=n;n++)for(var o=d-1;d+1>=o;o++)if(n!=d||o!=c||m!=a){var p=i.get(m,n,o);if(e++,jscv.utility.isZero(j))j=h-p,0!=j&&(k=j/Math.abs(j),l=k*h);else{if(p*k>l)return-1;f+=Math.abs(h-i.get(m,n,o))}}return 0==f||b>f?-1:f/e},p=new Array,q=1.414,j=1;g-1>j;j++)for(var r=1;r<a.height-1;r++)for(var s=1;s<a.width-1;s++){var t=o(j,r,s);if(t>0){var k=Math.pow(Math.E,d+j*e),u=Math.floor(q*k);u>0&&p.push([[j,s,r,u,t]])}}for(var v=.05,w=function(a,b){new Array;for(var c=a.slice(),d=b.slice(),e=0;e<c.length;e++)for(var f=0;f<d.length;f++){var g=c[e],h=d[f],i=Math.sqrt(Math.pow(g[1]-h[1],2)+Math.pow(g[2]-h[2],2)),j=Math.PI*g[3]*g[3],k=Math.PI*h[3]*h[3],l=g[3]*g[3]*Math.acos((i*i+g[3]*g[3]-h[3]*h[3])/(2*i*g[3])),m=h[3]*h[3]*Math.acos((i*i+h[3]*h[3]-g[3]*g[3])/(2*i*h[3])),n=.5*Math.sqrt((-i+g[3]+h[3])*(i+g[3]-h[3])*(i-g[3]+h[3])*(i+g[3]+h[3])),o=l+m-n,p=o/Math.min(j,k);(p>=v||i<=Math.abs(g[3]-h[3]))&&(g[4]<h[4]?(c.splice(e,1),e-=1):(d.splice(f,1),f-=1))}return c.concat(d)},x=p.reducePar(w),y=new Array,r=0;r<x.length;r++)y.push(new jscv.coredt.Circle(x[r][1],x[r][2],x[r][3]));return y},jscv.cv.laplaceSeq_=function(a,b,c,d,e,f){var g=Math.floor(c/e);if(3>g)throw new Error("Invalid sigma range: scale space must be at least depth 3");for(var h=jscv.BORDER_REPLICATE,i=new jscv.coredt.Matrix([g,a.height,a.width],a.colorMode,0),j=0,k=0;g>k;k++){var l=Math.pow(Math.E,d+k*e),m=new jscv.coredt.Matrix(f,f,1,jscv.float32,jscv.cv.laplacianOfGaussianKernel(f,l*l)),n=new jscv.coredt.Matrix(a.data);n=jscv.math.convolveMat(n,m,h,jscv.ENFORCE_SEQUENTIAL);for(var o=0,p=0;p<a.height;p++)for(var q=0;q<a.width;q++)i.data[j]=n.data[o],j++,o++}for(var r=function(a,c,d){for(var e=0,f=0,h=i.get(a,c,d),j=0,k=0,l=0,m=Math.max(a-1,0);m<Math.min(a+2,g);m++)for(var n=c-1;c+1>=n;n++)for(var o=d-1;d+1>=o;o++)if(n!=d||o!=c||m!=a){var p=i.get(m,n,o);if(e++,0==j)j=h-p,0!=j&&(k=j/Math.abs(j),l=k*h);else{if(p*k>l)return-1;f+=Math.abs(h-i.get(m,n,o))}}return 0==f||b>f?-1:f/e},s=new Array,t=Math.sqrt(2),k=0;g>k;k++)for(var p=1;p<a.height-1;p++)for(var q=1;q<a.width-1;q++){var u=r(k,p,q);if(u>0){var l=Math.pow(Math.E,d+k*e),v=Math.floor(t*l);v>0&&s.push([k,q,p,v,u,!0])}}for(var w=.05,p=0;p<s.length;p++)for(var q=p+1;q<s.length;q++)if(p!=q&&0!=s[p][5]&&0!=s[q][5]){var x=s[p],y=s[q],z=Math.sqrt(Math.pow(x[1]-y[1],2)+Math.pow(x[2]-y[2],2)),A=Math.PI*x[3]*x[3],B=Math.PI*y[3]*y[3],C=x[3]*x[3]*Math.acos((z*z+x[3]*x[3]-y[3]*y[3])/(2*z*x[3])),D=y[3]*y[3]*Math.acos((z*z+y[3]*y[3]-x[3]*x[3])/(2*z*y[3])),E=.5*Math.sqrt((-z+x[3]+y[3])*(z+x[3]-y[3])*(z-x[3]+y[3])*(z+x[3]+y[3])),F=C+D-E,G=F/Math.min(A,B);(G>=w||z<=Math.abs(x[3]-y[3]))&&(x[4]<y[4]?x[5]=!1:y[5]=!1)}for(var H=new Array,I=new Array,p=0;p<s.length;p++)1==s[p][5]&&(I.push(s[p]),H.push(new jscv.coredt.Circle(s[p][1],s[p][2],s[p][3])));return H},jscv.cv.laplacianOfGaussianKernel=function(a,b){function c(a,b,c){var d=Math.pow(f,-((a*a+b*b)/(2*c))),e=1-(a*a+b*b)/(2*c),g=-1/(Math.PI*Math.pow(c,2))*e*d;return g}var d=[],e=0,f=2.7182818284,g=Math.sqrt(2*b);g>Math.floor(a/2)&&(a=Math.floor(2*g),0==a%2&&a++);for(var h=Math.floor(a/2),i=0;a>i;i++){d[i]=[];for(var j=0;a>j;j++){var k;k=i>h&&h>j?d[a-i-1][j]:h>i&&j>h?d[i][a-j-1]:i>h&&j>h?d[a-i-1][a-j-1]:c(i-h,j-h,b),d[i][j]=k,e+=k}}e=Math.abs(e);for(var j=0;a>j;j++)for(var i=0;a>i;i++){var k=d[i][j];d[i][j]=k/e}return d},jscv.cv.OPTICAL_FLOW_LK_CAN_TRACK_=1,jscv.cv.OPTICAL_FLOW_LK_CANNOT_TRACK_=0,jscv.cv.opticalFlowLKPyramid=function(a,b,c){if(a.colorMode!=jscv.COLOR_GRAY||b.colorMode!=jscv.COLOR_GRAY)throw new Error("Input images are not grayscale. Only grayscale images are supported in jscv.cv.opticalFLowLKPyramid");var d=jscv.OPTICAL_FLOW_LK_DEFAULT_WINDOW_SIZE,e=jscv.OPTICAL_FLOW_LK_DEFAULT_MAX_NUM_PYRAMID_LEVEL,f=jscv.OPTICAL_FLOW_LK_DEFAULT_MAX_NUM_ITERATION,g=jscv.OPTICAL_FLOW_LK_DEFAULT_STOP_EPSILON,h=!jscv.OPTICAL_FLOW_USE_MIN_EIGVALUE,i=jscv.OPTICAL_FLOW_LK_DEFAULT_MIN_EIGEN_THRESHOLD,j=3;arguments.length>j&&arguments[j]instanceof Array&&(d=arguments[j],j++),arguments.length>j&&"number"==typeof arguments[j]&&(e=arguments[j],j++),arguments.length>j&&"number"==typeof arguments[j]&&(f=arguments[j],j++),arguments.length>j&&"number"==typeof arguments[j]&&(g=arguments[j],j++),arguments.length>j&&"boolean"==typeof arguments[j]&&(h=arguments[j],j++),arguments.length>j&&"number"==typeof arguments[j]&&(i=arguments[j]),1&d[0]||d[0]++,1&d[1]||d[1]++;var k=10,l=void 0;arguments[arguments.length-1]instanceof jscv.RunConfig_&&(l=arguments[arguments.length-1]);var m=jscv.utility.processUserConfig_(l),n=jscv.imgproc.buildPyramid(a,e,d,jscv.BORDER_REPLICATE,l),o=jscv.imgproc.buildPyramid(b,e,d,jscv.BORDER_REPLICATE,l),p=Math.min(n.length,o.length),q=m;q==jscv.NO_ENFORCE&&(q=p>=k?jscv.ENFORCE_PARALLEL:jscv.ENFORCE_SEQUENTIAL);var r=[],s=[],t=d[0]>>1,u=d[1]>>1,v=[u,u,t,t];if(q==jscv.ENFORCE_SEQUENTIAL){for(var w=0;p>w;w++)r[w]=jscv.imgproc.scharr(n[w].data,jscv.X_DIRECTION,jscv.BORDER_REPLICATE,l),s[w]=jscv.imgproc.scharr(n[w].data,jscv.Y_DIRECTION,jscv.BORDER_REPLICATE,l);for(var w=0;p>w;w++)n[w]=jscv.utility.copyMakeBorder(n[w],v,jscv.BORDER_CONSTANT,0),o[w]=jscv.utility.copyMakeBorder(o[w],v,jscv.BORDER_CONSTANT,0),r[w]=jscv.utility.copyMakeBorder(r[w],v,jscv.BORDER_CONSTANT,0),s[w]=jscv.utility.copyMakeBorder(s[w],v,jscv.BORDER_CONSTANT,0)}else{for(var x=[],w=0;p>w;w++)x[w]=w;for(var y=x.mapPar(function(a){var b=jscv.imgproc.scharr(n[a].data,jscv.X_DIRECTION,jscv.BORDER_REPLICATE,l),c=jscv.imgproc.scharr(n[a].data,jscv.Y_DIRECTION,jscv.BORDER_REPLICATE,l);return[b,c]}),z=x.mapPar(function(a){var b=jscv.utility.copyMakeBorder(n[a],v,jscv.BORDER_CONSTANT,0),c=jscv.utility.copyMakeBorder(o[a],v,jscv.BORDER_CONSTANT,0),d=jscv.utility.copyMakeBorder(y[a][0],v,jscv.BORDER_CONSTANT,0),e=jscv.utility.copyMakeBorder(y[a][1],v,jscv.BORDER_CONSTANT,0);return[b,c,d,e]}),w=0;p>w;w++)n[w]=z[w][0],o[w]=z[w][1],r[w]=z[w][2],s[w]=z[w][3]}var A=c.length,B=m;B==jscv.NO_ENFORCE&&(B=A>=k?jscv.ENFORCE_PARALLEL:jscv.ENFORCE_SEQUENTIAL);var C=[b.width,b.height];return B==jscv.ENFORCE_PARALLEL?jscv.cv.opticalFlowLKPyramidPar_(n,o,r,s,c,C,d,f,g,h,i):jscv.cv.opticalFlowLKPyramidSeq_(n,o,r,s,c,C,d,f,g,h,i)},jscv.cv.opticalFlowLKPyramidSeq_=function(a,b,c,d,e,f,g,h,i,j,k){for(var l=g[0]>>1,m=g[1]>>1,n=Math.min(a.length,b.length),o=e.length,p=[],q=[],r=[],s=0;o>s;s++){for(var t=e[s].x/(1<<n),u=e[s].y/(1<<n),v=new jscv.coredt.Point(t,u),w=new jscv.coredt.Point(v),x=[],y=n-1;y>=0;y--)v.x*=2,v.y*=2,w.x*=2,w.y*=2,v.x+=l,v.y+=m,w.x+=l,w.y+=m,x=jscv.cv.trackPointLucasKanade_(a[y].data,c[y],d[y],v,b[y].data,w,g,h,i,j,k),v.x-=l,v.y-=m,w.x=x[0].x-l,w.y=x[0].y-m;var z=x[1],A=0;if((w.x<0||w.y<0||w.x>=f[0]||w.y>=f[1])&&(z=jscv.cv.OPTICAL_FLOW_LK_CANNOT_TRACK_),z==jscv.cv.OPTICAL_FLOW_LK_CAN_TRACK_)if(j==jscv.OPTICAL_FLOW_USE_MIN_EIGVALUE)A=x[2];else{v.x+=l,v.y+=m;var B=new jscv.coredt.Point;B.x=w.x+l,B.y=w.y+m;for(var C=-m;m>=C;C++)for(var D=-l;l>=D;D++){var E=jscv.cv.interpolate_(a[0].data,v.x+D,v.y+C)-jscv.cv.interpolate_(b[0].data,B.x+D,B.y+C);A+=Math.abs(E)}A/=g[0]*g[1]}p[s]=w,q[s]=z,r[s]=A}return[p,q,r]},jscv.cv.opticalFlowLKPyramidPar_=function(a,b,c,d,e,f,g,h,i,j,k){for(var l=g[0]>>1,m=g[1]>>1,n=Math.min(a.length,b.length),o=e.length,p=function(e){for(var o=e.x/(1<<n),p=e.y/(1<<n),q=new jscv.coredt.Point(o,p),r=new jscv.coredt.Point(q),s=[],t=n-1;t>=0;t--)q.x*=2,q.y*=2,r.x*=2,r.y*=2,q.x+=l,q.y+=m,r.x+=l,r.y+=m,s=jscv.cv.trackPointLucasKanade_(a[t].data,c[t],d[t],q,b[t].data,r,g,h,i,j,k),q.x-=l,q.y-=m,r.x=s[0].x-l,r.y=s[0].y-m;var u=s[1],v=0;if((r.x<0||r.y<0||r.x>=f[0]||r.y>=f[1])&&(u=jscv.cv.OPTICAL_FLOW_LK_CANNOT_TRACK_),u==jscv.cv.OPTICAL_FLOW_LK_CAN_TRACK_)if(j==jscv.OPTICAL_FLOW_USE_MIN_EIGVALUE)v=s[2];else{q.x+=l,q.y+=m;var w=new jscv.coredt.Point;w.x=r.x+l,w.y=r.y+m;for(var x=-m;m>=x;x++)for(var y=-l;l>=y;y++){var z=jscv.cv.interpolate_(a[0].data,q.x+y,q.y+x)-jscv.cv.interpolate_(b[0].data,w.x+y,w.y+x);v+=Math.abs(z)}v/=g[0]*g[1]}return[r,u,v]},q=e.mapPar(p),r=[],s=[],t=[],u=0;o>u;u++)r[u]=q[u][0],s[u]=q[u][1],t[u]=q[u][2];return[r,s,t]},jscv.cv.trackPointLucasKanade_=function(a,b,c,d,e,f,g,h,i,j){var k=d.x,l=d.y,m=f.x,n=f.y,o=g[1],p=g[0],q=o>>1,r=p>>1,s=Math.floor(k),t=Math.floor(l),u=Math.floor(m),v=Math.floor(n);if(0>t-q||t+q>=a.nRow||0>s-r||s+r>=a.nCol||0>v-q||v+q>=e.nRow||0>u-r||u+r>=e.nCol)return[f,jscv.cv.OPTICAL_FLOW_LK_CANNOT_TRACK_,0];for(var w=[],x=[],y=[],z=-q;q>=z;z++){var A=z+q;w[A]=[],x[A]=[],y[A]=[];for(var B=-r;r>=B;B++)w[A].push(jscv.cv.interpolate_(b,k+B,l+z)),x[A].push(jscv.cv.interpolate_(c,k+B,l+z)),y[A].push(jscv.cv.interpolate_(a,k+B,l+z))}for(var C=0,D=0,E=0,z=-q;q>=z;z++)for(var B=-r;r>=B;B++){var F=w[z+q][B+r],G=x[z+q][B+r];C+=F*F,E+=G*G,D+=F*G}var H=C*E-D*D,I=C+E,J=(I-Math.sqrt(I*I-4*H))/2;if(J/=p*o,j>J||H<jscv.DEFAULT_ZERO_THRESHOLD_FLOAT32)return[f,jscv.cv.OPTICAL_FLOW_LK_CANNOT_TRACK_,J];for(var K=[[E/H,-D/H],[-D/H,C/H]],L=0;h>L&&(u=Math.floor(m),v=Math.floor(n),!(0>v-q||v+q>=e.nRow||0>u-r||u+r>=e.nCol));L++){for(var M=[0,0],z=-q;q>=z;z++)for(var B=-r;r>=B;B++){var N=y[z+q][B+r]-jscv.cv.interpolate_(e,m+B,n+z);M[0]+=w[z+q][B+r]*N,M[1]+=x[z+q][B+r]*N}var O=K[0][0]*M[0]+K[0][1]*M[1],P=K[1][0]*M[0]+K[1][1]*M[1];if(m+=O,n+=P,i*i>O*O+P*P)break}return[new jscv.coredt.Point(m,n),jscv.cv.OPTICAL_FLOW_LK_CAN_TRACK_,J]},jscv.cv.interpolate_=function(a,b,c){var d,e,f,g=Math.floor(c),h=Math.floor(b),i=h-b,j=g-c,k=g*a.nCol+h,l=a.data[k];return d=h+1<a.nCol?a.data[k+1]:l,g+1<a.nRow?(e=a.data[k+a.nCol],f=h+1<a.nCol?a.data[k+a.nCol+1]:d):(e=l,f=d),(1-i)*(1-j)*l+i*(1-j)*d+(1-i)*j*e+i*j*f},jscv.coredt.Matrix=function(){function a(){var a,b="jscv.coredt.Matrix does not support this type of constructor",c=jscv.USE_JS_ARRAY_FLAG_;if(c||jscv.utility.canUseTypedObject||(c=!0),1==arguments.length&&arguments[0]instanceof jscv.coredt.Matrix){this.nRow=arguments[0].nRow,this.nCol=arguments[0].nCol,this.depth=arguments[0].depth,this.elementalType=arguments[0].elementalType,this.useJsArray=arguments[0].useJsArray,this.stride=arguments[0].stride.slice(0);var d=this.nRow*this.nCol*this.depth;this.useJsArray?(a=jscv.utility.getJsArrayType(this.elementalType),this.data=new a(arguments[0].data)):(matrixType=jscv.coredt.getNdArrayType(d,this.elementalType),this.data=new matrixType(arguments[0].data))}else{if(!(arguments.length>=1))throw new Error(b);this.depth=0,this.elementalType=jscv.uint8Clamped,this.nRow=0,this.nCol=0;var e=0;if("number"==typeof arguments[e]){if(this.nRow=arguments[e],e++,arguments.length<=e||"number"!=typeof arguments[e])throw new Error(b);this.nCol=arguments[e],e++,arguments.length>e&&"number"==typeof arguments[e]&&(this.depth=arguments[e],e++)}else if(arguments[e]instanceof Array){if(arguments[e].length<=0)throw new Error(b);if("number"==typeof arguments[e][0]){if(arguments[e].length<2)throw new Error(b);this.nRow=arguments[e][0],this.nCol=arguments[e][1],arguments[e].length>=3&&(this.depth=arguments[e][2]),e++}else if(!arguments[e][0].hasOwnProperty("length"))throw new Error(b)}var f=0,g=void 0;if(arguments.length>e&&arguments[e]instanceof jscv.coredt.Type&&(this.elementalType=arguments[e],e++,jscv.SUPPORT_DATA_TYPE.indexOf(this.elementalType)<0))throw new Error("The argument type is currently not supported in jscv.coredt.Matrix");if(arguments.length>e&&("number"==typeof arguments[e]?f=arguments[e]:g=arguments[e],e++),this.useJsArray=c,(this.nRow<=0||this.nCol<=0)&&void 0!=g&&g.hasOwnProperty("length")&&g.length>0&&g[0].hasOwnProperty("length")&&g[0].length>0&&(this.nRow=g.length,this.nCol=g[0].length,g[0][0].hasOwnProperty("length")&&(this.depth=g[0][0].length)),this.nRow<=0||this.nCol<=0||this.depth<0)throw new Error("Invalid value for matrix dimension");this.depth<1&&(this.depth=1);var d=this.nRow*this.nCol*this.depth;if(this.stride=1==this.depth?[this.nCol,1]:[this.nCol*this.depth,this.depth,1],c?(a=jscv.utility.getJsArrayType(this.elementalType),this.data=g instanceof ArrayBuffer?new a(g):new a(d)):(a=jscv.coredt.getNdArrayType(d,this.elementalType),this.data=g instanceof ArrayBuffer?new a(g):new a),void 0==g)f&&jscv.utility.fillMat(this,f);
else if(!(g instanceof ArrayBuffer)){if(!(g.hasOwnProperty("length")&&g instanceof Object))throw new Error(b);g[0].hasOwnProperty("length")?jscv.utility.copyMatData(this,g):jscv.utility.fillMat(this,g)}}return this}var b=function(a,b,c){return 1==this.depth?a*this.stride[0]+b:a*this.stride[0]+b*this.stride[1]+c},c=function(a,b,c){return this.data[this.getStridedIndex(a,b,c)]},d=function(a,b,c,d){this.data[this.getStridedIndex(b,c,d)]=a},e=function(){if(this.useJsArray)return null;var a=[this.nRow,this.nCol];this.depth>1&&(a[2]=this.depth);var b=jscv.coredt.getNdArrayType(a,this.elementalType);return new b(TypedObject.storage(this.data).buffer)},f=function(){if(!this.useJsArray)throw new Error("The method ndMapPar is only available for Mozilla Parallel Binary Data");var a=1,b=0;"number"==typeof arguments[b]&&(a=arguments[b],b++);var c=arguments[b],d=this.getNdView(),e=d.mapPar(a,c);return new jscv.coredt.Matrix(this.shape,this.elementalType,TypedObject.storage(e).buffer)};return a.prototype={get:c,set:d,getStridedIndex:b,getNdView:e,ndMapPar:f,get maxNumLevel(){return 1==this.depth?2:3},get shape(){return[this.nRow,this.nCol,this.depth]}},a}(),jscv.coredt.Image=function(){function a(){var a,b,c,d,e,f="jscv.coredt.Image does not support this type of constructor",g="jscv.coredt.Image does not support this type of color space",h="Input data size and image data size are incompatible",i="Specified image width or height is invalid",j=arguments.length;if(1>j)throw new Error(f);if(1==j&&arguments[0]instanceof jscv.coredt.Image)this.colorMode=arguments[0].colorMode,this.data=new jscv.coredt.Matrix(arguments[0].data);else if("number"==typeof arguments[j-1]){if(b=arguments[0],c=arguments[1],a=void 0,"number"!=typeof b||"number"!=typeof c&&0>=b||0>=c)throw new Error(i);if("number"==typeof arguments[2]?e=arguments[2]:(a=arguments[2],e=arguments[3]),jscv.SUPPORT_COLOR_MODE.indexOf(e)<0)throw new Error(g);jscv.SUPPORT_DATA_TYPE.indexOf(a)<0&&(a=jscv.MAP_COLOR_MODE_TO_DATA_TYPE[e]),d=jscv.MAP_COLOR_MODE_TO_NCHANNEL[e],this.colorMode=e,this.data=new jscv.coredt.Matrix([c,b,d],a)}else if(arguments[j-1]instanceof ArrayBuffer){b=arguments[0],c=arguments[1],e=jscv.COLOR_RGBA;var k;if(a=void 0,"number"!=typeof b||"number"!=typeof c&&0>=b||0>=c)throw new Error(i);var l=2;if(arguments[l]instanceof jscv.coredt.Type&&(a=arguments[l],l++),"number"==typeof arguments[l]&&(e=arguments[l],l++),k=arguments[l],jscv.SUPPORT_DATA_TYPE.indexOf(a)<0&&(a=jscv.MAP_COLOR_MODE_TO_DATA_TYPE[e]),d=jscv.MAP_COLOR_MODE_TO_NCHANNEL[e],this.colorMode=e,this.data=new jscv.coredt.Matrix([c,b,d],a,k),b*c*d!=this.data.data.length)throw new Error(h)}else{if(!(arguments[j-1]instanceof jscv.coredt.Matrix))throw new Error(f);e=void 0;var m=arguments[j-1];if(j>=2&&(e=arguments[j-2]),jscv.SUPPORT_COLOR_MODE.indexOf(e)<0)throw new Error(g);if(d=jscv.MAP_COLOR_MODE_TO_NCHANNEL[e],d!=m.depth)throw new Error(h);this.colorMode=e,this.data=new jscv.coredt.Matrix(m)}return this}return a.prototype={get elementalType(){return this.data.elementalType},get width(){return this.data.nCol},get height(){return this.data.nRow},get nChannel(){return this.data.depth},get shape(){return[this.height,this.width,this.nChannel]}},a}(),jscv.coredt.Contour=function(){function a(){var a=!1,b="jscv.coredt.Contour does not support this type of constructor",c="Invalid code of approximation method";if(1==arguments.length){if(arguments[0]instanceof jscv.coredt.Contour){if(this.origin=new jscv.coredt.Point(arguments[0].origin),this.approxMethod=arguments[0].approxMethod,this.isHole=arguments[0].isHole,this.seqData=new Array,this.approxMethod==jscv.CHAIN_APPROX_SIMPLE)for(var d=0;d<arguments[0].seqData.length;d++)this.seqData[d]=new jscv.coredt.Point(arguments[0].seqData[d]);else{if(this.approxMethod!=jscv.FREEMAN_CHAIN_CODE)throw new Error(c);for(var d=0;d<arguments[0].seqData.length;d++)this.seqData[d]=arguments[0].seqData[d]}a=!0}}else if(3==arguments.length){if(this.origin=new jscv.coredt.Point(arguments[0]),this.approxMethod=arguments[1],this.isHole=arguments[2],this.seqData=new Array,this.approxMethod!=jscv.CHAIN_APPROX_SIMPLE&&this.approxMethod!=jscv.FREEMAN_CHAIN_CODE)throw new Error(c);a=!0}else if(4==arguments.length){if(this.origin=new jscv.coredt.Point(arguments[0]),this.approxMethod=arguments[2],this.isHole=arguments[3],this.seqData=new Array,this.approxMethod==jscv.CHAIN_APPROX_SIMPLE)for(var d=0;d<arguments[1].length;d++)this.seqData[d]=new jscv.coredt.Point(arguments[1][d]);else{if(this.approxMethod!=jscv.FREEMAN_CHAIN_CODE)throw new Error(c);for(var d=0;d<arguments[1].length;d++)this.seqData[d]=arguments[1][d]}a=!0}if(!a)throw new Error(b);return this}return a}(),jscv.coredt.ContourNode=function(){function a(){var a=!1,b="jscv.coredt.ContourNode does not support this type of constructor";if(1==arguments.length?arguments[0]instanceof jscv.coredt.ContourNode?(this.id=arguments[0].id,this.parentId=arguments[0].parentId,this.contour=new jscv.coredt.Contour(arguments[0].contour),a=!0):"number"==typeof arguments[0]&&(this.id=arguments[0],this.parentId=arguments[0],this.contour=void 0,a=!0):2==arguments.length?(this.id=arguments[0],arguments[1]instanceof jscv.coredt.Contour?(this.contour=new jscv.coredt.Contour(arguments[1]),this.parentId=this.id,a=!0):"number"==typeof arguments[1]&&(this.parentId=arguments[1],this.contour=void 0,a=!0)):3==arguments.length&&(this.id=arguments[0],this.parentId=arguments[1],this.contour=new jscv.coredt.Contour(arguments[2]),a=!0),!a)throw new Error(b);return this.neighborList=new Array,this}return a}(),jscv.coredt.ConvexDefect=function(){function a(){var a=!1,b="jscv.coredt.ConvexDefect does not support this type of constructor";if(1==arguments.length?arguments[0]instanceof jscv.coredt.ConvexDefect&&(this.startP=new jscv.coredt.Point(arguments[0].startP),this.endP=new jscv.coredt.Point(arguments[0].endP),this.depthP=new jscv.coredt.Point(arguments[0].depthP),this.depth=arguments[0].depth,a=!0):0==arguments.length?(this.startP=void 0,this.endP=void 0,this.depthP=void 0,this.depth=0,a=!0):arguments.length>=3&&(this.startP=new jscv.coredt.Point(arguments[0]),this.endP=new jscv.coredt.Point(arguments[1]),this.depthP=new jscv.coredt.Point(arguments[2]),this.depth=arguments.length>3?arguments[3]:jscv.geometry.distancePointToLine(this.depthP,this.startP,this.endP),a=!0),!a)throw new Error(b);return this}return a}(),jscv.coredt.Moments=function(){function a(){if(jscv.utility.canUseTypedObject()){var a=jscv.coredt.getNdArrayType([4,4],jscv.float64);this.spatial=new a,this.central=new a,this.normCentral=new a}else this.spatial=jscv.coredt.getNdJsArray([4,4],jscv.float64),this.central=jscv.coredt.getNdJsArray([4,4],jscv.float64),this.normCentral=jscv.coredt.getNdJsArray([4,4],jscv.float64);for(var b=0;4>b;b++)for(var c=0;4>c;c++)b+c>3?(this.spatial[b][c]=0/0,this.central[b][c]=0/0,this.normCentral[b][c]=0/0):(this.spatial[b][c]=0,this.central[b][c]=0,this.normCentral[b][c]=0);return this}return a}(),jscv.coredt.getNdArrayType=function(a,b){var c=jscv.utility.getTypedObjectArrayType(b);if("number"==typeof a)return a=Math.floor(a),c.array(a);for(var d=new Array,e=0;e<a.length&&a[e]>0;)d.push(Math.floor(a[e])),e++;if(d.length<1)throw new Error("The number of dimensions must be >= 1");return c.array.apply(c,d)},jscv.coredt.getNdJsArray=function(a,b){var c=jscv.utility.getJsArrayType(b);if("number"==typeof a)return a=Math.floor(a),new c(a);for(var d=new Array,e=0;e<a.length&&a[e]>0;)d.push(Math.floor(a[e])),e++;if(d.length<1)throw new Error("The number of dimensions must be >= 1");if(1==d.length)return new c(d[0]);var f=d.length,g=[],h=[];h.push([g,0]);for(var i=h.length-1;i>=0;){var j=h[i][0],k=h[i][1];if(i--,k==f-2)for(var l=0;l<d[f-2];l++)j.push(new c(d[f-1]));else for(var l=0;l<d[k];l++){var m=[];j.push(m),i++,h[i]=[m,k+1]}}return g},jscv.coredt.Point=function(){function a(){if(0==arguments.length)this.x=0,this.y=0;else if(1==arguments.length){if(!(arguments[0]instanceof jscv.coredt.Point))throw new Error("The argument object must be an instance of jscv.coredt.Point");this.x=arguments[0].x,this.y=arguments[0].y}else{if(2!=arguments.length)throw new Error("No such constructor");this.x=arguments[0],this.y=arguments[1]}return this}return a.prototype={equals:function(b){return b instanceof a?jscv.utility.isZero(this.x-b.x,jscv.DEFAULT_ZERO_THRESHOLD_FLOAT32)&&jscv.utility.isZero(this.y-b.y,jscv.DEFAULT_ZERO_THRESHOLD_FLOAT32)?!0:!1:!1}},a}(),jscv.coredt.Vector=function(){function a(){if(0==arguments.length)this.x=0,this.y=0;else if(1==arguments.length){if(!(arguments[0]instanceof jscv.coredt.Vector))throw new Error("The argument object must be an instance of jscv.coredt.Vector");this.x=arguments[0].x,this.y=arguments[0].y}else{if(2!=arguments.length)throw new Error("No such constructor");this.x=arguments[0],this.y=arguments[1]}return this}return a}(),jscv.coredt.Line=function(){function a(){if(0==arguments.length)this.startPoint=new jscv.coredt.Point,this.endPoint=new jscv.coredt.Point;else if(1==arguments.length){if(!(arguments[0]instanceof jscv.coredt.Line))throw new Error("The argument object must be an instance of jscv.coredt.Line");this.startPoint=new jscv.coredt.Point(arguments[0].startPoint),this.endPoint=new jscv.coredt.Point(arguments[0].endPoint)}else if(2==arguments.length){if(!(arguments[0]instanceof jscv.coredt.Point&&arguments[1]instanceof jscv.coredt.Point))throw new Error("The argument objects must be an instance of jscv.coredt.Point");this.startPoint=new jscv.coredt.Point(arguments[0]),this.endPoint=new jscv.coredt.Point(arguments[1])}else{if(4!=arguments.length)throw new Error("No such constructor");this.startPoint=new jscv.coredt.Point(arguments[0],arguments[1]),this.endPoint=new jscv.coredt.Point(arguments[2],arguments[3])}return this}return a}(),jscv.coredt.Circle=function(){function a(){if(0==arguments.length)this.center=new jscv.coredt.Point,this.radius=0;else if(1==arguments.length){if(!(arguments[0]instanceof jscv.coredt.Circle))throw new Error("The argument object must be an instance of jscv.coredt.Circle");this.center=new jscv.coredt.Point(arguments[0].center),this.radius=arguments[0].radius}else if(2==arguments.length){if(!(arguments[0]instanceof jscv.coredt.Point))throw new Error("The first argument object must be an instance of jscv.coredt.Point");this.center=new jscv.coredt.Point(arguments[0]),this.radius=arguments[1]}else{if(3!=arguments.length)throw new Error("No such constructor");this.center=new jscv.coredt.Point(arguments[0],arguments[1]),this.radius=arguments[2]}return this}return a}(),jscv.coredt.Edge=function(){function a(){if(this.num=0,this.next=void 0,this.data=void 0,1==arguments.length)if(arguments[0]instanceof jscv.coredt.QuadEdge)this.quadEdge=arguments[0];else{if(!(arguments[0]instanceof jscv.coredt.Edge))throw new Error("The argument object must be instance of either jscv.coredt.Edge or jscv.coredt.QuadEdge");this.quadedge=arguments[0].quadedge,this.data=new jscv.coredt.Point(arguments[0].Org()),this.Sym().data=new jscv.coredt.Point(arguments[0].Dest()),this.num=arguments[0].num}else{if(3!=arguments.length&&4!=arguments.length)throw new Error("No such constructor");if(!(arguments[0]instanceof jscv.coredt.QuadEdge))throw new Error("The argument objects must be instances of jscv.coredt.QuadEdge");if(this.quadEdge=arguments[0],!(arguments[1]instanceof jscv.coredt.Poin&&arguments[2]instanceof jscv.coredt.Point))throw new Error("The argument objects must be instances of jscv.coredt.Point");this.data=new jscv.coredt.Point(arguments[1]),this.Sym().data=new jscv.coredt.Point(arguments[2]),this.num=4==arguments.length?arguments[3]:0}return this}var b=function(){return this.quadedge.getEdge(this.num<3?this.num+1:this.num-3)},c=function(){return this.quadedge.getEdge(this.num>0?this.num-1:this.num+3)},d=function(){return this.quadedge.getEdge(this.num<2?self.num+2:self.num-2)},e=function(){return this.next},f=function(){return this.Rot().Onext().Sym()},g=function(){return this.Sym().Onext().Sym()},h=function(){return this.invRot().Onext().invRot()},i=function(){return this.invRot().Onext().Rot()},j=function(){return this.Onext().Sym()},k=function(){return this.Rot().Onext().invRot()},l=function(){return this.Sym().Onext()},m=function(){return this.quadedge},n=function(){return this.data},o=function(){return this.Sym().data};return a.prototype={Rot:b,InvRot:c,Sym:d,Onext:e,Oprev:f,Dnext:g,Dprev:h,Lnext:i,Rnext:k,Lprev:j,Rprev:l,Qedge:m,Org:n,Dest:o},a}(),jscv.coredt.QuadEdge=function(){function a(){if(2!=arguments.length)throw new Error("No such constructor.");if(!(arguments[0]instanceof jscv.coredt.Point&&arguments[0]instanceof jscv.coredt.Point))throw new Error("The argument objects must be instances of jscv.coredt.Point.");for(var a=[],b=0;4>b;b++)0==b?a.push(new jscv.coredt.Edge(this,arguments[1],arguments[2])):2==b?a.push(new jscv.coredt.Edge(this,arguments[2],arguments[1])):a.push(new jscv.coredt.Edge(this));a[0].num=0,a[1].num=1,a[2].num=2,a[3].num=3,a[0].next=a[0],a[1].next=a[3],a[2].next=a[2],a[3].next=a[1]}var b=function(){return this.e[arguments[0]]};return a.splice=function(a,b){var c=a.Onext().Rot(),d=b.Onext().Rot(),e=b.Onext(),f=a.Onext(),g=d.Onext(),h=c.Onext();a.next=e,b.next=f,c.next=g,d.next=h},a.connect=function(a,b){var c=(new jscv.coredt.QuadEdge).getEdge(0);return jscv.coredt.QuadEdge.splice(c,a.Lnext()),jscv.coredt.QuadEdge.splice(c.Sym(),b),c.EndPoint(a.Dest(),b.Org()),c},a.swap=function(a){var b=a.Oprev(),c=a.Sym().Oprev();jscv.coredt.QuadEdge.splice(a,b),jscv.coredt.QuadEdge.splice(a.Sym(),c),jscv.coredt.QuadEdge.splice(a,b.Lnext()),jscv.coredt.QuadEdge.splice(a.Sym(),c.Lnext()),a.EndPoint(b.Dest(),c.Dest())},a.deleteEdge=function(a){jscv.coredt.QuadEdge.splice(a,a.Oprev()),jscv.coredt.QuadEdge.splice(a.Sym(),a.Sym().Oprev()),delete a.Qedge()},a.prototype={getEdge:b},a}(),jscv.coredt.Subdivision=function(){function a(){if(this.startingEdge=void 0,3!=arguments.length)throw new Error("The constructor takes 3 jscv.coredt.Point instances");var a=new jscv.coredt.Point(arguments[0]),b=new jscv.coredt.Point(arguments[1]),c=new jscv.coredt.Point(arguments[2]),d=(new jscv.coredt.QuadEdge).getEdge(0);d.EndPoint(a,b);var e=(new jscv.coredt.QuadEdge).getEdge(0);jscv.coredt.QuadEdge.splice(d.Sym(),e),e.EndPoint(b,c);var f=(new jscv.coredt.QuadEdge).getEdge(0);jscv.coredt.QuadEdge.splice(e.Sym(),f),f.EndPoint(c,a),jscv.coredt.QuadEdge.splice(f.Sym(),d),this.startingEdge=d}var b=function(a){for(var b=this.startingEdge;;){if(a==b.Org()||a==b.Dest())return b;if(jscv.geometry.RightOf(a,b))b=b.Sym();else if(jscv.geometry.RightOf(a,b.Onext())){if(jscv.geometry.RightOf(a,b.Dprev()))return b;b=b.Dprev()}else b=b.Onext()}},c=function(a){var b=this.locate(a);if(a!=b.Org()&&a!=b.Dest()){jscv.geometry.OnEdge(a,b)&&(b=b.Oprev(),jscv.coredt.QuadEdge.deleteEdge(b.Onext()));var c=new jscv.coredt.QuadEdge(b.Org(),new jscv.coredt.Point(a));jscv.coredt.QuadEdge.splice(c,b),this.startingEdge=c;do c=jscv.coredt.QuadEdge.connect(b,c.Sym()),b=c.Oprev();while(b.Lnext()!=startingEdge);for(;;){var d=b.Oprev();if(jscv.geometry.RightOf(d.Dest(),b)&&jscv.geometry.InCircle(b.Org(),d.Dest(),b.Dest(),a))jscv.coredt.QuadEdge.swap(b),b=b.Oprev();else{if(b.Onext()==this.startingEdge)return;b=b.Onext().Lprev()}}}},d=function(){};return a.prototype={locate:b,insertSite:c,draw:d},a}(),jscv.geometry.findConvexDefects=function(a,b){void 0==b&&(b=!0);var c;a instanceof jscv.coredt.ContourNode&&(a=a.contour),a instanceof jscv.coredt.Contour?(a.approxMethod==jscv.FREEMAN_CHAIN_CODE&&(a=jscv.cv.convertContourApprox(a,jscv.CHAIN_APPROX_SIMPLE)),c=a.seqData):c=a;var d=jscv.geometry.convexHull(c),e=new Array;if(c.length<4||d.length<3)return b?[e,d]:e;for(var f,g,h,i,j,k=jscv.utility.findPointInd(c,d[0]),l=jscv.utility.findArrDirection(jscv.utility.findPointInd(c,d[0]),jscv.utility.findPointInd(c,d[1]),jscv.utility.findPointInd(c,d[2])),m=1e-11,n=k,o=0;o<d.length;o++){for(f=d[o],g=o<d.length-1?d[o+1]:d[0],h=!1,i=0;;){if(n+=l,0>n?n=c.length-1:n>=c.length&&(n=0),jscv.utility.equalPoints(c[n],g))break;var p=jscv.geometry.distancePointToLine(c[n],f,g);p>i&&(i=p,j=c[n])}if(i>m&&(h=!0),h){var q=new jscv.coredt.ConvexDefect(f,g,j,i);e.push(q)}}return b?[e,d]:e},jscv.geometry.extractDefectPoints=function(a,b){var c;a instanceof jscv.coredt.ContourNode&&(a=a.contour),a instanceof jscv.coredt.Contour?(a.approxMethod==jscv.FREEMAN_CHAIN_CODE&&(a=jscv.cv.convertContourApprox(a,jscv.CHAIN_APPROX_SIMPLE)),c=a.seqData):c=a;for(var d=new Array,e=jscv.utility.findArrDirection(b.startP,b.depthP,b.endP),f=jscv.utility.findPointInd(c,b.startP),g=jscv.utility.findPointInd(c,b.endP),h=f;h!=g;)d.push(c[h]),h+=e,0>h?h=c.length-1:h>=c.length&&(h=0);return d.push(c[g]),d},jscv.geometry.convexHull=function(a,b){var c=jscv.utility.processUserConfig_(b);return c==jscv.ENFORCE_PARALLEL?jscv.geometry.convexHullPar_(a):c==jscv.ENFORCE_SEQUENTIAL?jscv.geometry.convexHullSeq_(a):jscv.geometry.convexHullSeq_(a)},jscv.geometry.convexHullSeq_=function(a){for(var b=new Array,c=a.length,d=0;c>d;d++)b[d]=new jscv.coredt.Point(a[d]);b.sort(function(a,b){return a.x>b.x||a.x<b.x?a.x-b.x:a.y-b.y});for(var e=new Array,f=0,d=0;c>d;d++){for(;f>=2&&jscv.geometry.crossProduct(e[f-2],e[f-1],b[d])<=0;)f--;e[f++]=b[d]}for(var d=c-2,g=f+1;d>=0;d--){for(;f>=g&&jscv.geometry.crossProduct(e[f-2],e[f-1],b[d])<=0;)f--;e[f++]=b[d]}for(;e.length>f;)e.pop();return e.pop(),e},jscv.geometry.convexHullPar_=function(a){var b=a.mapPar(function(a){return new jscv.coredt.Point(a)}),c=a.length;b.sort(function(a,b){return a.x>b.x||a.x<b.x?a.x-b.x:a.y-b.y});var d=[0,1].mapPar(function(a){var d=new Array,e=0;if(0==a)for(var f=0;c>f;f++){for(;e>=2&&jscv.geometry.crossProduct(d[e-2],d[e-1],b[f])<=0;)e--;d[e++]=b[f]}else for(var f=c-1;f>=0;f--){for(;e>=2&&jscv.geometry.crossProduct(d[e-2],d[e-1],b[f])<=0;)e--;d[e++]=b[f]}for(;d.length>e;)d.pop();return d.pop(),d});return d[0].concat(d[1])},jscv.geometry.createDelaunayTriangulation=function(){if(arguments[0]instanceof Array){if(arguments[0].length>=3){for(var a=arguments[0],b=new jscv.coredt.Subdivision(intput[0],a[1],a[2]),c=3;c<a.length;c++)b.insertSite(a[c]);return b}throw new Error("Need at least 3 points to form a triangle")}throw new Error("Input must be an array of jscv.coredt.Point")},jscv.geometry.insidePolygon=function(a,b,c){var d=jscv.utility.processUserConfig_(c);return d==jscv.ENFORCE_PARALLEL?jscv.geometry.insidePolygonPar_(a,b):d==jscv.ENFORCE_SEQUENTIAL?jscv.geometry.insidePolygonSeq_(a,b):jscv.geometry.insidePolygonSeq_(a,b)},jscv.geometry.insidePolygonSeq_=function(a,b){var c=1e-5,d=b.length;if(0==d)return!1;for(var e=0,f=0;d-1>f;f++)e+=jscv.geometry.getAngle(b[f],a,b[f+1])*jscv.geometry.getSide(a,b[f],b[f+1]);return e+=jscv.geometry.getAngle(b[d-1],a,b[0])*jscv.geometry.getSide(a,b[d-1],b[0]),Math.abs(Math.abs(e)-2*Math.PI)<c},jscv.geometry.insidePolygonPar_=function(a,b){var c=1e-5,d=b.length;if(0==d)return!1;var e=b.mapPar(function(c,e){var f=d-1>e?e+1:0;return jscv.geometry.getAngle(b[e],a,b[f])*jscv.geometry.getSide(a,b[e],b[f])}),f=e.reducePar(function(a,b){return a+b});return Math.abs(Math.abs(f)-2*Math.PI)<c},jscv.geometry.isConvex=function(a,b){var c=jscv.utility.processUserConfig_(b);return c==jscv.ENFORCE_PARALLEL?jscv.geometry.isConvexPar_(a):c==jscv.ENFORCE_SEQUENTIAL?jscv.geometry.isConvexSeq_(a):jscv.geometry.isConvexSeq_(a)},jscv.geometry.isConvexSeq_=function(a){var b=a.length;if(3>b)return!1;for(var c=jscv.geometry.getSide(a[0],a[1],a[2]),d=1;b-1>d;d++){var e=jscv.geometry.getSide(a[d],a[d+1],a[d+2==b?0:d+2]);if(0==c)c=e;else if(0>e*c)return!1}var f=jscv.geometry.getSide(a[b-1],a[0],a[1]);return 0==c&&0==f?!1:c*f>=0},jscv.geometry.isConvexPar_=function(a){var b=a.length;if(3>b)return!1;var c=a.mapPar(function(a,c,d){var e=b-1>c?c+1:0,f=b-2>c?c+2:c+2-b,g=jscv.geometry.getSide(d[c],d[e],d[f]);return 0==g?g:g>0?1:-1}),d=c.reducePar(function(a,b){return 0==a?b>=0?b+1:b-1:0==b?a>=0?a+1:a-1:a+b});return d*d==b*b},jscv.geometry.approxPoly=function(a,b,c){var d=jscv.utility.processUserConfig_(c);return d==jscv.ENFORCE_PARALLEL?jscv.geometry.approxPolyPar_(a,b):d==jscv.ENFORCE_SEQUENTIAL?jscv.geometry.approxPolySeq_(a,b):jscv.geometry.approxPolySeq_(a,b)},jscv.geometry.approxPolySeq_=function(a,b){var c=[new jscv.coredt.Point(a[0]),new jscv.coredt.Point(a[a.length-1])];if(a.length<3)return c;for(var d=-1,e=0,f=1;f<a.length-1;f++){var g=jscv.geometry.distancePointToSegment(a[f],c[0],c[1]);g>e&&(e=g,d=f)}if(e>b){var h=a.slice(0,d+1),i=a.slice(d),j=jscv.geometry.approxPoly(h,b),k=jscv.geometry.approxPoly(i,b);return j.slice(0,j.length-1).concat(k)}return c},jscv.geometry.approxPolyPar_=function(a,b){var c=[new jscv.coredt.Point(a[0]),new jscv.coredt.Point(a[a.length-1])];if(a.length<3)return c;var d=a.mapPar(function(a,b){return[jscv.geometry.distancePointToSegment(a,c[0],c[1]),b]}),e=d.reducePar(function(a,b){return a[0]==b[0]?a[1]<b[1]?a:b:a[0]>b[0]?a:b});if(e[0]>b){var f=a.slice(0,e[1]+1),g=a.slice(e[1]),h=jscv.geometry.approxPoly(f,b),i=jscv.geometry.approxPoly(g,b);return h.slice(0,h.length-1).concat(i)}return c},jscv.geometry.boundingRect=function(a,b){var c=jscv.utility.processUserConfig_(b);return c==jscv.ENFORCE_PARALLEL?jscv.geometry.boundingRectPar_(a):c==jscv.ENFORCE_SEQUENTIAL?jscv.geometry.boundingRectSeq_(a):jscv.geometry.boundingRectSeq_(a)},jscv.geometry.boundingRectSeq_=function(a){var b,c,d,e;b=d=a[0].x,c=e=a[0].y;for(var f=1;f<a.length;f++)b=a[f].x<b?a[f].x:b,d=a[f].x>d?a[f].x:d,c=a[f].y<c?a[f].y:c,e=a[f].y>e?a[f].y:e;return[new jscv.coredt.Point(b,c),new jscv.coredt.Point(d,c),new jscv.coredt.Point(d,e),new jscv.coredt.Point(b,e)]},jscv.geometry.boundingRectPar_=function(a){var b=a.reducePar(function(a,b){var c=a.x<b.x?a.x:b.x,d=a.y<b.y?a.y:b.y;return new jscv.coredt.Point(c,d)}),c=a.reducePar(function(a,b){var c=a.x>b.x?a.x:b.x,d=a.y>b.y?a.y:b.y;return new jscv.coredt.Point(c,d)});return[b,new jscv.coredt.Point(c.x,b.y),c,new jscv.coredt.Point(b.x,c.y)]},jscv.geometry.getRectArea_=function(a){return jscv.geometry.distancePointToPoint(a[0],a[1])*jscv.geometry.distancePointToPoint(a[1],a[2])},jscv.geometry.getNormalizedDirVector_=function(a,b){var c=a.x-b.x,d=a.y-b.y,e=jscv.geometry.distancePointToPoint(a,b);return new jscv.coredt.Vector(c/e,d/e)},jscv.geometry.getIntersection_=function(a,b,c,d){var e=b.x*d.y-b.y*d.x,f=c.x-a.x,g=c.y-a.y,h=(f*d.y-g*d.x)/e;return new jscv.coredt.Point(a.x+h*b.x,a.y+h*b.y)},jscv.geometry.minAreaRect=function(a){for(var b=jscv.geometry.convexHull(a),c=Number.MAX_VALUE,d=[],e=[],f=1;f<b.length;f++)e.push(jscv.geometry.getNormalizedDirVector_(b[f],b[f-1]));e.push(jscv.geometry.getNormalizedDirVector_(b[0],b[b.length-1]));for(var g=[0,0,0,0],f=1;f<b.length;f++)b[f].x<b[g[0]].x&&(g[0]=f),b[f].x>b[g[2]].x&&(g[2]=f),b[f].y<b[g[1]].y&&(g[1]=f),b[f].y>b[g[3]].y&&(g[3]=f);for(var h=[new jscv.coredt.Vector(0,-1),new jscv.coredt.Vector(1,0),new jscv.coredt.Vector(0,1),new jscv.coredt.Vector(-1,0)],f=0;f<b.length;f++){for(var i=2*Math.PI,j=0,k=0;4>k;k++)rotateAngle=jscv.geometry.getAngle(h[k],e[g[k]]),i>rotateAngle&&(i=rotateAngle,j=k);h[j]=new jscv.coredt.Vector(e[g[j]]),h[(j+1)%4]=new jscv.coredt.Vector(-h[j].y,h[j].x),h[(j+2)%4]=new jscv.coredt.Vector(-h[j].x,-h[j].y),h[(j+3)%4]=new jscv.coredt.Vector(h[j].y,-h[j].x),g[j]=(g[j]+1)%b.length;var l=[jscv.geometry.getIntersection_(b[g[0]],h[0],b[g[1]],h[1]),jscv.geometry.getIntersection_(b[g[1]],h[1],b[g[2]],h[2]),jscv.geometry.getIntersection_(b[g[2]],h[2],b[g[3]],h[3]),jscv.geometry.getIntersection_(b[g[3]],h[3],b[g[0]],h[0])],m=jscv.geometry.getRectArea_(l);c>m&&(c=m,d=l)}return d},jscv.geometry.crossProduct=function(a,b,c){return(c.x-b.x)*(a.y-b.y)-(c.y-b.y)*(a.x-b.x)},jscv.geometry.distancePointToPoint=function(a,b){return Math.sqrt((a.x-b.x)*(a.x-b.x)+(a.y-b.y)*(a.y-b.y))},jscv.geometry.distancePointToLine=function(a,b,c){var d,e;b instanceof jscv.coredt.Line?(d=b.startPoint,e=b.endPoint):(d=b,e=c);var f=e.x-d.x,g=e.y-d.y,h=Math.sqrt(f*f+g*g);return Math.abs(-g*(a.x-d.x)+f*(a.y-d.y))/h},jscv.geometry.distancePointToSegment=function(a,b,c){var d=(b.x-c.x)*(b.x-c.x)+(b.y-c.y)*(b.y-c.y);if(0==d)return jscv.geometry.distancePointToPoint(a,b);var e=((a.x-b.x)*(c.x-b.x)+(a.y-b.y)*(c.y-b.y))/d;return 0>e?jscv.geometry.distancePointToPoint(a,b):e>1?jscv.geometry.distancePointToPoint(a,c):jscv.geometry.distancePointToLine(a,b,c)},jscv.geometry.getSide=function(a,b,c){var d=1e-5,e=jscv.geometry.crossProduct(a,b,c);return Math.abs(e)<d?0:e>0?1:-1},jscv.geometry.getAngle=function(){if(3==arguments.length){var a=arguments[0],b=arguments[1],c=arguments[2];if(!(a instanceof jscv.coredt.Point&&b instanceof jscv.coredt.Point&&c instanceof jscv.coredt.Point))throw new Error("The argument objects must be an instance of jscv.coredt.Point");var d=a.x-b.x,e=a.y-b.y,f=c.x-b.x,g=c.y-b.y;return Math.acos((d*f+e*g)/Math.sqrt((d*d+e*e)*(f*f+g*g)))}if(2==arguments.length){var h=arguments[0],i=arguments[1];if(!(h instanceof jscv.coredt.Vector&&i instanceof jscv.coredt.Vector))throw new Error("The argument objects must be an instance of jscv.coredt.Vector");return Math.acos((h.x*i.x+h.y*i.y)/Math.sqrt((h.x*h.x+h.y*h.y)*(i.x*i.x+i.y*i.y)))}},jscv.geometry.DoubleTriArea=function(a,b,c){return-jscv.geometry.crossProduct(b,a,c)},jscv.geometry.inCircle=function(a,b,c,d){var e=jscv.geometry.DoubleTriArea;return(a.x*a.x+a.y*a.y)*e(b,c,d)-(b.x*b.x+b.y*b.y)*e(a,c,d)+(c.x*c.x+c.y*c.y)*e(a,b,d)-(d.x*d.x+d.y*d.y)*e(a,b,c)>0},jscv.geometry.ccw=function(a,b,c){return jcv.geometry.DoubleTriArea(a,b,c)>0},jscv.geometry.RightOf=function(a,b){return jscv.geometry.ccw(a,b.Dest(),b.Org())},jscv.geometry.LeftOf=function(a,b){return jscv.geometry.ccw(a,b.Org(),b.Dest())},jscv.geometry.OnEdge=function(a,b){var c=1e-9,d=jscv.geometry.distancePointToSegment(a,b.Org(),b.Dest());return c>d?!0:!1},jscv.imgproc.gaussianBlur=function(){var a,b,c,d=3,e=1;if(arguments.length<1||arguments.length>4)throw new Error("Incorrect number of arguments to gaussianBlur");a=arguments[0],b=d,c=e,void 0==arguments[1]||arguments[1]instanceof jscv.RunConfig_||(b=arguments[1]),void 0==arguments[2]||arguments[2]instanceof jscv.RunConfig_||(c=arguments[2]);var f=arguments[arguments.length-1]instanceof jscv.RunConfig_?arguments[arguments.length-1]:void 0,g=jscv.utility.processUserConfig_(f);return g==jscv.ENFORCE_PARALLEL?jscv.imgproc.gaussianBlurPar_(a,b,c):g==jscv.ENFORCE_SEQUENTIAL?jscv.imgproc.gaussianBlurSeq_(a,b,c):jscv.imgproc.gaussianBlurPar_(a,b,c)},jscv.imgproc.gaussianBlurSeq_=function(a,b,c){var d=jscv.imgproc.gaussianblurprivate.gaussianBlurKernel(b,c),e=new jscv.coredt.Matrix(b,b,1,jscv.float64,d),f=new jscv.coredt.Image(a.width,a.height,a.elementalType,a.colorMode);return f.data=jscv.math.convolveMat(a.data,e,jscv.ENFORCE_SEQUENTIAL),f},jscv.imgproc.gaussianBlurPar_=function(a,b,c){var d=jscv.imgproc.gaussianblurprivate.gaussianBlurKernel(b,c),e=new jscv.coredt.Matrix(b,b,1,jscv.float64,d),f=new jscv.coredt.Image(a.width,a.height,a.elementalType,a.colorMode);return f.data=jscv.math.convolveMat(a.data,e,jscv.ENFORCE_PARALLEL),f},jscv.imgproc.gaussianblurprivate={},jscv.imgproc.gaussianblurprivate.gaussianBlurKernel=function(a,b){function c(a,b,c){var d=Math.pow(f,-((a*a+b*b)/(2*c))),e=1/(2*Math.PI*c)*d;return e}for(var d=[],e=0,f=2.7182818284,g=Math.floor(a/2),h=0;a>h;h++){d[h]=[];for(var i=0;a>i;i++){var j;j=h>g&&g>i?d[a-h-1][i]:g>h&&i>g?d[h][a-i-1]:h>g&&i>g?d[a-h-1][a-i-1]:c(h-g,i-g,b),d[h][i]=j,e+=j}}for(var i=0;a>i;i++)for(var h=0;a>h;h++){var j=d[h][i];d[h][i]=j/e}return d},jscv.imgproc.boxBlur=function(a,b){var c=function(){for(var a=b*b,c=[],d=0;b>d;++d){c[d]=[];for(var e=0;b>e;++e)c[d][e]=1/a}return c},d=c(),e=new jscv.coredt.Matrix(b,b,1,jscv.float64,d),f=new jscv.coredt.Image(a.width,a.height,a.elementalType,a.colorMode);return f.data=jscv.math.convolveMat(a.data,e),f},jscv.imgproc.cannyEdgeDetect=function(a,b,c){var d=arguments.length,e=void 0,f=void 0;arguments[d-1]instanceof jscv.RunConfig_?(f=arguments[d-1],5==d&&(e=arguments[3])):4==d&&(e=arguments[3]);var g=jscv.utility.processUserConfig_(f);return g==jscv.NO_ENFORCE&&(parallelHint=a.width*a.height>=jscv.MIN_MATRIX_SIZE_FOR_PARALLEL?jscv.ENFORCE_PARALLEL:jscv.ENFORCE_SEQUENTIAL),g==jscv.ENFORCE_SEQUENTIAL?jscv.imgproc.cannyEdgeDetectSeq_(a,b,c,e):jscv.imgproc.cannyEdgeDetectPar_(a,b,c,e)},jscv.imgproc.cannyEdgeDetectSeq_=function(a,b,c,d){if(a.colorMode!=jscv.COLOR_GRAY)throw new Error("Input image is not grayscale. Only grayscale images are supported in jscv.imgproc.cannyEdgeDetect");(void 0==d||"boolean"!=typeof d)&&(d=!1);var e=0,f=0;if(b>0&&(e=b*b),c>0&&(f=c*c),e>f){var g=f;f=e,e=g}var h=a.height,i=a.width;d&&(a=jscv.imgproc.gaussianBlur(a));for(var j=jscv.imgproc.sobel(a.data,jscv.X_DIRECTION),k=jscv.imgproc.sobel(a.data,jscv.Y_DIRECTION),l=new jscv.coredt.Matrix(a.height,a.width,jscv.float64),m=j.data.length,n=0;m>n;n++){var o=j.data[n],p=k.data[n];l.data[n]=o*o+p*p}for(var q=function(a){return a>0?1:0>a?-1:0},r=0,s=1,t=2,u=3,v=Math.tan(Math.PI/8),w=Math.tan(3*Math.PI/8),x=1,y=2,z=0,A=new jscv.coredt.Matrix([h,i],jscv.uint8,z),B=new Array,n=0,C=0;h>C;C++)for(var D=0;i>D;D++)if(l.data[n]<e)A.data[n]=x,n++;else{var E,o=j.data[n],p=k.data[n];E=Math.abs(p)<Math.abs(o)*v?r:Math.abs(p)>Math.abs(o)*w?t:q(p)==q(o)?s:u;var F=!1;switch(E){case t:C-1>=0&&l.data[n]<=l.data[n-i]&&(F=!0),h>C+1&&l.data[n]<l.data[n+i]&&(F=!0);break;case s:C-1>=0&&D-1>=0&&l.data[n]<=l.data[n-i-1]&&(F=!0),h>C+1&&i>D+1&&l.data[n]<=l.data[n+i+1]&&(F=!0);break;case r:D-1>=0&&l.data[n]<=l.data[n-1]&&(F=!0),i>D+1&&l.data[n]<l.data[n+1]&&(F=!0);break;case u:C-1>=0&&i>D+1&&l.data[n]<=l.data[n-i+1]&&(F=!0),h>C+1&&D-1>=0&&l.data[n]<=l.data[n+i-1]&&(F=!0)}F?A.data[n]=x:(A.data[n]=z,l.data[n]>f&&(0>C-1||A.data[n-i]!=y||0>D-1||A.data[n-1]!=y)&&(A.data[n]=y,B.push([C,D]))),n++}for(var G=B.length-1;G>=0;){var H=B[G][0],I=B[G][1];G--;for(var J=Math.max(0,H-1);J<Math.min(H+2,h);J++)for(var K=Math.max(0,I-1);K<Math.min(I+2,i);K++)(J!=H||K!=I)&&A.data[J*i+K]==z&&(A.data[J*i+K]=y,G++,B[G]=[J,K])}var L=new jscv.coredt.Image(i,h,jscv.uint8Clamped,jscv.COLOR_GRAY),M=L.data.data;for(n=0;m>n;n++)M[n]=A.data[n]==y?255:0;return L},jscv.imgproc.cannyEdgeDetectPar_=function(a,b,c,d){if(a.colorMode!=jscv.COLOR_GRAY)throw new Error("Input image is not grayscale. Only grayscale images are supported in jscv.imgproc.cannyEdgeDetect");(void 0==d||"boolean"!=typeof d)&&(d=!1);var e=0,f=0;if(b>0&&(e=b*b),c>0&&(f=c*c),e>f){var g=f;f=e,e=g}var h=a.height,i=a.width;d&&(a=jscv.imgproc.gaussianBlur(a));var j=jscv.imgproc.sobel(a.data,jscv.X_DIRECTION),k=jscv.imgproc.sobel(a.data,jscv.Y_DIRECTION),l=new jscv.coredt.Matrix(a.height,a.width,jscv.float64),m=function(a,b){var c=j.data[b],d=k.data[b];return c*c+d*d};l.data=l.data.mapPar(m);var n=function(a){return a>0?1:0>a?-1:0},o=0,p=1,q=2,r=3,s=Math.tan(Math.PI/8),t=Math.tan(3*Math.PI/8),u=1,v=2,w=0,x=new jscv.coredt.Matrix([h,i],jscv.uint8),y=new jscv.coredt.Matrix([h,i],jscv.uint8,w),z=new Array,A=function(a,b){var c,d=j.data[b],e=k.data[b];return c=Math.abs(e)<Math.abs(d)*s?o:Math.abs(e)>Math.abs(d)*t?q:n(e)==n(d)?p:r};x.data=x.data.mapPar(A);for(var B=0,C=0;h>C;C++)for(var D=0;i>D;D++)if(l.data[B]<e)y.data[B]=u,B++;else{var E=x.data[B],F=!1;switch(E){case q:C-1>=0&&l.data[B]<=l.data[B-i]&&(F=!0),h>C+1&&l.data[B]<l.data[B+i]&&(F=!0);break;case p:C-1>=0&&D-1>=0&&l.data[B]<=l.data[B-i-1]&&(F=!0),h>C+1&&i>D+1&&l.data[B]<=l.data[B+i+1]&&(F=!0);break;case o:D-1>=0&&l.data[B]<=l.data[B-1]&&(F=!0),i>D+1&&l.data[B]<l.data[B+1]&&(F=!0);break;case r:C-1>=0&&i>D+1&&l.data[B]<=l.data[B-i+1]&&(F=!0),h>C+1&&D-1>=0&&l.data[B]<=l.data[B+i-1]&&(F=!0)}F?y.data[B]=u:(y.data[B]=w,l.data[B]>f&&(0>C-1||y.data[B-i]!=v||0>D-1||y.data[B-1]!=v)&&(y.data[B]=v,z.push([C,D]))),B++}for(var G=z.length-1;G>=0;){var H=z[G][0],I=z[G][1];G--;for(var J=Math.max(0,H-1);J<Math.min(H+2,h);J++)for(var K=Math.max(0,I-1);K<Math.min(I+2,i);K++)(J!=H||K!=I)&&y.data[J*i+K]==w&&(y.data[J*i+K]=v,G++,z[G]=[J,K])}var L=new jscv.coredt.Image(i,h,jscv.uint8Clamped,jscv.COLOR_GRAY),M=function(a){return a==v?255:0};return L.data.data=y.data.mapPar(M),L
},jscv.imgproc.convertRGBToHSV=function(a,b){if(a.colorMode!=jscv.COLOR_RGBA)throw new Error("Input image must be in the color space "+jscv.MAP_COLOR_MODE_TO_NAME[jscv.COLOR_RGBA]);var c=jscv.utility.processUserConfig_(b);return c==jscv.ENFORCE_PARALLEL?jscv.imgproc.convertRGBToHSVPar_(a):c==jscv.ENFORCE_SEQUENTIAL?jscv.imgproc.convertRGBToHSVSeq_(a):jscv.imgproc.convertRGBToHSVSeq_(a)},jscv.imgproc.convertRGBToHSVSeq_=function(a){for(var b=8*a.elementalType.byteLength,c=(1<<b)-1,d=new jscv.coredt.Image(a.width,a.height,jscv.float64,jscv.COLOR_HSV),e=a.data.data,f=d.data.data,g=e.length,h=a.nChannel,i=0,j=d.nChannel,k=0;g>k;k+=h){var l=1*e[k]/c,m=1*e[k+1]/c,n=1*e[k+2]/c,o=Math.max(l,m,n),p=o-Math.min(l,m,n),q=0,r=0;jscv.utility.isZero(o)||(q=p/o),jscv.utility.isZero(p)||(r=jscv.utility.isZero(o-l)?60*(m-n)/p:jscv.utility.isZero(o-m)?120+60*(n-l)/p:240+60*(l-m)/p,0>r&&(r+=360)),f[i]=r,f[i+1]=q,f[i+2]=o,i+=j}return d},jscv.imgproc.convertRGBToHSVPar_=function(a){var b=8*a.elementalType.byteLength,c=(1<<b)-1;a.nChannel;var d=a.data.data,e=new jscv.coredt.Image(a.width,a.height,jscv.float64,jscv.COLOR_HSV),f=function(a,b){var e=parseInt(b/3),f=b-3*e,g=4*e,h=1*d[g]/c,i=1*d[g+1]/c,j=1*d[g+2]/c,k=Math.max(h,i,j);if(2==f)return k;var l=k-Math.min(h,i,j),m=0,n=0;return jscv.utility.isZero(k)||(m=l/k),1==f?m:(jscv.utility.isZero(l)||(n=jscv.utility.isZero(k-h)?60*(i-j)/l:jscv.utility.isZero(k-i)?120+60*(j-h)/l:240+60*(h-i)/l,0>n&&(n+=360)),n)};return e.data.data=e.data.data.mapPar(1,f),e},jscv.imgproc.convertHSVToRGBA=function(a,b){var c=jscv.utility.processUserConfig_(b);return c==jscv.ENFORCE_PARALLEL?jscv.imgproc.convertHSVToRGBAPar_(a):c==jscv.ENFORCE_SEQUENTIAL?jscv.imgproc.convertHSVToRGBASeq_(a):jscv.imgproc.convertHSVToRGBASeq_(a)},jscv.imgproc.convertHSVToRGBASeq_=function(a){if(a.colorMode!=jscv.COLOR_HSV)throw new Error("Input image must be in the color space "+jscv.MAP_COLOR_MODE_TO_NAME[jscv.COLOR_HSV]);for(var b=new jscv.coredt.Image(a.width,a.height,jscv.float32,jscv.COLOR_RGBA),c=a.data.data,d=b.data.data,e=c.length,f=a.nChannel,g=0,h=b.nChannel,i=0;e>i;i+=f){var j=c[i],k=c[i+1],l=c[i+2],m=l*k,n=j/60,o=Math.floor(n),p=n-o,q=m*(1-Math.abs(o%2+p-1)),r=l-m;switch(o){case 0:d[g]=255*(m+r),d[g+1]=255*(q+r),d[g+2]=255*r;break;case 1:d[g]=255*(q+r),d[g+1]=255*(m+r),d[g+2]=255*r;break;case 2:d[g]=255*r,d[g+1]=255*(m+r),d[g+2]=255*(q+r);break;case 3:d[g]=255*r,d[g+1]=255*(q+r),d[g+2]=255*(m+r);break;case 4:d[g]=255*(q+r),d[g+1]=255*r,d[g+2]=255*(m+r);break;case 5:d[g]=255*(m+r),d[g+1]=255*r,d[g+2]=255*(q+r);break;default:d[g]=d[g+1]=d[g+2]=255*r}d[g+3]=255,g+=h}return b},jscv.imgproc.convertHSVToRGBAPar_=function(a){if(a.colorMode!=jscv.COLOR_HSV)throw new Error("Input image must be in the color space "+jscv.MAP_COLOR_MODE_TO_NAME[jscv.COLOR_HSV]);var b=a.data.data,c=function(a,c,d,e){var f=3*c,g=b[f],h=b[f+1],i=b[f+2],j=i*h,k=g/60,l=Math.floor(k),m=k-l,n=j*(1-Math.abs(l%2+m-1)),o=i-j;switch(l){case 0:e[0]=255*(j+o),e[1]=255*(n+o),e[2]=255*o,e[3]=255;break;case 1:e[0]=255*(n+o),e[1]=255*(j+o),e[2]=255*o,e[3]=255;break;case 2:e[0]=255*o,e[1]=255*(j+o),e[2]=255*(n+o),e[3]=255;break;case 3:e[0]=255*o,e[1]=255*(n+o),e[2]=255*(j+o),e[3]=255;break;case 4:e[0]=255*(n+o),e[1]=255*o,e[2]=255*(j+o),e[3]=255;break;case 5:e[0]=255*(j+o),e[1]=255*o,e[2]=255*(n+o),e[3]=255;break;default:e[0]=255*o,e[1]=255*o,e[2]=255*o,e[3]=255,rgb=[o,o,o,1]}},d=new jscv.coredt.Matrix([a.height*a.width,4],jscv.float64),e=d.getNdView(),f=e.mapPar(1,c);return new jscv.coredt.Image(a.width,a.height,jscv.float64,jscv.COLOR_RGBA,TypedObject.storage(f).buffer)},jscv.imgproc.convertRGBAToGray=function(a,b){if(a.colorMode!=jscv.COLOR_RGBA)throw new Error("Input image must be in the color space "+jscv.MAP_COLOR_MODE_TO_NAME[jscv.COLOR_RGBA]);var c=jscv.utility.processUserConfig_(b);return c==jscv.ENFORCE_PARALLEL?jscv.imgproc.convertRGBAToGrayPar_(a):c==jscv.ENFORCE_SEQUENTIAL?jscv.imgproc.convertRGBAToGraySeq_(a):jscv.imgproc.convertRGBAToGraySeq_(a)},jscv.imgproc.convertRGBAToGraySeq_=function(a){for(var b=new jscv.coredt.Image(a.width,a.height,a.elementalType,jscv.COLOR_GRAY),c=0,d=a.data.data.length,e=a.data.data,f=0,g=0;d>g;g+=4)c=jscv.utility.clampValue(.21*e[g]+.71*e[g+1]+.07*e[g+2],a.elementalType),b.data.data[f]=c,f++;return b},jscv.imgproc.convertRGBAToGrayPar_=function(a){var b=a.data.data,c=new jscv.coredt.Matrix(a.height,a.width,a.elementalType),d=function(c,d){var e=4*d,f=jscv.utility.clampValue(.21*b[e]+.71*b[e+1]+.07*b[e+2],a.elementalType);return f},e=c.data.mapPar(1,d);return new jscv.coredt.Image(a.width,a.height,a.elementalType,jscv.COLOR_GRAY,TypedObject.storage(e).buffer)},jscv.imgproc.convertGrayToRGBA=function(a,b){if(a.colorMode!=jscv.COLOR_GRAY)throw new Error("Input image must be in the color space "+jscv.MAP_COLOR_MODE_TO_NAME[jscv.COLOR_GRAY]);var c=jscv.utility.processUserConfig_(b);return c==jscv.ENFORCE_PARALLEL?jscv.imgproc.convertGrayToRGBAPar_(a):c==jscv.ENFORCE_SEQUENTIAL?jscv.imgproc.convertGrayToRGBASeq_(a):jscv.imgproc.convertGrayToRGBASeq_(a)},jscv.imgproc.convertGrayToRGBASeq_=function(a){for(var b=new jscv.coredt.Image(a.width,a.height,a.elementalType,jscv.COLOR_RGBA),c=b.data.data,d=a.data.data,e=0,f=d.length,g=0;f>g;g++){var h=d[g];c[e]=h,c[e+1]=h,c[e+2]=h,c[e+3]=255,e+=4}return b},jscv.imgproc.convertGrayToRGBAPar_=function(a){var b=a.data.data,c=function(a,c,d,e){e[0]=e[1]=e[2]=b[c],e[3]=255},d=new jscv.coredt.Matrix([a.height*a.width,4],a.elementalType),e=d.getNdView(),f=e.mapPar(1,c);return new jscv.coredt.Image(a.width,a.height,a.elementalType,jscv.COLOR_RGBA,TypedObject.storage(f).buffer)},jscv.COLOR_SPACE_CONVERTER=[],jscv.COLOR_SPACE_CONVERTER[jscv.COLOR_GRAY]=[],jscv.COLOR_SPACE_CONVERTER[jscv.COLOR_GRAY][jscv.COLOR_RGBA]=jscv.imgproc.convertGrayToRGBA,jscv.COLOR_SPACE_CONVERTER[jscv.COLOR_RGBA]=[],jscv.COLOR_SPACE_CONVERTER[jscv.COLOR_RGBA][jscv.COLOR_GRAY]=jscv.imgproc.convertRGBAToGray,jscv.COLOR_SPACE_CONVERTER[jscv.COLOR_RGBA][jscv.COLOR_HSV]=jscv.imgproc.convertRGBToHSV,jscv.COLOR_SPACE_CONVERTER[jscv.COLOR_HSV]=[],jscv.COLOR_SPACE_CONVERTER[jscv.COLOR_HSV][jscv.COLOR_RGBA]=jscv.imgproc.convertHSVToRGB,jscv.imgproc.convertColor=function(a,b,c){var d=a.colorMode;if(d==b)return new jscv.coredt.Image(a);if("function"==typeof jscv.COLOR_SPACE_CONVERTER[d][b])return jscv.COLOR_SPACE_CONVERTER[d][b](a,c);throw new Error("There is no supported conversion from "+jscv.MAP_COLOR_MODE_TO_NAME[d]+" to "+jscv.MAP_COLOR_MODE_TO_NAME[b])},jscv.imgproc.Bound=function(){var a=function(){if(this.limits=arguments,0!=this.limits.length%2)throw"Must provide minimum and maximum for all channels.";this.pixelCompare=function(a){if(2==this.limits.length)return a<this.limits[0]||a>this.limits[1]?!1:!0;for(var b=0;b<this.limits.length;b+=2)if(a[b/2]<this.limits[b]||a[b/2]>this.limits[b+1])return!1;return!0}};return a}(),jscv.imgproc.colorThreshold=function(a,b,c,d){var e=jscv.utility.processUserConfig_(d);return e==jscv.NO_ENFORCE&&(e=a.width*a.height*a.nChannel>=jscv.MIN_MATRIX_SIZE_FOR_PARALLEL?jscv.ENFORCE_PARALLEL:jscv.ENFORCE_SEQUENTIAL),e==jscv.ENFORCE_PARALLEL?jscv.imgproc.colorThresholdPar_(a,b,c):jscv.imgproc.colorThresholdSeq_(a,b,c)},jscv.imgproc.colorThresholdSeq_=function(a,b,c){for(var d=new jscv.coredt.Image(a.width,a.height,jscv.uint8,jscv.COLOR_GRAY),e=jscv.imgproc.convertColor(a,c),f=e.data.data,g=d.data.data,h=f.length,i=e.nChannel,j=[],k=0,l=0;h>l;l+=i){for(var m=0;i>m;m++)j[m]=f[l+m];for(var n=0;n<b.length;n++)if(b[n].pixelCompare(j)){g[k]=255;break}k++}return d},jscv.imgproc.colorThresholdPar_=function(a,b,c){var d=new jscv.coredt.Image(a.width,a.height,jscv.uint8,jscv.COLOR_GRAY),e=jscv.imgproc.convertColor(a,c),f=function(a){for(var c=0;c<b.length;c++)if(b[c].pixelCompare(a))return 255;return 0},g=jscv.coredt.getNdArrayType([e.width*e.height,e.nChannel],e.elementalType),h=jscv.coredt.getNdArrayType([e.width*e.height],jscv.uint8),i=TypedObject.storage(e.data.data).buffer,j=new g(i),k=h.fromPar(j,f);return d.data.data=k,d},jscv.imgproc.SCHARR_KERNEL_X_=[[-3,0,3],[-10,0,10],[-3,0,3]],jscv.imgproc.SCHARR_KERNEL_Y_=[[-3,-10,-3],[0,0,0],[3,10,3]],jscv.imgproc.scharr=function(a,b){var c=!1;a instanceof jscv.coredt.Image&&(c=!0);var d=a;c&&(d=a.data);var e=2,f=jscv.BORDER_REPLICATE;e<arguments.length&&jscv.SUPPORT_BORDER_TYPE.indexOf(arguments[e])>=0&&(f=arguments[e],e++);var g=0;f==jscv.BORDER_CONSTANT&&e<arguments.length&&"number"==typeof arguments[e]&&(g=jscv.utility.clampValue(g,img.elementalType)),arguments[arguments.length-1]instanceof jscv.RunConfig_?arguments[arguments.length-1]:void 0;var h;h=b==jscv.X_DIRECTION?new jscv.coredt.Matrix(jscv.float64,jscv.imgproc.SCHARR_KERNEL_X_):new jscv.coredt.Matrix(jscv.float64,jscv.imgproc.SCHARR_KERNEL_Y_);var i=[0];if(d.depth>1)if(c&&a.colorMode==jscv.COLOR_RGBA)i=[0,1,2];else for(var j=1;j<d.depth;j++)i.push(j);var k=jscv.math.convolveMat(d,i,h,d.elementalType,f,g);if(c){var l=new jscv.coredt.Image(a.width,a.height,a.elementalType,a.colorMode);return l.data=k,l}return k},jscv.imgproc.SOBEL_KERNEL_X_=[[1,0,-1],[2,0,-2],[1,0,-1]],jscv.imgproc.SOBEL_KERNEL_Y_=[[1,2,1],[0,0,0],[-1,-2,-1]],jscv.imgproc.sobel=function(a,b){var c=!1;a instanceof jscv.coredt.Image&&(c=!0);var d=a;c&&(d=a.data);var e=2,f=jscv.BORDER_REPLICATE;e<arguments.length&&jscv.SUPPORT_BORDER_TYPE.indexOf(arguments[e])>=0&&(f=arguments[e],e++);var g=0;f==jscv.BORDER_CONSTANT&&e<arguments.length&&"number"==typeof arguments[e]&&(g=jscv.utility.clampValue(g,img.elementalType));var h,i=arguments[arguments.length-1]instanceof jscv.RunConfig_?arguments[arguments.length-1]:void 0;h=b==jscv.X_DIRECTION?new jscv.coredt.Matrix(jscv.float64,jscv.imgproc.SOBEL_KERNEL_X_):new jscv.coredt.Matrix(jscv.float64,jscv.imgproc.SOBEL_KERNEL_Y_);var j=[0];if(d.depth>1)if(c&&a.colorMode==jscv.COLOR_RGBA)j=[0,1,2];else for(var k=1;k<d.depth;k++)j.push(k);var l=jscv.math.convolveMat(d,j,h,d.elementalType,f,g,i);if(c){var m=new jscv.coredt.Image(a.width,a.height,a.elementalType,a.colorMode);return m.data=l,m}return l},jscv.imgproc.flip=function(a,b,c){if(0!=b&&1!=b&&2!=b)throw new Error("Invalid input argument values");var d=jscv.utility.processUserConfig_(c);return d==jscv.NO_ENFORCE&&(d=a.height*a.width*a.nChannel>=jscv.MIN_MATRIX_SIZE_FOR_PARALLEL?jscv.ENFORCE_PARALLEL:jscv.ENFORCE_SEQUENTIAL),d==jscv.ENFORCE_PARALLEL?jscv.imgproc.flipPar_(a,b):jscv.imgproc.flipSeq_(a,b)},jscv.imgproc.flipSeq_=function(a,b){var c=new jscv.coredt.Image(a.width,a.height,a.elementalType,a.colorMode),d=a.height,e=a.width,f=a.nChannel,g=a.data.data,h=c.data.data,i=c.data.stride;switch(b){case 0:for(var j=0,k=(e-1)*i[1],l=0;d>l;l++){for(var m=k,n=0;e>n;n++){if(1==f)h[m]=g[j],j++;else for(var o=0;f>o;o++)h[m+o]=g[j],j++;m-=i[1]}k+=i[0]}break;case 1:for(var j=0,k=(d-1)*i[0],l=0;d>l;l++){for(var m=k,n=0;e>n;n++){if(1==f)h[m]=g[j],j++;else for(var o=0;f>o;o++)h[m+o]=g[j],j++;m+=i[1]}k-=i[0]}break;case 2:for(var j=0,k=(d-1)*i[0]+(e-1)*i[1],l=0;d>l;l++){for(var m=k,n=0;e>n;n++){if(1==f)h[m]=g[j],j++;else for(var o=0;f>o;o++)h[m+o]=g[j],j++;m-=i[1]}k-=i[0]}}return c},jscv.imgproc.flipPar_=function(a,b){var c,d=a.height,e=a.width,f=a.nChannel,g=a.data.getNdView(),h=function(a,c,f){switch(b){case 0:return g[c][e-f-1];case 1:return g[d-c-1][f];case 2:return g[d-c-1][e-f-1]}},i=function(a,c,f,h){switch(b){case 0:return g[c][e-f-1][h];case 1:return g[d-c-1][f][h];case 2:return g[d-c-1][e-f-1][h]}};c=1==f?g.mapPar(2,h):g.mapPar(3,i);var j=new jscv.coredt.Image(a.width,a.height,a.elementalType,a.colorMode,TypedObject.storage(c).buffer);return j},jscv.imgproc.NEIGHBOR_DIRECTION_=[[0,1],[0,-1],[-1,0],[1,0],[1,1],[1,-1],[-1,1],[-1,-1]],jscv.imgproc.floodFillBinary=function(a,b){if(a.colorMode!=jscv.COLOR_GRAY)throw new Error("The input image is not grayscale. Only grayscale images are supported in jscv.imgproc.floodFillBinary");var c=[];if(b instanceof jscv.coredt.Point)c.push([b.y,b.x]);else if(b instanceof Array&&b.length>0)if(b[0]instanceof jscv.coredt.Point)for(var d=0;d<b.length;d++)c.push([b[d].y,b[d].x]);else if(b[0]instanceof Array)for(var d=0;d<b.length;d++)b[d]instanceof Array&&b[d].length>=2&&"number"==typeof b[d][0]&&"number"==typeof b[d][1]&&c.push([b[d][0],b[d][1]]);else b.length>=2&&"number"==typeof b[0]&&"number"==typeof b[1]&&c.push([b[0],b[1]]);var e=void 0,f=jscv.EIGHT_CONNECTED,g=!1,h=2;arguments.length>h&&"number"==typeof arguments[h]&&(e=jscv.utility.clampValue(arguments[h],a.elementalType),h++),arguments.length>h&&"string"==typeof arguments[h]&&jscv.SUPPORT_CONNECTIVITY_TYPE.indexOf(arguments[h])>=0&&(f=arguments[h],h++),arguments.length>h&&"boolean"==typeof arguments[h]&&(g=arguments[h],h++);var i=a.height,j=a.width,k=a.data.data,l=k.length;if(void 0==e){e=k[0];for(var d=0;l>d;d++)k[d]>e&&(e=k[d])}for(var m=[],d=0;d<c.length;d++){var n=c[d][0],o=c[d][1];if(!(0>n||0>o||n>=i||o>=j)){var p=n*j+o;jscv.utility.isZero(k[p])&&(c[d].push(p),m.push(c[d]))}}var q=new jscv.coredt.Image(a),r=q.data.data,s=new jscv.coredt.Matrix([i,j],jscv.uint8,0),t=s.data,u=8;f==jscv.FOUR_CONNECTED&&(u=4);for(var v=m.length-1;v>=0;){var w=m[v][0],x=m[v][1],y=m[v][2];if(v--,!t[y]){r[y]=e,t[y]=1;for(var z=0;u>z;z++){var A=w+jscv.imgproc.NEIGHBOR_DIRECTION_[z][0],B=x+jscv.imgproc.NEIGHBOR_DIRECTION_[z][1],C=A*j+B;0>A||0>B||A>=i||B>=j||!jscv.utility.isZero(k[C]||t[C])||(v++,m[v]=[A,B,C])}}}return g?[q,s]:q},jscv.imgproc.fillHoles=function(a){if(a.colorMode!=jscv.COLOR_GRAY)throw new Error("The input image is not grayscale. Only grayscale images are supported in jscv.imgproc.fillHoles");var b=void 0,c=jscv.EIGHT_CONNECTED,d=!1,e=1;arguments.length>e&&"number"==typeof arguments[e]&&(b=jscv.utility.clampValue(arguments[e],a.elementalType),e++),arguments.length>e&&"string"==typeof arguments[e]&&jscv.SUPPORT_CONNECTIVITY_TYPE.indexOf(arguments[e])>=0&&(c=arguments[e],e++),arguments.length>e&&"boolean"==typeof arguments[e]&&(d=arguments[e],e++);var f=a.height,g=a.width,h=a.data.data,i=h.length;if(void 0==b){b=h[0];for(var j=0;i>j;j++)h[j]>b&&(b=h[j])}for(var k=[],l=0,m=0;f>m;m+=f-1){for(var j=l,n=0;g>n;n++)jscv.utility.isZero(h[j])&&k.push([m,n]),j++;l+=(f-1)*g}l=0;for(var n=0;g>n;n+=g-1){for(var j=l,m=1;f-1>m;m++)jscv.utility.isZero(h[j])&&k.push([m,n]),j+=g;l+=g-1}for(var o=jscv.imgproc.floodFillBinary(a,k,b,c),p=new jscv.coredt.Matrix([f,g],jscv.uint8,0),q=o.data.data,r=p.data,j=0;i>j;j++)jscv.utility.isZero(q[j])?(q[j]=b,r[j]=1):q[j]=0;var s=jscv.imgproc.bitwiseOrImg(a,o);return d?[s,p]:s},jscv.imgproc.floodFill=function(a,b,c){var d,e,f="The input arguments are not supported by jscv.imgproc.floodFill",g=a.height,h=a.width,i=a.nChannel;if(b instanceof jscv.coredt.Point)d=b.y,e=b.x;else{if(!(b instanceof Array))throw new Error(f);if(b.length<2)throw new Error(f);d=b[0],e=b[1]}if(c instanceof Array&&1==i&&(c=c.length<1?0:c[0]),c instanceof Array){if(3==c.length&&a.colorMode==jscv.COLOR_RGBA&&c.push(255),c.length<i)throw new Error(f)}else{if("number"!=typeof c)throw new Error(f);if(1!=i)throw new Error(f)}if(1==i)c=jscv.utility.clampValue(c,a.elementalType);else for(var j=0;j<c.length;j++)c[j]=jscv.utility.clampValue(c[j],a.elementalType);var k=3,l=0,m=0;if(i>1)for(l=[],m=[];l.length<i;)l.push(0),m.push(0);arguments.length>k&&("number"==typeof arguments[k]||arguments[j]instanceof Array)&&(l=arguments[k],k++),arguments.length>k&&("number"==typeof arguments[k]||arguments[j]instanceof Array)&&(m=arguments[k],k++),i>1?("number"==typeof m&&(m=[m]),"number"==typeof l&&(l=[l]),0==m.length&&(m=[0]),0==l.length&&(l=[0])):1==i&&(m instanceof Array&&(m=m.length>0?m[0]:0),l instanceof Array&&(l=l.length>0?l[0]:0));var n=jscv.EIGHT_CONNECTED;arguments.length>k&&"string"==typeof arguments[k]&&(n=arguments[k],jscv.SUPPORT_CONNECTIVITY_TYPE.indexOf(n)<0&&(n=jscv.EIGHT_CONNECTED),k++);var o=!1;arguments.length>k&&arguments[k]instanceof Object&&(JSON.stringify(arguments[k])==JSON.stringify(jscv.FLOODFILL_COMPARE_SEED)&&(o=!0),k++);var p=arguments[k];"boolean"!=typeof p&&(p=!1);var q=function(a,b,c,d,e){if(1==a.depth)return a.data[b]<a.data[c]-d?!1:a.data[b]>a.data[c]+e?!1:!0;for(var f=Math.min(d.length,e.length,a.depth),g=0;f>g;g++){if(a.data[b+g]<a.data[c+g]-d[g])return!1;if(a.data[b+g]>a.data[c+g]+e[g])return!1}return!0},r=new jscv.coredt.Matrix([g,h],jscv.uint8,0),s=new jscv.coredt.Image(a),t=s.data.data,u=a.data,v=r.data,w=s.data.stride;n==jscv.FOUR_CONNECTED&&(A=4);var x=new Array;0>d||0>e||d>=g||e>=h||x.push([d,e,d*w[0]+e*w[1],d*h+e]);for(var y=d*w[0]+e*w[1],z=x.length-1,A=8;z>=0;){var B=x[z][0],C=x[z][1],D=x[z][2],E=x[z][3];if(z--,!v[D]){if(v[E]=1,1==i)t[D]=c;else for(var F=0;i>F;F++)t[D+F]=c[F];for(var G=0;A>G;G++){var H=B+jscv.imgproc.NEIGHBOR_DIRECTION_[G][0],I=C+jscv.imgproc.NEIGHBOR_DIRECTION_[G][1],J=H*w[0]+I*w[1],K=H*h+I;if(!(0>H||0>I||H>=g||I>=h||v[K])){var L=D;o&&(L=y),q(u,J,L,l,m)&&(z++,x[z]=[H,I,J,K])}}}}return p?[s,r]:s},jscv.imgproc.getElementwiseThresholdFunction_=function(a,b,c){return a==jscv.THRESH_BINARY_INV?function(a){return a>b?0:c}:a==jscv.THRESH_TRUNC?function(a){return a>b?c:a}:a==jscv.THRESH_TOZERO?function(a){return a>b?a:0}:a==jscv.THRESH_TOZERO_INV?function(a){return a>b?0:a}:function(a){return a>b?c:0}},jscv.imgproc.getElementwiseAdaptiveThresholdFunction_=function(a,b,c){return a==jscv.THRESH_BINARY_INV?function(a,d){return a>b.data[d]?0:c}:a==jscv.THRESH_TRUNC?function(a,d){return a>b.data[d]?c:a}:a==jscv.THRESH_TOZERO?function(a,c){return a>b.data[c]?a:0}:a==jscv.THRESH_TOZERO_INV?function(a,c){return a>b.data[c]?0:a}:function(a,d){return a>b.data[d]?c:0}},jscv.imgproc.threshold=function(a){if(a.colorMode!=jscv.COLOR_GRAY)throw new Error("jscv.imgproc.threshold applies to only grayscale images!");var b=1,c=jscv.THRESH_BINARY;"string"==typeof arguments[b]&&(c=arguments[b],b++),jscv.SUPPORT_THRESH_TYPE.indexOf(c)<0&&(c=jscv.THRESH_BINARY);var d=arguments[b],e=void 0;if((c==jscv.THRESH_BINARY||c==jscv.THRESH_BINARY_INV||c==jscv.THRESH_TRUNC)&&(arguments.length>b+1&&"number"==typeof arguments[b+1]&&(e=jscv.utility.clampValue(arguments[b+1],a.elementalType)),void 0==e)){var f=a.elementalType;f==jscv.float32&&(f=jscv.int32),f==jscv.float64&&(f=jscv.int64),e=jscv.utility.getMaxIntVal(f)}var g=void 0;arguments[arguments.length-1]instanceof jscv.RunConfig_&&(g=arguments[arguments.length-1]);var h=jscv.utility.processUserConfig_(g);if(h==jscv.NO_ENFORCE&&(h=a.width*a.height>=jscv.MIN_MATRIX_SIZE_FOR_PARALLEL?jscv.ENFORCE_PARALLEL:jscv.ENFORCE_SEQUENTIAL),"number"!=typeof d){if(!(d instanceof Object&&JSON.stringify(d)==JSON.stringify(jscv.USE_OTSU)))throw new Error("Invalid value for threshold value");d=jscv.imgproc.otsuThreshValue(a)}return d=jscv.utility.clampValue(d,a.elementalType),h==jscv.ENFORCE_SEQUENTIAL?jscv.imgproc.thresholdSeq_(a,c,d,e):jscv.imgproc.thresholdPar_(a,c,d,e)},jscv.imgproc.thresholdSeq_=function(a,b,c,d){for(var e=new jscv.coredt.Image(a.width,a.height,a.elementalType,a.colorMode),f=jscv.imgproc.getElementwiseThresholdFunction_(b,c,d),g=e.data.data,h=a.data.data,i=h.length,j=0;i>j;j++)g[j]=f(h[j]);return e},jscv.imgproc.thresholdPar_=function(a,b,c,d){var e=jscv.imgproc.getElementwiseThresholdFunction_(b,c,d),f=new jscv.coredt.Image(a.width,a.height,a.elementalType,a.colorMode);return f.data.data=a.data.data.mapPar(e),f},jscv.imgproc.otsuThreshValue=function(a){if(a.colorMode!=jscv.COLOR_GRAY||a.elementalType.isFloat||a.elementalType.byteLength<<3>16)throw new Error("jscv.imgproc.otsuThreshVal applies to only 8-bit or 16-bit integral grayscale images!");for(var b=function(a){for(var b=jscv.utility.getMaxIntVal(a.elementalType),c=new Uint32Array(b+1),d=0;b>=d;d++)c[d]=0;for(var e=a.data.data,f=e.length,g=0;f>g;g++)c[e[g]]++;return c},c=b(a),d=a.width*a.height,e=0,f=0;f<c.length;f++)e+=f*c[f];for(var g=0,h=0,i=0,j=0,k=0,l=0;l<c.length;l++)if(h+=c[l],0!=h){if(i=d-h,0==i)break;g+=l*c[l];var m=g/h,n=(e-g)/i,o=h*i*(m-n)*(m-n);o>j&&(j=o,k=l)}return k},jscv.imgproc.adaptiveThreshold=function(a){if(a.colorMode!=jscv.COLOR_GRAY)throw new Error("jscv.imgproc.threshold applies to only grayscale images!");var b=jscv.THRESH_BINARY,c=jscv.ADAPTIVE_THRESH_MEAN,d=1;"string"==typeof arguments[d]&&(b=arguments[d],d++),arguments[d]instanceof Object&&!(arguments[d]instanceof jscv.RunConfig_)&&(c=arguments[d],d++),jscv.SUPPORT_THRESH_TYPE.indexOf(b)<0&&(b=jscv.THRESH_BINARY);for(var e=!1,f=JSON.stringify(c),g=0;g<jscv.SUPPORT_ADAPTIVE_METHOD.length;g++)if(f==JSON.stringify(jscv.SUPPORT_ADAPTIVE_METHOD[g])){e=!0;break}e||(c=jscv.ADAPTIVE_THRESH_MEAN);var h=void 0;if(b==jscv.THRESH_BINARY||b==jscv.THRESH_BINARY_INV||b==jscv.THRESH_TRUNC)if(d<arguments.length&&(h=arguments[d],d++),void 0==h){var i=a.elementalType;(a.elementalType==jscv.float32||a.elementalType==jscv.float64)&&(i=jscv.int32),h=jscv.utility.getMaxIntVal(a.elementalType)}else jscv.utility.isFloatType(a.elementalType)||(h=Math.min(h,jscv.utility.getMaxIntVal(a.elementalType)));var j;d<arguments.length?(j=arguments[d],d++):j=3,j&!1&&j++;var k;k=d<arguments.length?arguments[d]:5;var l=void 0;arguments[arguments.length-1]instanceof jscv.RunConfig_&&(l=arguments[arguments.length-1]);var m=jscv.utility.processUserConfig_(l);m==jscv.NO_ENFORCE&&(m=a.width*a.height>=jscv.MIN_MATRIX_SIZE_FOR_PARALLEL?jscv.ENFORCE_PARALLEL:jscv.ENFORCE_SEQUENTIAL);var n=jscv.imgproc.calculateAdaptiveThresholdMat_(a.data,j,k,c,m),o=jscv.imgproc.getElementwiseAdaptiveThresholdFunction_(b,n,h),p=a.width*a.height,q=new jscv.coredt.Image(a.width,a.height,a.elementalType,a.colorMode),r=a.data.data;if(m==jscv.ENFORCE_SEQUENTIAL)for(var s=q.data.data,t=0;p>t;t++)s[t]=o(r[t],t);else q.data.data=r.mapPar(o);return q},jscv.imgproc.calculateAdaptiveThresholdMat_=function(a,b,c,d,e){var f=a.nRow,g=a.nCol,h=b>>1,i=a.data,j=new jscv.coredt.Matrix(a.shape,jscv.float64);if(e==jscv.ENFORCE_SEQUENTIAL){var k=function(a,b,d,e){for(var j=0,k=0,l=-(h+1)*g,m=-h;h>=m;m++){for(var n=l,o=-h;h>=o;o++){var p=b+m,q=d+o;0>p||0>q||p>=f||q>=g||(j+=i[e+n],k++,n++)}l+=g}return j/k+c},l=function(a,b,d,e){var j=.3*(h-1)+.8;j*=j;for(var k,l=0,m=0,n=-(h+1)*g,o=-h;h>=o;o++){for(var p=n,q=-h;h>=q;q++){var r=b+o,s=d+q;0>r||0>s||r>=f||s>=g||(k=1/(2*Math.PI*j)*Math.pow(Math.E,-(o*o+q*q)/(2*j)),l+=k*i[e+p],m+=k)}n+=g}return l/m+c},m=k;JSON.stringify(d)==JSON.stringify(jscv.ADAPTIVE_THRESH_GAUSSIAN)&&(m=l);for(var n=0,o=j.data,p=0;f>p;p++)for(var q=0;g>q;q++)o[n]=m(i[n],p,q,n),n++}else{var r=j.getNdView(),s=a.getNdView(),t=function(a,b,d){for(var e=0,i=0,j=-h;h>=j;j++)for(var k=-h;h>=k;k++){var l=b+j,m=d+k;0>l||0>m||l>=f||m>=g||(e+=s[l][m],i++)}return e/i+c},u=function(a,b,d){var e=.3*(h-1)+.8;e*=e;for(var i,j=0,k=0,l=-h;h>=l;l++)for(var m=-h;h>=m;m++){var n=b+l,o=d+m;0>n||0>o||n>=f||o>=g||(i=1/(2*Math.PI*e)*Math.pow(Math.E,-(l*l+m*m)/(2*e)),j+=i*s[n][o],k+=i)}return j/k+c},m=t;JSON.stringify(d)==JSON.stringify(jscv.ADAPTIVE_THRESH_GAUSSIAN)&&(m=u);var v=r.mapPar(2,m);j=new jscv.coredt.Matrix(a.shape,jscv.float64,TypedObject.storage(v).buffer)}return j},jscv.imgproc.equalizeHist=function(a){var b=void 0;arguments[arguments.length-1]instanceof jscv.RunConfig_&&(b=arguments[arguments.length-1]);var c=jscv.utility.processUserConfig_(b);return c==jscv.NO_ENFORCE&&(c=a.width*a.height>=jscv.MIN_MATRIX_SIZE_FOR_PARALLEL?jscv.ENFORCE_PARALLEL:jscv.ENFORCE_SEQUENTIAL),c==jscv.ENFORCE_SEQUENTIAL?jscv.imgproc.equalizeHistSeq_(a):jscv.imgproc.equalizeHistPar_(a)},jscv.imgproc.equalizeHistSeq_=function(a){a.colorMode!=jscv.COLOR_GRAY&&(a=jscv.imgproc.convertRGBAToGray(a));for(var b=257,c=a.data.data,d=c.length,e=[],f=[],g=0;256>g;g++)e.push(0),f.push(0);for(var h=0;d>h;h++)c[h]<b&&(b=c[h]),e[c[h]]++;f[0]=e[0];for(var h=1;256>h;h++)f[h]=f[h-1]+e[h];for(var i=new jscv.coredt.Image(a),j=i.data.data,h=0;d>h;h++)j[h]=255*((f[c[h]]-f[b])/(d-f[b]));return i},jscv.imgproc.equalizeHistPar_=function(a){a.colorMode!=jscv.COLOR_GRAY&&(a=jscv.imgproc.convertRGBAToGray(a));var b=257,c=a.data.data,d=c.length,e=[],f=c.mapPar(function(){return 1});f=Array.apply([],f);var g=function(a,b){return a+b},h=Array.apply([],c),i=f.scatterPar(h,0,g);e[0]=i[0];for(var j=1;256>j;j++)e[j]=e[j-1]+i[j];for(var k=0;256>k;k++)if(i[k]>0){b=k;break}var l=new jscv.coredt.Image(a),m=l.data.data,n=function(a,f){return 255*((e[c[f]]-e[b])/(d-e[b]))};return l.data.data=m.mapPar(n),l},jscv.imgproc.colorEqualizeHist=function(a){var b=void 0;arguments[arguments.length-1]instanceof jscv.RunConfig_&&(b=arguments[arguments.length-1]);var c=jscv.utility.processUserConfig_(b);return c==jscv.NO_ENFORCE&&(c=a.width*a.height>=jscv.MIN_MATRIX_SIZE_FOR_PARALLEL?jscv.ENFORCE_PARALLEL:jscv.ENFORCE_SEQUENTIAL),c==jscv.ENFORCE_SEQUENTIAL?jscv.imgproc.colorEqualizeHistSeq_(a):jscv.imgproc.colorEqualizeHistPar_(a)},jscv.imgproc.colorEqualizeHistSeq_=function(a){for(var b=[],c=a.data.data,d=c.length,e=a.nChannel,f=[],g=[],h=0;e-1>h;h++){f.push([]),g.push([]),b.push(257);for(var i=0;256>i;i++)f[h].push(0),g[h].push(0)}for(var j=0;d>j;j+=e)for(var k=0;e-1>k;k++)b[k]>c[j+k]&&(b[k]=c[j+k]),f[k][c[j+k]]++;for(var h=0;e-1>h;h++)g[h][0]=f[h][0];for(var h=0;e-1>h;h++)for(var i=1;256>i;i++)g[h][i]=g[h][i-1]+f[h][i];for(var l=new jscv.coredt.Image(a),m=l.data.data,j=0;d>j;j+=e)for(var k=0;e-1>k;k++)m[j+k]=255*((g[k][c[j+k]]-g[k][b[k]])/(d/e-g[k][b[k]]));return l},jscv.imgproc.colorEqualizeHistPar_=function(a){for(var b=[],c=a.data.data,d=c.length,e=a.nChannel,f=[],g=[],h=0;e>h;h++){f.push([]),g.push([]),b.push(257);for(var i=0;256>i;i++)f[h].push(0),g[h].push(0)}for(var j=function(a,b){return a+b},k=[],h=0;d>h;h++)k.push(c[h]);for(var l=0;e-1>l;l++){for(var m=c.mapPar(function(a,b){return b%e==l?1:0}),n=[],h=0;d>h;h++)n.push(m[h]);f[l]=n.scatterPar(k,0,j);for(var h=0;256>h;h++)if(f[l][h]>0){b[l]=h;break}}for(var h=0;e-1>h;h++)g[h][0]=f[h][0];for(var h=0;e-1>h;h++)for(var i=1;256>i;i++)g[h][i]=g[h][i-1]+f[h][i];var o=new jscv.coredt.Image(a),p=function(a,f){return f%e==e-1?a:255*((g[f%e][c[f]]-g[f%e][b[f%e]])/(d/e-g[f%e][b[f%e]]))};return o.data.data=c.mapPar(p),o},jscv.imgproc.addImg=function(a,b){start=(new Date).getTime();var c=void 0;arguments.length>2&&!(arguments[2]instanceof jscv.RunConfig_)&&(c=arguments[2]);var d;if(a.colorMode!=jscv.COLOR_GRAY&&a.colorMode!=jscv.COLOR_RGBA)throw new Error("Image Algebra is available for grayscale and RGBA images only");if(b instanceof jscv.coredt.Image){if(a.colorMode!=b.colorMode)throw new Error("The two images must have the same color space");if(!jscv.math.haveSameDimension(a.data,b.data))throw new Error("The two images must have the same size");d=b.data,jscv.SUPPORT_DATA_TYPE.indexOf(c)<0&&(c=jscv.utility.findMinSuperType(a.elementalType,b.elementalType))}else{if("number"!=typeof b)throw new TypeError("The second argument is either an instance of jscv.coredt.Image or a number");jscv.SUPPORT_DATA_TYPE.indexOf(c)<0&&(c=a.elementalType),d=new jscv.coredt.Matrix(a.shape,c,b)}var e=void 0;arguments[arguments.length-1]instanceof jscv.RunConfig_&&(e=arguments[arguments.length-1]);var f=jscv.utility.processUserConfig_(e),g=void 0;a.colorMode==jscv.COLOR_RGBA&&(g=jscv.utility.createMat(d.shape,jscv.uint8,[1,1,1,0]));var h=new jscv.coredt.Image(a.width,a.height,c,a.colorMode);return h.data=jscv.math.addMat(a.data,d,c,g,f),h},jscv.imgproc.subImg=function(a,b){var c=void 0;arguments.length>2&&!(arguments[2]instanceof jscv.RunConfig_)&&(c=arguments[2]);var d;if(a.colorMode!=jscv.COLOR_GRAY&&a.colorMode!=jscv.COLOR_RGBA)throw new Error("Image Algebra is available for grayscale and RGBA images only");if(b instanceof jscv.coredt.Image){if(a.colorMode!=b.colorMode)throw new Error("The two images must have the same color space");if(!jscv.math.haveSameDimension(a.data,b.data))throw new Error("The two images must have the same size");d=b.data,jscv.SUPPORT_DATA_TYPE.indexOf(c)<0&&(c=jscv.utility.findMinSuperType(a.elementalType,b.elementalType))}else{if("number"!=typeof b)throw new TypeError("The second argument is either an instance of jscv.coredt.Image or a number");jscv.SUPPORT_DATA_TYPE.indexOf(c)<0&&(c=a.elementalType),d=new jscv.coredt.Matrix(a.shape,c,b)}var e=void 0;arguments[arguments.length-1]instanceof jscv.RunConfig_&&(e=arguments[arguments.length-1]);var f=jscv.utility.processUserConfig_(e),g=void 0;a.colorMode==jscv.COLOR_RGBA&&(g=jscv.utility.createMat(d.shape,jscv.uint8,[1,1,1,0]));var h=new jscv.coredt.Image(a.width,a.height,c,a.colorMode);return h.data=jscv.math.subMat(a.data,d,c,g,f),h},jscv.imgproc.absSubImg=function(a,b){var c=void 0;arguments.length>2&&!(arguments[2]instanceof jscv.RunConfig_)&&(c=arguments[2]);var d;if(a.colorMode!=jscv.COLOR_GRAY&&a.colorMode!=jscv.COLOR_RGBA)throw new Error("Image Algebra is available for grayscale and RGBA images only");if(b instanceof jscv.coredt.Image){if(a.colorMode!=b.colorMode)throw new Error("The two images must have the same color space");if(!jscv.math.haveSameDimension(a.data,b.data))throw new Error("The two images must have the same size");d=b.data,jscv.SUPPORT_DATA_TYPE.indexOf(c)<0&&(c=jscv.utility.findMinSuperType(a.elementalType,b.elementalType))}else{if("number"!=typeof b)throw new TypeError("The second argument is either an instance of jscv.coredt.Image or a number");jscv.SUPPORT_DATA_TYPE.indexOf(c)<0&&(c=a.elementalType),d=new jscv.coredt.Matrix(a.shape,c,b)}var e=void 0;arguments[arguments.length-1]instanceof jscv.RunConfig_&&(e=arguments[arguments.length-1]);var f=jscv.utility.processUserConfig_(e),g=void 0;a.colorMode==jscv.COLOR_RGBA&&(g=jscv.utility.createMat(d.shape,jscv.uint8,[1,1,1,0]));var h=new jscv.coredt.Image(a.width,a.height,c,a.colorMode);return h.data=jscv.math.absSubMat(a.data,d,c,g,f),h},jscv.imgproc.mulImg=function(a,b){var c=void 0;arguments.length>2&&!(arguments[2]instanceof jscv.RunConfig_)&&(c=arguments[2]);var d;if(a.colorMode!=jscv.COLOR_GRAY&&a.colorMode!=jscv.COLOR_RGBA)throw new Error("Image Algebra is available for grayscale and RGBA images only");if(b instanceof jscv.coredt.Image){if(a.colorMode!=b.colorMode)throw new Error("The two images must have the same color space");if(!jscv.math.haveSameDimension(a.data,b.data))throw new Error("The two images must have the same size");d=b.data,jscv.SUPPORT_DATA_TYPE.indexOf(c)<0&&(c=jscv.utility.findMinSuperType(a.elementalType,b.elementalType))}else{if("number"!=typeof b)throw new TypeError("The second argument is either an instance of jscv.coredt.Image or a number");jscv.SUPPORT_DATA_TYPE.indexOf(c)<0&&(c=a.elementalType),d=b}var e=void 0;arguments[arguments.length-1]instanceof jscv.RunConfig_&&(e=arguments[arguments.length-1]);var f=jscv.utility.processUserConfig_(e),g=void 0;a.colorMode==jscv.COLOR_RGBA&&(g=jscv.utility.createMat(a.data.shape,jscv.uint8,[1,1,1,0]));var h=new jscv.coredt.Image(a.width,a.height,c,a.colorMode);return h.data=d instanceof jscv.coredt.Matrix?jscv.math.elementwiseMulMat(a.data,d,c,g,f):jscv.math.scalarMulMat(a.data,d,c,g,f),h},jscv.imgproc.divImg=function(a,b){var c=void 0;arguments.length>2&&!(arguments[2]instanceof jscv.RunConfig_)&&(c=arguments[2]);var d;if(a.colorMode!=jscv.COLOR_GRAY&&a.colorMode!=jscv.COLOR_RGBA)throw new Error("Image Algebra is available for grayscale and RGBA images only");if(b instanceof jscv.coredt.Image){if(a.colorMode!=b.colorMode)throw new Error("The two images must have the same color space");if(!jscv.math.haveSameDimension(a.data,b.data))throw new Error("The two images must have the same size");d=b.data,jscv.SUPPORT_DATA_TYPE.indexOf(c)<0&&(c=jscv.utility.findMinSuperType(a.elementalType,b.elementalType))}else{if("number"!=typeof b)throw new TypeError("The second argument is either an instance of jscv.coredt.Image or a number");jscv.SUPPORT_DATA_TYPE.indexOf(c)<0&&(c=a.elementalType),d=b}var e=void 0;arguments[arguments.length-1]instanceof jscv.RunConfig_&&(e=arguments[arguments.length-1]);var f=jscv.utility.processUserConfig_(e),g=void 0;a.colorMode==jscv.COLOR_RGBA&&(g=jscv.utility.createMat(a.data.shape,jscv.uint8,[1,1,1,0]));var h=new jscv.coredt.Image(a.width,a.height,c,a.colorMode);return h.data=d instanceof jscv.coredt.Matrix?jscv.math.elementwiseDivMat(a.data,d,c,g,f):jscv.math.scalarMulMat(a.data,1/d,c,g,f),h},jscv.imgproc.bitwiseAndImg=function(a,b){var c=void 0;arguments.length>2&&!(arguments[2]instanceof jscv.RunConfig_)&&(c=arguments[2]);
var d;if(a.colorMode!=jscv.COLOR_GRAY&&a.colorMode!=jscv.COLOR_RGBA)throw new Error("Image Algebra is available for grayscale and RGBA images only");if(b instanceof jscv.coredt.Image){if(a.colorMode!=b.colorMode)throw new Error("The two images must have the same color space");if(!jscv.math.haveSameDimension(a.data,b.data))throw new Error("The two images must have the same size");d=b.data,jscv.SUPPORT_DATA_TYPE.indexOf(c)<0&&(c=jscv.utility.findMinSuperType(a.elementalType,b.elementalType))}else{if("number"!=typeof b)throw new TypeError("The second argument is either an instance of jscv.coredt.Image or a number");jscv.SUPPORT_DATA_TYPE.indexOf(c)<0&&(c=a.elementalType),d=new jscv.coredt.Matrix(a.shape,c,b)}var e=void 0;arguments[arguments.length-1]instanceof jscv.RunConfig_&&(e=arguments[arguments.length-1]);var f=jscv.utility.processUserConfig_(e),g=void 0;a.colorMode==jscv.COLOR_RGBA&&(g=jscv.utility.createMat(d.shape,jscv.uint8,[1,1,1,0]));var h=new jscv.coredt.Image(a.width,a.height,c,a.colorMode);return h.data=jscv.math.bitwiseAndMat(a.data,d,c,g,f),h},jscv.imgproc.bitwiseOrImg=function(a,b){var c=void 0;arguments.length>2&&!(arguments[2]instanceof jscv.RunConfig_)&&(c=arguments[2]);var d;if(a.colorMode!=jscv.COLOR_GRAY&&a.colorMode!=jscv.COLOR_RGBA)throw new Error("Image Algebra is available for grayscale and RGBA images only");if(b instanceof jscv.coredt.Image){if(a.colorMode!=b.colorMode)throw new Error("The two images must have the same color space");if(!jscv.math.haveSameDimension(a.data,b.data))throw new Error("The two images must have the same size");d=b.data,jscv.SUPPORT_DATA_TYPE.indexOf(c)<0&&(c=jscv.utility.findMinSuperType(a.elementalType,b.elementalType))}else{if("number"!=typeof b)throw new Error("The second argument is either an instance of jscv.coredt.Image or a number");jscv.SUPPORT_DATA_TYPE.indexOf(c)<0&&(c=a.elementalType),d=new jscv.coredt.Matrix(a.shape,c,b)}var e=void 0;arguments[arguments.length-1]instanceof jscv.RunConfig_&&(e=arguments[arguments.length-1]);var f=jscv.utility.processUserConfig_(e),g=void 0;a.colorMode==jscv.COLOR_RGBA&&(g=jscv.utility.createMat(d.shape,jscv.uint8,[1,1,1,0]));var h=new jscv.coredt.Image(a.width,a.height,c,a.colorMode);return h.data=jscv.math.bitwiseOrMat(a.data,d,c,g,f),h},jscv.imgproc.bitwiseXorImg=function(a,b){var c=void 0;arguments.length>2&&!(arguments[2]instanceof jscv.RunConfig_)&&(c=arguments[2]);var d;if(a.colorMode!=jscv.COLOR_GRAY&&a.colorMode!=jscv.COLOR_RGBA)throw new Error("Image Algebra is available for grayscale and RGBA images only");if(b instanceof jscv.coredt.Image){if(a.colorMode!=b.colorMode)throw new Error("The two images must have the same color space");if(!jscv.math.haveSameDimension(a.data,b.data))throw new Error("The two images must have the same size");d=b.data,jscv.SUPPORT_DATA_TYPE.indexOf(c)<0&&(c=jscv.utility.findMinSuperType(a.elementalType,b.elementalType))}else{if("number"!=typeof b)throw new TypeError("The second argument is either an instance of jscv.coredt.Image or a number");jscv.SUPPORT_DATA_TYPE.indexOf(c)<0&&(c=a.elementalType),d=new jscv.coredt.Matrix(a.shape,c,b)}var e=void 0;arguments[arguments.length-1]instanceof jscv.RunConfig_&&(e=arguments[arguments.length-1]);var f=jscv.utility.processUserConfig_(e),g=void 0;a.colorMode==jscv.COLOR_RGBA&&(g=jscv.utility.createMat(d.shape,jscv.uint8,[1,1,1,0]));var h=new jscv.coredt.Image(a.width,a.height,c,a.colorMode);return h.data=jscv.math.bitwiseXorMat(a.data,d,c,g,f),h},jscv.imgproc.invertImg=function(a){if(a.colorMode!=jscv.COLOR_GRAY&&a.colorMode!=jscv.COLOR_RGBA)throw new Error("Image Algebra is available for grayscale and RGBA images only");var b=0;b="number"==typeof arguments[1]?jscv.utility.clampValue(arguments[1],a.elementalType):jscv.utility.isFloatType(a.elementalType)?0:jscv.utility.getMaxIntVal(a.elementalType);var c=void 0;arguments[arguments.length-1]instanceof jscv.RunConfig_&&(c=arguments[arguments.length-1]);var d=jscv.utility.processUserConfig_(c),e=void 0;a.colorMode==jscv.COLOR_RGBA&&(e=jscv.utility.createMat(a.data.shape,jscv.uint8,[1,1,1,0]));var f=a.data,g=function(c,d){var g=1;void 0!==e&&(g=e.data[d]);var h=f.data[d];return g&&(h=b-h),jscv.utility.clampValue(h,a.elementalType)},h=new jscv.coredt.Image(a.width,a.height,a.elementalType,a.colorMode);return h.data=jscv.math.mapMat_(h.data,g,a.elementalType,d),h},jscv.imgproc.blendImg=function(a,b,c){if(a.colorMode!=b.colorMode)throw new Error("The two images must have the same color space");if(!jscv.math.haveSameDimension(a.data,b.data))throw new Error("The two images must have the same size");if(a.colorMode!=jscv.COLOR_GRAY&&b.colorMode!=jscv.COLOR_RGBA)throw new Error("Image Algebra is available for grayscale and RGBA images only");if(0>c||c>1)return new jscv.coredt.Image(a);var d=void 0;arguments.length>2&&!(arguments[2]instanceof jscv.RunConfig_)&&(d=arguments[2]),jscv.SUPPORT_DATA_TYPE.indexOf(d)<0&&(d=jscv.utility.findMinSuperType(a.elementalType,b.elementalType));var e=void 0;arguments[arguments.length-1]instanceof jscv.RunConfig_&&(e=arguments[arguments.length-1]);var f=jscv.utility.processUserConfig_(e),g=void 0;a.colorMode==jscv.COLOR_RGBA&&(g=jscv.utility.createMat(a.data.shape,jscv.uint8,[1,1,1,0]));var h=new jscv.coredt.Image(a.width,a.height,d,a.colorMode);return h.data=jscv.math.addWeightedMat(a.data,b.data,c,1-c,0,d,g,f),h},jscv.imgproc.medianBlur=function(a){var b=3;"number"==typeof arguments[1]&&(b=Math.floor(arguments[1]),1>b&&(b=3),1&b||b++);var c=void 0;arguments[arguments.length-1]instanceof jscv.RunConfig_&&(c=arguments[arguments.length-1]);var d=jscv.utility.processUserConfig_(c);return d==jscv.NO_ENFORCE&&(d=a.width*a.height*b*b>=jscv.MIN_MATRIX_SIZE_FOR_PARALLEL?jscv.ENFORCE_PARALLEL:jscv.ENFORCE_SEQUENTIAL),d==jscv.ENFORCE_SEQUENTIAL?jscv.imgproc.medianBlurSeq_(a,b):jscv.imgproc.medianBlurPar_(a,b)},jscv.imgproc.medianBlurSeq_=function(a,b){return jscv.imgproc.bruteforceMedianBlurSeq_(a,b)},jscv.imgproc.medianBlurPar_=function(a,b){return jscv.imgproc.bruteforceMedianBlurPar_(a,b)},jscv.imgproc.bruteforceMedianBlurSeq_=function(a,b){for(var c=b>>1,d=[c,c,c,c],e=jscv.utility.copyMakeBorder(a.data,d,jscv.BORDER_REPLICATE),f=new jscv.coredt.Image(a.width,a.height,a.elementalType,a.colorMode),g=f.data.data,h=e.data,i=f.data.nRow,j=f.data.nCol,k=f.data.depth,l=f.data.stride,m=e.stride,n=[],o=b*b>>1,p=-c*m[0]-c*m[1],q=function(a,b,d){for(var e=p,f=0,g=-c;c>=g;g++){for(var i=e,j=-c;c>=j;j++)n[f]=h[d+i],i+=m[1],f++;e+=m[0]}return n.sort(function(a,b){return a-b}),n[o]},r=c*m[0]+c*m[1],s=0;k>s;s++)for(var t=r+s,u=s,v=0;i>v;v++){for(var w=t,x=u,y=0;j>y;y++)g[x]=q(v,y,w),w+=m[1],x+=l[1];t+=m[0],u+=l[0]}return f},jscv.imgproc.bruteforceMedianBlurPar_=function(a,b){var c=b>>1,d=b*b>>1,e=[c,c,c,c],f=jscv.utility.copyMakeBorder(a.data,e,jscv.BORDER_REPLICATE),g=f.getNdView(),h=new jscv.coredt.Matrix(a.data.shape,a.elementalType),i=h.getNdView(),j=function(a,b,e){var f=[];b+=c,e+=c;for(var h=-c;c>=h;h++)for(var i=-c;c>=i;i++){var j=b+h,k=e+i;f.push(g[j][k])}return f.sort(function(a,b){return a-b}),f[d]},k=function(a,b,e,f){var h=[];b+=c,e+=c;for(var i=-c;c>=i;i++)for(var j=-c;c>=j;j++){var k=b+i,l=e+j;h.push(g[k][l][f])}return h.sort(function(a,b){return a-b}),h[d]},l=null;return l=1==h.depth?i.mapPar(2,j):i.mapPar(3,k),new jscv.coredt.Image(a.width,a.height,a.elementalType,a.colorMode,TypedObject.storage(l).buffer)},jscv.imgproc.dilate=function(a,b,c){var d=void 0;arguments[arguments.length-1]instanceof jscv.RunConfig_&&(d=arguments[arguments.length-1]);var e=jscv.utility.processUserConfig_(d);return e==jscv.NO_ENFORCE&&(e=a.width*a.height>=jscv.MIN_MATRIX_SIZE_FOR_PARALLEL?jscv.ENFORCE_PARALLEL:jscv.ENFORCE_SEQUENTIAL),e==jscv.ENFORCE_SEQUENTIAL?jscv.imgproc.dilateSeq_(a,b,c):jscv.imgproc.dilatePar_(a,b,c)},jscv.imgproc.dilateSeq_=function(a,b,c){a.colorMode!=jscv.COLOR_GRAY&&(a=jscv.imgproc.convertColor(a,jscv.COLOR_GRAY)),a=jscv.imgproc.threshold(a,jscv.THRESH_BINARY,jscv.USE_OTSU),b||c||(c=c=3);for(var d=!1,e=new jscv.coredt.Image(a.width,a.height,a.elementalType,a.colorMode),f=0;f<a.height;f++)for(var g=0;g<a.width;g++)for(var h=-Math.floor(c/2);h<=Math.ceil(c/2);h++)if(f+h>=0&&f+h<a.height){for(var i=-Math.floor(b/2);i<=Math.ceil(b/2);i++)if(g+i>=0&&g+i<a.width&&0==a.data.get(f+h,g+i)){d=!0;break}if(d){d=!1,e.data.set(0,f,g);break}}return e},jscv.imgproc.dilatePar_=function(a,b,c){a.colorMode!=jscv.COLOR_GRAY&&(a=jscv.imgproc.convertColor(a,jscv.COLOR_GRAY)),a=jscv.imgproc.threshold(a,jscv.THRESH_BINARY,jscv.USE_OTSU),b||c||(c=c=3);var d=new jscv.coredt.Image(a.width,a.height,a.elementalType,a.colorMode),e=function(d,e,f){for(var g=!1,h=-Math.floor(b/2);h<=Math.ceil(b/2);h++)if(e+h>=0&&e+h<a.height){for(var i=-Math.floor(c/2);i<=Math.ceil(c/2);i++)if(f+i>=0&&f+i<a.width&&0==a.data.data[e+h][f+i]){g=!0;break}if(g)return 0}return a.data.data[e][f]};return d.data.data=d.data.data.mapPar(2,e),d},jscv.imgproc.erode=function(a,b,c){var d=void 0;arguments[arguments.length-1]instanceof jscv.RunConfig_&&(d=arguments[arguments.length-1]);var e=jscv.utility.processUserConfig_(d);return e==jscv.NO_ENFORCE&&(e=a.width*a.height>=jscv.MIN_MATRIX_SIZE_FOR_PARALLEL?jscv.ENFORCE_PARALLEL:jscv.ENFORCE_SEQUENTIAL),e==jscv.ENFORCE_SEQUENTIAL?jscv.imgproc.erodeSeq_(a,b,c):jscv.imgproc.erodePar_(a,b,c)},jscv.imgproc.erodeSeq_=function(a,b,c){a.colorMode!=jscv.COLOR_GRAY&&(a=jscv.imgproc.convertColor(a,jscv.COLOR_GRAY)),a=jscv.imgproc.threshold(a,jscv.THRESH_BINARY,jscv.USE_OTSU),b||c||(c=c=3);for(var d=!1,e=new jscv.coredt.Image(a.width,a.height,a.elementalType,a.colorMode),f=0;f<a.height;f++)for(var g=0;g<a.width;g++)if(0==e.data.get(f,g))for(var h=-Math.floor(c/2);h<=Math.ceil(c/2);h++)if(f+h>=0&&f+h<a.height){for(var i=-Math.floor(b/2);i<=Math.ceil(b/2);i++)if(g+i>=0&&g+i<a.width&&0!=a.data.get(f+h,g+i)){d=!0;break}if(d){d=!1,e.data.set(255,f,g);break}}return e},jscv.imgproc.erodePar_=function(a,b,c){a.colorMode!=jscv.COLOR_GRAY&&(a=jscv.imgproc.convertColor(a,jscv.COLOR_GRAY)),a=jscv.imgproc.threshold(a,jscv.THRESH_BINARY,jscv.USE_OTSU),b||c||(c=c=3);var d=new jscv.coredt.Image(a.width,a.height,a.elementalType,a.colorMode),e=function(d,e,f){var g=!1;if(0!=a.data.data[e][f])return a.data.data[e][f];for(var h=-Math.floor(b/2);h<=Math.ceil(b/2);h++)if(e+h>=0&&e+h<a.height){for(var i=-Math.floor(c/2);i<=Math.ceil(c/2);i++)if(f+i>=0&&f+i<a.width&&0!=a.data.data[e+h][f+i]){g=!0;break}if(g)return 255}};return d.data.data=d.data.data.mapPar(2,e),d},jscv.imgproc.overlay=function(a,b){var c=arguments.length,d=1,e=void 0;"number"==typeof arguments[2]&&(d=arguments[2]),arguments[c-1]instanceof jscv.RunConfig_&&(e=arguments[c-1]),(d>1||0>d)&&(d=1);var f=jscv.utility.processUserConfig_(e);if(f==jscv.NO_ENFORCE){var g=Math.min(a.height,b.height),h=Math.min(a.width,b.width);f=g*h*a.nChannel>=jscv.MIN_MATRIX_SIZE_FOR_PARALLEL?jscv.ENFORCE_PARALLEL:jscv.ENFORCE_SEQUENTIAL}return f==jscv.ENFORCE_SEQUENTIAL?jscv.imgproc.overlaySeq_(a,b,d):jscv.imgproc.overlayPar_(a,b,d)},jscv.imgproc.overlayPar_=function(a,b,c){var d=Math.min(a.height,b.height),e=Math.min(a.width,b.width);new jscv.coredt.Image(a);var f,g=1-c,h=a.data.getNdView(),i=b.data.getNdView();if(a.colorMode!=b.colorMode)throw new Error("Non-matching image types");if(a.colorMode==jscv.COLOR_GRAY){var j=function(a,b,f){return b>=d||f>=e?a:Math.floor(a*g+i[b][f]*c)};f=h.mapPar(2,j)}else if(a.colorMode==jscv.COLOR_RGBA){var k=function(a,b,f,g){if(b>=d||f>=e)return a;var h=i[b][f][3]/255,j=h*c;return Math.floor(a*(1-j)+i[b][f][g]*j)};f=h.mapPar(3,k)}return new jscv.coredt.Image(a.width,a.height,a.elementalType,a.colorMode,TypedObject.storage(f).buffer)},jscv.imgproc.overlaySeq_=function(a,b,c){var d=a.height,e=a.width;a.nChannel;var f=new jscv.coredt.Image(a),g=1-c,h=f.data.data,i=a.data.data,j=b.data.data;if(a.colorMode!=b.colorMode)throw new Error("Non-matching image types");if(a.colorMode==jscv.COLOR_GRAY)for(var k=0,l=0,m=0;d>m&&m<b.height;m++){for(var n=k,o=l,p=0;e>p&&p<b.width;p++)h[n]=Math.floor(i[n]*g+j[o]*c),n++,o++;k+=e,l+=b.width}else if(a.colorMode==jscv.COLOR_RGBA)for(var k=0,l=0,q=a.data.stride,r=b.data.stride,m=0;d>m&&m<b.height;m++){for(var n=k,o=l,p=0;e>p&&p<b.width;p++){for(var s=j[o+3]/255,t=s*c,u=0;4>u;u++)h[n+u]=Math.floor(i[n+u]*(1-t)+j[n+u]*t);n+=q[1],o+=r[1]}k+=q[0],l+=r[0]}return f},jscv.imgproc.PYRAMID_GAUSS_KERNEL_=[[1/256,4/256,6/256,4/256,1/256],[4/256,.0625,.09375,.0625,4/256],[6/256,.09375,36/256,.09375,6/256],[4/256,.0625,.09375,.0625,4/256],[1/256,4/256,6/256,4/256,1/256]],jscv.imgproc.pyramidDownsample=function(a){var b=jscv.BORDER_REPLICATE,c=0,d=1;arguments.length>d&&jscv.SUPPORT_BORDER_TYPE.indexOf(arguments[d])>=0&&(b=arguments[d],d++),b==jscv.BORDER_CONSTANT&&(c=arguments[d],c=jscv.utility.clampValue(c,a.elementalType));var e=void 0;arguments[arguments.length-1]instanceof jscv.RunConfig_&&(e=arguments[arguments.length-1]);var f=jscv.utility.processUserConfig_(e);f==jscv.NO_ENFORCE&&(f=a.width*a.height*a.nChannel>=jscv.MIN_MATRIX_SIZE_FOR_PARALLEL?jscv.ENFORCE_PARALLEL:jscv.ENFORCE_SEQUENTIAL);var g=new jscv.coredt.Matrix(jscv.float64,jscv.imgproc.PYRAMID_GAUSS_KERNEL_),h=[0];if(a.nChannel>1)if(a.colorMode==jscv.COLOR_RGBA)h=[0,1,2];else for(var i=1;i<a.nChannel;i++)h.push(i);var j=jscv.math.convolveMat(a.data,h,g,a.elementalType,b,c,f),k=a.width+1>>1,l=a.height+1>>1,m=new jscv.coredt.Image(k,l,a.elementalType,a.colorMode),n=m.data;if(f==jscv.ENFORCE_SEQUENTIAL)for(var o=0,p=0,q=0;l>q;q++){for(var r=p,s=0;k>s;s++){if(1==n.depth)n.data[o]=j.data[r],o++;else for(var t=0;t<n.depth;t++)n.data[o]=j.data[r+t],o++;r+=j.stride[1]<<1}p+=j.stride[0]<<1}else{var u=j.getNdView(),v=function(a,b,c){return u[b<<1][c<<1]},w=function(a,b,c,d){return u[b<<1][c<<1][d]};resultDataNdView=n.getNdView();var x;x=1==a.nChannel?resultDataNdView.mapPar(2,v):resultDataNdView.mapPar(3,w),m=new jscv.coredt.Image(k,l,a.elementalType,a.colorMode,TypedObject.storage(x).buffer)}return m},jscv.imgproc.buildPyramid=function(a){var b=1,c=-1,d=1,e=1;arguments.length>b&&"number"==typeof arguments[b]&&(c=arguments[b],1>c&&(c=-1),b++),arguments.length>b&&arguments[b]instanceof Array&&(d=arguments[b][0],e=arguments[b][1],b++);var f=void 0,g=void 0;arguments.length>b&&"string"==typeof arguments[b]&&(f=arguments[b],b++),arguments.length>b&&"number"==typeof arguments[b]&&(g=arguments[b]),(void 0==f||jscv.SUPPORT_BORDER_TYPE.indexOf(f)<0)&&(f=jscv.BORDER_REPLICATE),f==jscv.BORDER_CONSTANT&&(void 0==g&&(g=0),g=jscv.utility.clampValue(g,a.elementalType));var h=void 0;arguments[arguments.length-1]instanceof jscv.RunConfig_&&(h=arguments[arguments.length-1]);for(var i=jscv.utility.processUserConfig_(h),j=[a],k=1;c>k||0>c;k++){var l=j[j.length-1];if(l.width+1>>1<d||l.height+1>>1<e||1==l.width&&1==l.height)break;var m=jscv.imgproc.pyramidDownsample(l,f,g,i);j.push(m)}return j},jscv.imgproc.pyramidUpsample=function(a){var b=jscv.BORDER_REPLICATE,c=0,d=1;arguments.length>d&&jscv.SUPPORT_BORDER_TYPE.indexOf(arguments[d])>=0&&(b=arguments[d],d++),b==jscv.BORDER_CONSTANT&&(c=arguments[d],c=jscv.utility.clampValue(c,a.elementalType));var e=void 0;arguments[arguments.length-1]instanceof jscv.RunConfig_&&(e=arguments[arguments.length-1]);var f=jscv.utility.processUserConfig_(e);f==jscv.NO_ENFORCE&&(f=a.width*a.height*a.nChannel>=jscv.MIN_MATRIX_SIZE_FOR_PARALLEL?jscv.ENFORCE_PARALLEL:jscv.ENFORCE_SEQUENTIAL);for(var g=a.width<<1,h=a.height<<1,i=new jscv.coredt.Image(g,h,a.elementalType,a.colorMode),j=a.data.data,k=i.data.data,l=i.data.stride,m=0,n=0,o=0;o<a.height;o++){for(var p=n,q=0;q<a.height;q++){if(1==a.nChannel)k[p]=j[m],m++;else for(var r=0;r<a.nChannel;r++)k[p+r]=j[m],m++;p+=l[1]<<1}n+=doubleSride[0]<<1}if(a.colorMode==jscv.COLOR_RGBA){n=l[0]+l[1];for(var o=1;o<i.height;o+=2){for(var p=n,q=1;q<i.width;q+=2)i.data.data[p+3]=255,p+=l[1]<<1;n+=doubleSride[0]<<1}}var s=new jscv.coredt.Matrix(jscv.float64,jscv.imgproc.PYRAMID_GAUSS_KERNEL_);s=jscv.math.scalarMulMat(s,4);var t=[0];if(a.nChannel>1)if(a.colorMode==jscv.COLOR_RGBA)t=[0,1,2];else for(var u=1;u<a.nChannel;u++)t.push(u);return i.data=jscv.math.convolveMat(i.data,t,s,i.elementalType,b,c,f),i},jscv.imgproc.resizeMult=function(a,b,c,d){var e=jscv.utility.processUserConfig_(d);return e==jscv.ENFORCE_SEQUENTIAL?jscv.imgproc.resizeMultSeq_(a,b,c):e==jscv.ENFORCE_PARALLEL?jscv.imgproc.resizeMultPar_(a,b,c):jscv.imgproc.resizeMultPar_(a,b,c)},jscv.imgproc.resizeMultPar_=function(a,b,c){var d=new jscv.coredt.Image(Math.floor(a.width*b),Math.floor(a.height*c),a.elementalType,a.colorMode);return jscv.imgproc.resizeFitPar_(a,d),d},jscv.imgproc.resizeMultSeq_=function(a,b,c){var d=new jscv.coredt.Image(Math.floor(a.width*b),Math.floor(a.height*c),a.elementalType,a.colorMode);return jscv.imgproc.resizeFitSeq_(a,d),d},jscv.imgproc.resizeFit=function(a,b,c){var d=jscv.utility.processUserConfig_(c);return d==jscv.ENFORCE_SEQUENTIAL?jscv.imgproc.resizeFitSeq_(a,b):d==jscv.ENFORCE_PARALLEL?jscv.imgproc.resizeFitPar_(a,b):jscv.imgproc.resizeFitPar_(a,b)},jscv.imgproc.resizeFitPar_=function(a,b){jscv.imgproc.resizeFitMatrixPar_(a.data,b.data)},jscv.imgproc.resizeFitSeq_=function(a,b){jscv.imgproc.resizeFitMatrixSeq_(a.data,b.data)},jscv.imgproc.resizeFitMatrix=function(a,b,c){var d=jscv.utility.processUserConfig_(c);return d==jscv.ENFORCE_SEQUENTIAL?jscv.imgproc.resizeFitMatrixSeq_(jscvImgSrc,b):d==jscv.ENFORCE_PARALLEL?jscv.imgproc.resizeFitMatrixPar_(jscvImgSrc,b):jscv.imgproc.resizeFitMatrixPar_(jscvImgSrc,b)},jscv.imgproc.resizeFitMatrixPar_=function(a,b){var c=b.nRow,d=b.nCol,e=c/a.nRow,f=d/a.nCol,g=b.depth,h=function(b,c,d){var g=Math.floor(d/f),h=Math.floor(c/e);return jscv.imgproc.resizeFit.biInterpolateGray_(a,[g,h],f,e)},i=function(b,c,d,g){var h=Math.floor(d/f),i=Math.floor(c/e);return jscv.imgproc.resizeFit.biInterpolateChanneled_(a,[h,i],f,e,g)},j=b.getNdView(),k=jscv.coredt.getNdArrayType(c*d*g,this.elementalType),l=null;l=1>=g?j.mapPar(2,h):j.mapPar(3,i),b.data=new k(TypedObject.storage(l).buffer)},jscv.imgproc.resizeFitMatrixSeq_=function(a,b){for(var c=b.nRow,d=b.nCol,e=c/a.nRow,f=d/a.nCol,g=b.depth,h=0,i=0;c>i;i++)for(var j=0;d>j;j++){var l=Math.floor(j/f),m=Math.floor(i/e);if(1>=g)b.data[h]=jscv.imgproc.resizeFit.biInterpolateGray_(a,[l,m],f,e),h++;else for(k=0;g>k;k++)b.data[h]=jscv.imgproc.resizeFit.biInterpolateChanneled_(a,[l,m],f,e,k),h++}},jscv.imgproc.resizeFit.biInterpolateGray_=function(a,b,c,d){var e=[b[0]-Math.floor(1/c),b[1]-Math.floor(1/d)];e[0]<0&&(e[0]=0),e[1]<0&&(e[1]=0);var f=[b[0]+Math.floor(1/c),b[1]+Math.floor(1/d)];f[0]>=a.nCol&&(f[0]=a.nCol-1),f[1]>=a.nRow&&(f[1]=a.nRow-1);var g=(b[0]-e[0])/(f[0]-e[0]),h=(b[1]-e[1])/(f[1]-e[1]),i=0,j=0;i=a.get(b[1],e[0])+g*a.get(b[1],f[0]),j=a.get(e[1],b[0])+h*a.get(f[1],b[0]);var k=Math.floor((i+j)/2);return k},jscv.imgproc.resizeFit.biInterpolateChanneled_=function(a,b,c,d,e){var f=[b[0]-Math.floor(1/c),b[1]-Math.floor(1/d)];f[0]<0&&(f[0]=0),f[1]<0&&(f[1]=0);var g=[b[0]+Math.floor(1/c),b[1]+Math.floor(1/d)];g[0]>=a.nCol&&(g[0]=a.nCol-1),g[1]>=a.nRow&&(g[1]=a.nRow-1);var h=(b[0]-f[0])/(g[0]-f[0]),i=(b[1]-f[1])/(g[1]-f[1]),j=0,k=0;j=a.get(b[1],f[0],e)+h*a.get(b[1],g[0],e),k=a.get(f[1],b[0],e)+i*a.get(g[1],b[0],e);var l=Math.floor((j+k)/2);return l},jscv.imgproc.rotate=function(a,b){var c=arguments.length,d=void 0,e=void 0;arguments[c-1]instanceof jscv.RunConfig_?(e=arguments[c-1],4==c&&(d=arguments[2])):3==c&&(d=arguments[2]);var f=jscv.utility.processUserConfig_(e);return f==jscv.ENFORCE_SEQUENTIAL?jscv.imgproc.rotateSeq_(a,b,d):f==jscv.ENFORCE_PARALLEL?jscv.imgproc.rotatePar_(a,b,d):jscv.imgproc.rotateSeq_(a,b,d)},jscv.imgproc.rotatePar_=function(a,b,c){var d=new jscv.coredt.Image(a),e=a.nChannel,b=b*Math.PI/180,f=d.data.getNdView(),g=a.data;"undefined"==typeof c&&(c=[Math.floor(a.width/2),Math.floor(a.height/2)]);var h=new Array(2);h[0]=new Array(3),h[1]=new Array(3);var i=Math.round(100*Math.cos(b))/100,j=Math.round(100*Math.sin(b))/100;h[0][0]=h[1][1]=i,h[0][1]=j,h[0][2]=(1-i)*c[0]-j*c[1],h[1][0]=-j,h[1][2]=j*c[0]+(1-i)*c[1];var k=function(a,b,c){var d=h[0][0]*c+h[0][1]*b+h[0][2],e=h[1][0]*c+h[1][1]*b+h[1][2];return g.get(Math.floor(e),Math.floor(d))},l=function(a,b,c,d){var e=h[0][0]*c+h[0][1]*b+h[0][2],f=h[1][0]*c+h[1][1]*b+h[1][2];return g.get(Math.floor(f),Math.floor(e),d)},m=null;return m=1==e?f.mapPar(2,k):f.mapPar(3,l),d=new jscv.coredt.Image(d.width,d.height,d.elementalType,d.colorMode,TypedObject.storage(m).buffer)},jscv.imgproc.rotateSeq_=function(a,b,c){var d=new jscv.coredt.Image(a),e=a.nChannel,b=b*Math.PI/180,f=d.data,g=a.data;"undefined"==typeof c&&(c=[Math.floor(a.width/2),Math.floor(a.height/2)]);var h=new Array(2);h[0]=new Array(3),h[1]=new Array(3);var i=Math.round(100*Math.cos(b))/100,j=Math.round(100*Math.sin(b))/100;h[0][0]=h[1][1]=i,h[0][1]=j,h[0][2]=(1-i)*c[0]-j*c[1],h[1][0]=-j,h[1][2]=j*c[0]+(1-i)*c[1];for(var k=0,l=0;l<d.height;l++)for(var m=0;m<d.width;m++){var n=h[0][0]*m+h[0][1]*l+h[0][2],o=h[1][0]*m+h[1][1]*l+h[1][2];if(1==e)f.data[k]=g.get(Math.floor(o),Math.floor(n)),k++;else for(var p=0;e>p;p++)f.data[k]=g.get(Math.floor(o),Math.floor(n),p),k++}return d},jscv.imgproc.computeMoments=function(a){var b=null,c=[];if(a instanceof jscv.coredt.Image)b=a.data;else if(a instanceof jscv.coredt.Matrix)b=a;else if(a instanceof Array)c=a;else{var d;a instanceof jscv.coredt.ContourNode&&(d=a.contour),d.approxMethod==jscv.FREEMAN_CHAIN_CODE&&(d=jscv.cv.convertContourApprox(d,jscv.CHAIN_APPROX_SIMPLE)),c=d.seqData}if(b&&b.depth>1)throw new Error("jscv.imgproc.computeMoments only supports data of a grayscale image");var e=!1;if("boolean"==typeof arguments[1]&&(e=arguments[1],b||(e=!0)),b)for(var f=b.nRow,g=b.nCol,h=b.data,i=0,j=0;f>j;j++)for(var k=0;g>k;k++)jscv.utility.isZero(h[i])||c.push(new jscv.coredt.Point(k,j)),i++;var l=400,m=void 0,n=arguments.length;arguments[n-1]instanceof jscv.RunConfig_&&(m=arguments[n-1]);var o=jscv.utility.processUserConfig_(m);if(o==jscv.NO_ENFORCE){var p=c.length;o=p>=l?jscv.ENFORCE_PARALLEL:jscv.ENFORCE_SEQUENTIAL}return e&&(b=null),o==jscv.ENFORCE_PARALLEL?jscv.imgproc.computeMomentsPar_(c,b):jscv.imgproc.computeMomentsSeq_(c,b)},jscv.imgproc.computeMomentsSeq_=function(a,b){var c=new jscv.coredt.Moments;if(0==a.length)return c;for(var d=b.data,e=b.nCol,f=[],g=0;g<a.length;g++){var h=a[g].x,i=a[g].y;f[g]=i*e+h}for(var j,k,l,m,n,o,p,q=0;2>q;q++){q?(j=c.spatial[1][0]/c.spatial[0][0],k=c.spatial[0][1]/c.spatial[0][0]):(j=0,k=0);for(var g=0;g<a.length;g++){l=a[g].x,m=a[g].y,p=f[g],n=1;for(var r=0;4>r;r++){0==r?n=1:n*=l-j;for(var s=0;4>s;s++)3>=r+s&&(0==s?o=n:o*=m-k,q?c.central[r][s]+=d?d[p]*o:o:c.spatial[r][s]+=d?d[p]*o:o)}}}for(var r=0;4>r;r++)for(var s=0;4>s;s++)3>=r+s&&(c.normCentral[r][s]=c.central[r][s]/Math.pow(c.spatial[0][0],(r+s)/2+1));return c},jscv.imgproc.computeMomentsPar_=function(a,b){var c=new jscv.coredt.Moments;if(0==a.length)return c;var d=b.getNdView(),e=0,f=0,g=function(b,c,g){if(c+g>3)return b;var h=function(a){var b=a.x,h=a.y,i=1;d&&(i=d[h][b]);for(var j=1,k=1,l=0;c>l;l++)j*=b-e;for(var m=0;g>m;m++)k*=h-f;return i*j*k},i=a.mapPar(h),j=function(a,b){return a+b};return i.reducePar(j)};c.spatial=c.spatial.mapPar(2,g),e=c.spatial[1][0]/c.spatial[0][0],f=c.spatial[0][1]/c.spatial[0][0],c.central=c.central.mapPar(2,g);for(var h=0;4>h;h++)for(var i=0;4>i;i++)3>=h+i&&(c.normCentral[h][i]=c.central[h][i]/Math.pow(c.spatial[0][0],(h+i)/2+1));return c},jscv.imgproc.huMoments=function(a){var b=new Float64Array(7),c=function(a){return a*a},d=a.normCentral;return b[0]=d[2][0]+d[0][2],b[1]=c(d[2][0]-d[0][2])+4*c(d[1][1]),b[2]=c(d[3][0]-3*d[1][2])+c(3*d[2][1]-d[0][3]),b[3]=c(d[3][0]+d[1][2])+c(d[2][1]+d[0][3]),b[4]=(d[3][0]-3*d[1][2])*(d[3][0]+d[1][2])*(c(d[3][0]+d[1][2])-3*c(d[2][1]+d[0][3])),b[4]+=(3*d[2][1]-d[0][3])*(d[2][1]+d[0][3])*(3*c(d[3][0]+d[1][2])-c(d[2][1]+d[0][3])),b[5]=(d[2][0]-d[0][2])*(c(d[3][0]+d[1][2])-c(d[2][1]+d[0][3])),b[5]+=4*d[1][1]*(d[3][0]+d[1][2])*(d[2][1]+d[0][3]),b[6]=(3*d[2][1]-d[0][3])*(d[3][0]+d[1][2])*(c(d[3][0]+d[1][2])-3*c(d[2][1]+d[0][3])),b[6]-=(d[3][0]-3*d[1][2])*(d[2][1]+d[0][3])*(3*c(d[3][0]+d[1][2])-c(d[2][1]+d[0][3])),b},jscv.imgproc.matchShape=function(a,b){var c=function(a){return 0>a?-1:a>0?1:0},d=function(a){return Math.log(a)/Math.log(10)},e=jscv.MATCH_SHAPE_I1;"number"==typeof arguments[2]&&jscv.SUPPORT_MATCH_SHAPE.indexOf(arguments[2])>=0&&(e=arguments[2]);var f=void 0,g=arguments.length;arguments[g-1]instanceof jscv.RunConfig_&&(f=arguments[g-1]);for(var h=jscv.imgproc.computeMoments(a,f),i=jscv.imgproc.huMoments(h),j=jscv.imgproc.computeMoments(b,f),k=jscv.imgproc.huMoments(j),l=new Float64Array(7),m=new Float64Array(7),n=0;7>n;n++)l[n]=c(i[n])*d(i[n]),m[n]=c(k[n])*d(k[n]);var o=0;if(e==jscv.MATCH_SHAPE_I1)for(var n=0;7>n;n++)o+=Math.abs(1/l[n]-1/m[n]);else if(e==jscv.MATCH_SHAPE_I2)for(var n=0;7>n;n++)o+=Math.abs(l[n]-m[n]);else if(e==jscv.MATCH_SHAPE_I3)for(var n=0;7>n;n++){var p=Math.abs((l[n]-m[n])/l[n]);p>o&&(o=p)}else o=void 0;return o},jscv.imgproc.SHARPEN_MATRIX_=[[-1,-1,-1],[-1,9,-1],[-1,-1,-1]],jscv.imgproc.sharpen=function(a,b){var c=new jscv.coredt.Matrix(jscv.int8,jscv.imgproc.SHARPEN_MATRIX_),d=new jscv.coredt.Image(a.width,a.height,a.elementalType,a.colorMode);if(1==a.nChannel)d.data=jscv.math.convolveMat(a.data,c,b);else{if(a.colorMode==jscv.COLOR_RGBA)convolvedPlaneArr=[0,1,2];else for(var e=0;e<a.nChannel;e++)convolvedPlaneArr.push(e);d.data=jscv.math.convolveMat(a.data,convolvedPlaneArr,c,b)}return d},jscv.imgproc.sobelEdgeDetect=function(a,b){if(a.colorMode!=jscv.COLOR_GRAY)throw new Error("Edge detect available for grayscale images only");var c=jscv.utility.processUserConfig_(b);return c==jscv.ENFORCE_PARALLEL?jscv.imgproc.sobelEdgeDetectPar_(a):c==jscv.ENFORCE_SEQUENTIAL?jscv.imgproc.sobelEdgeDetectSeq_(a):jscv.imgproc.sobelEdgeDetectPar_(a)},jscv.imgproc.sobelEdgeDetectSeq_=function(a){for(var b=new jscv.coredt.Image(a.width,a.height,a.elementalType,a.colorMode),c=jscv.imgproc.sobel(a.data,jscv.X_DIRECTION,jscv.ENFORCE_SEQUENTIAL),d=jscv.imgproc.sobel(a.data,jscv.Y_DIRECTION,jscv.ENFORCE_SEQUENTIAL),e=c.data,f=d.data,g=b.data.data,h=g.length,i=0;h>i;i++)g[i]=jscv.utility.clampValue(Math.sqrt(e[i]*e[i]+f[i]*f[i]),b.elementalType);return b},jscv.imgproc.sobelEdgeDetectPar_=function(a){var b=new jscv.coredt.Image(a.width,a.height,a.elementalType,a.colorMode),c=jscv.imgproc.sobel(a.data,jscv.X_DIRECTION,jscv.ENFORCE_PARALLEL),d=jscv.imgproc.sobel(a.data,jscv.Y_DIRECTION,jscv.ENFORCE_PARALLEL),e=c.data,f=d.data,g=function(a,c){return jscv.utility.clampValue(Math.sqrt(a*a+f[c]*f[c]),b.elementalType)};return b.data.data=e.mapPar(g),b},jscv.math.haveSameDimension=function(a,b){return a.nRow==b.nRow&&a.nCol==b.nCol&&a.depth==b.depth},jscv.math.areEqualMat=function(a,b,c){if(!jscv.math.haveSameDimension(a,b)||a.elementalType!=b.elementalType)return!1;var d,e;void 0==c&&(c=jscv.DEFAULT_ZERO_THRESHOLD_FLOAT64);for(var f=a.data.length,g=0;f>g;g++)if(d=a.data[g],e=b.data[g],!jscv.utility.isZero(Math.abs(d-e),c))return!1;return!0},jscv.math.haveSameDataMat=function(a,b,c){if(!jscv.math.haveSameDimension(a,b))return!1;void 0==c&&(c=jscv.DEFAULT_ZERO_THRESHOLD_FLOAT64);for(var d,e,f=a.data.length,g=0;f>g;g++)if(d=a.data[g],e=b.data[g],!jscv.utility.isZero(Math.abs(d-e),c))return!1;return!0},jscv.math.isSymmetric=function(a,b){var c=a.depth,d=a.nRow,e=a.nCol;if(d!=e)return!1;void 0==b&&(b=jscv.DEFAULT_ZERO_THRESHOLD_FLOAT64);for(var f=0,g=0,h=0;d>h;h++){for(var i=f,j=g,k=0;h>k;k++){if(1==c){if(!jscv.utility.isZero(a.data[i]-a.data[j],b))return!1}else for(var l=0;c>l;l++)if(!jscv.utility.isZero(a.data[i+l]-a.data[j+l],b))return!1;i+=a.stride[1],j+=a.stride[0]}f+=a.stride[0],g+=a.stride[1]}return!0},jscv.math.isLowerTrapezoidal=function(a,b){if(a.depth>1)throw new Error("Input is a matrix of arrays of numbers. Only matrices of numbers are supported in jscv.math.isLowerTrapezoidal");void 0==b&&(b=jscv.DEFAULT_ZERO_THRESHOLD_FLOAT64);for(var c=a.nRow,d=a.nCol,e=Math.min(c,d),f=0,g=0;e>g;g++){for(var h=f+g+1,i=g+1;d>i;i++){if(!jscv.utility.isZero(a.data[h],b))return!1;h++}f+=d}return!0},jscv.math.isUpperTrapezoidal=function(a,b){if(a.depth>1)throw new Error("Input is a matrix of arrays of numbers. Only matrices of numbers are supported in jscv.math.isUpperTrapezoidal");void 0==b&&(b=jscv.DEFAULT_ZERO_THRESHOLD_FLOAT64);var c=a.nRow,d=a.nCol;Math.min(c,d);for(var e=d,f=1;c>f;f++){for(var g=e,h=0;h<Math.min(f,d);h++){if(!jscv.utility.isZero(a.data[g],b))return!1;g++}e+=d}return!0},jscv.math.isTrapezoidal=function(a,b){if(a.depth>1)throw new Error("Input is a matrix of arrays of numbers. Only matrices of numbers are supported in jscv.math.isTrapezoidal");return void 0==b&&(b=jscv.DEFAULT_ZERO_THRESHOLD_FLOAT64),jscv.math.isLowerTrapezoidal(a,b)||jscv.math.isUpperTrapezoidal(a,b)},jscv.math.isLowerTriangular=function(a,b){if(a.depth>1)throw new Error("Input is a matrix of arrays of numbers. Only matrices of numbers are supported in jscv.math.isLowerTriangular");return a.nRow==a.nCol&&jscv.math.isLowerTrapezoidal(a,b)},jscv.math.isUpperTriangular=function(a,b){if(a.depth>1)throw new Error("Input is a matrix of arrays of numbers. Only matrices of numbers are supported in jscv.math.isUpperTriangular");return a.nRow==a.nCol&&jscv.math.isUpperTrapezoidal(a,b)},jscv.math.isTriangular=function(a,b){if(a.depth>1)throw new Error("Input is a matrix of arrays of numbers. Only matrices of numbers are supported in jscv.math.isUpperTriangular");return a.nRow==a.nCol&&(jscv.math.isLowerTriangular(a,b)||jscv.math.isUpperTriangular(a,b))},jscv.math.isRowEchelonForm=function(a,b){if(a.depth>1)throw new Error("Input is a matrix of arrays of numbers. Only matrices of numbers are supported in jscv.math.isRowEchelonForm");void 0==b&&(b=jscv.DEFAULT_ZERO_THRESHOLD_FLOAT64);for(var c=-1,d=-1,e=a.nRow,f=a.nCol,g=0,h=0;e>h;h++){d=f;for(var i=g,j=0;f>j;j++){if(!jscv.utility.isZero(a.data[i],b)){d=j;break}i++}if(d!=f&&c>=d)return!1;c=d,g+=f}return!0},jscv.math.isReducedRowEchelonForm=function(a,b){if(a.depth>1)throw new Error("Input is a matrix of arrays of numbers. Only matrices of numbers are supported in jscv.math.isReducedRowEchelonForm");void 0==b&&(b=jscv.DEFAULT_ZERO_THRESHOLD_FLOAT64);for(var c=a.nRow,d=a.nCol,e=-1,f=-1,g=0,h=0;c>h;h++){f=d;for(var i=g,j=0;d>j;j++){if(!jscv.utility.isZero(a.data[i],b)){f=j;break}i++}if(f!=d&&e>=f)return!1;if(f!=d){if(!jscv.utility.isZero(1-a.data[g+f],b))return!1;for(var k=0,l=0;h>l;l++){if(!jscv.utility.isZero(a.data[k+f],b))return!1;k+=d}}e=f,g+=d}return!0},jscv.math.areRowEquivalent=function(a,b,c){if(a.depth>1||b.depth>1)throw new Error("Inputs are matrices of arrays of numbers. Only matrices of numbers are supported in jscv.math.areRowEquivalent");if(!jscv.math.haveSameDimension(a,b))return!1;if(jscv.math.haveSameDataMat(a,b,c))return!0;void 0==c&&(c=jscv.DEFAULT_ZERO_THRESHOLD_FLOAT64);var d=jscv.math.gaussJordanEliminate(a,c),e=jscv.math.gaussJordanEliminate(b,c);return jscv.math.areEqualMat(d,e)},jscv.math.cholesky=function(a,b){var c=a.nRow,d=a.nCol,e=a.depth;if(void 0==b&&(b=jscv.DEFAULT_ZERO_THRESHOLD_FLOAT64),e>1)throw new Error("Input is a matrix of arrays of numbers. Only matrices of numbers are supported in jscv.math.cholesky");if(c!=d)return null;if(!jscv.math.isSymmetric(a,b))return null;for(var f=new jscv.coredt.Matrix(a.shape,jscv.float64),g=f.data,h=a.data,i=0;c>i;i++)for(var j=0;i>=j;j++){for(var k=0,l=0;j>l;l++)k+=g[i*d+l]*g[j*d+l];if(i==j){var m=h[i*d+i]-k;if(jscv.utility.isZero(m,b)&&(m=b*b),0>m)return null;g[i*d+i]=Math.sqrt(m)}else g[i*d+j]=(h[i*d+j]-k)/g[j*d+j]}return f},jscv.math.det=function(){var a=jscv.DEFAULT_ZERO_THRESHOLD_FLOAT64,b=!1,c=jscv.LU_METHOD,d=arguments[0],e=1;if(arguments.length>e&&"number"==typeof arguments[e]&&(a=arguments[e],e++),arguments.length>e&&"boolean"==typeof arguments[e]&&(b=arguments[e],e++),arguments.length>e&&arguments[e]instanceof Object&&(c=arguments[e]),d.hasOwnProperty("lower")&&d.hasOwnProperty("upper")&&d.hasOwnProperty("rowPermu"))return jscv.math.detLu_(d,a,b);if(!(d instanceof jscv.coredt.Matrix))throw new Error("Invalid data type for the input matrix in jscv.math.det");
var f=d;if(f.depth>1)throw new Error("Input is a matrix of arrays of numbers. Only matrices of numbers are supported in jscv.math.det");if(f.nRow!=f.nCol)throw new Error("Input matrix is NOT a square matrix. Determinant is only defined for square matrices");if(JSON.stringify(c)==JSON.stringify(jscv.GAUSS_METHOD))return jscv.math.detGauss_(f,a,b);var g=jscv.math.luDecomposeGauss(f,a);return jscv.math.detLu_(g,a,b)},jscv.math.detGauss_=function(a){if(a.depth>1)throw new Error("Input is a matrix of arrays of numbers. Only matrices of numbers are supported in jscv.math.detGauss_");if(a.nRow!=a.nCol)throw new Error("Input matrix is NOT a square matrix. Determinant is only defined for square matrices");var b=!1,c=jscv.DEFAULT_ZERO_THRESHOLD_FLOAT64,d=1;arguments.length>d&&"number"==typeof arguments[d]&&(c=arguments[d],d++),arguments.length>d&&"boolean"==typeof arguments[d]&&(b=arguments[d]);var e,f=function(a){return a>0?1:0>a?-1:0},g=jscv.math.gaussEliminate_(a,c,!0),h=g.echelon,i=g.rowPermu;e=b?0:1;for(var j=h.nRow,k=1,l=0,m=0;j>m;m++){if(jscv.utility.isZero(h.data[l],c))return b?{sign:0,logVal:-1/0}:0;b?(k*=f(h.data[l]),e+=Math.log(Math.abs(h.data[l]))):e*=h.data[l],l+=j+1}var n=jscv.math.utility.findNumSwapToIdentity_(i);return 1&n&&(b?k=-k:e=-e),b?{sign:k,logVal:e}:e},jscv.math.detLu_=function(a){if(!(a.hasOwnProperty("upper")&&a.hasOwnProperty("lower")&&a.hasOwnProperty("rowPermu")))throw new Error("Invalid object for representing an LU decomposition");var b=a.upper,c=a.lower,d=a.rowPermu;if(b.depth>1||c.depth>1)throw new Error("Inputs are matrices of arrays of numbers. Only matrices of numbers are supported in jscv.math.detLu_");if(c.nRow!=b.nCol||c.nRow!=c.nCol||b.nRow!=b.nCol)throw new Error("Input matrices are NOT a square matrix. Determinant is only defined for square matrices");var e=!1,f=jscv.DEFAULT_ZERO_THRESHOLD_FLOAT64,g=1;arguments.length>g&&"number"==typeof arguments[g]&&(f=arguments[g],g++),arguments.length>g&&"boolean"==typeof arguments[g]&&(e=arguments[g]);var h,i=function(a){return a>0?1:0>a?-1:0};h=e?0:1;for(var j=1,k=0,l=0;l<b.nRow;l++){if(jscv.utility.isZero(b.data[k],f))return e?{sign:0,logVal:-1/0}:0;e?(j*=i(b.data[k]),h+=Math.log(Math.abs(b.data[k]))):h*=b.data[k],k+=b.nRow+1}k=0;for(var l=0;l<c.nRow;l++){if(jscv.utility.isZero(c.data[k],f))return e?{sign:0,logVal:-1/0}:0;e?(j*=i(c.data[k]),h+=Math.log(Math.abs(c.data[k]))):h*=c.data[k],k+=c.nRow+1}var m=jscv.math.utility.findNumSwapToIdentity_(d);return 1&m&&(e?j=-j:h=-h),e?{sign:j,logVal:h}:h},jscv.math.invMat=function(){var a=jscv.DEFAULT_ZERO_THRESHOLD_FLOAT64,b=jscv.LU_METHOD,c=arguments[0],d=1;if(arguments.length>d&&"number"==typeof arguments[d]&&(a=arguments[d],d++),c.hasOwnProperty("lower")&&c.hasOwnProperty("upper")&&c.hasOwnProperty("rowPermu"))return jscv.math.invLu_(c,a);if(!(c instanceof jscv.coredt.Matrix))throw new Error("Invalid data type for the input matrix in jscv.math.invMat");var e=c;if(e.depth>1)throw new Error("Input is a matrix of arrays of numbers. Only matrices of numbers are supported in jscv.math.invMat");if(arguments.length>d&&arguments[d]instanceof Object&&(b=arguments[d]),JSON.stringify(b)==JSON.stringify(jscv.GAUSS_METHOD))return jscv.math.invGauss_(e,a);var f=jscv.math.luDecomposeGauss(e,a);return jscv.math.invLu_(f,a)},jscv.math.invGauss_=function(a,b){if(a.depth>1)throw new Error("Input is a matrix of arrays of numbers. Only matrices of numbers are supported in jscv.math.invGauss_");if(void 0==b&&(b=jscv.DEFAULT_ZERO_THRESHOLD_FLOAT64),a.nRow!=a.nCol)return null;var c=a.nRow,d=jscv.math.identity(c,jscv.float64),e=jscv.math.augmentMat(a,d,jscv.float64);e=jscv.math.gaussJordanEliminate(e,b);var f=jscv.math.getSubMat(e,[0,c-1,0,c-1]);return jscv.math.areEqualMat(f,d)?jscv.math.getSubMat(e,[0,c-1,c,e.nCol-1]):null},jscv.math.invLu_=function(a,b){if(!(a.hasOwnProperty("lower")&&a.hasOwnProperty("upper")&&a.hasOwnProperty("rowPermu")))throw new Error("Invalid object for representing an LU decomposition");if(void 0==b&&(b=jscv.DEFAULT_ZERO_THRESHOLD_FLOAT64),a.lower.nRow!=a.upper.nCol)return null;var c=jscv.math.identity([a.lower.nRow,a.upper.nCol],jscv.float64);return jscv.math.linalgSolveLu(a,c,b)},jscv.math.leastSquareNormalEqn=function(a,b,c){if(a.depth>1||b.depth>1)throw new Error("Inputs are matrices of arrays of numbers. Only matrices of numbers are supported in jscv.math.leastSquareNormEqn");if(b.nCol>1)throw new Error("The right hand side must be a vector in jscv.math.leastSquareNormEqn");if(a.nRow!=b.nRow)throw new Error("Input matrix and vector have incompatible dimension");void 0==c&&(c=jscv.DEFAULT_ZERO_THRESHOLD_FLOAT64);var d=jscv.math.transposeMat(a),e=jscv.math.mulMat(d,a),f=jscv.math.mulMat(d,b);return jscv.math.linalgSolve(e,f,c,jscv.POSITIVE_DEFINITE_MAT)},jscv.math.identity=function(){var a,b,c=0;arguments[c]instanceof Array?(a=arguments[c][0],b=arguments[c].length>1?arguments[c][1]:a,c++):(a=arguments[c],c++,"number"==typeof arguments[c]?(b=arguments[c],c++):b=a);var d=jscv.uint8;jscv.SUPPORT_DATA_TYPE.indexOf(arguments[c])>=0&&(d=arguments[c]);for(var e=new jscv.coredt.Matrix([a,b],d),f=Math.min(a,b),g=0,h=0;f>h;h++)e.data[g]=1,g+=b+1;return e},jscv.math.transposeMat=function(a){for(var b=a.nRow,c=a.nCol,d=a.depth,e=new jscv.coredt.Matrix([c,b,d],a.elementalType),f=0,g=0,h=0;c>h;h++){for(var i=g,j=0;b>j;j++){if(1==d)e.data[f]=a.data[i],f++;else for(var k=0;d>k;k++)e.data[f]=a.data[i+k],f++;i+=a.stride[0]}g+=a.stride[1]}return e},jscv.math.frobeniusNorm=function(a){var b=a.depth;if(b>1)throw new Error("Input is a matrix of arrays of numbers. Only matrices of numbers are supported in jscv.math.frobeniusNorm");for(var c=0,d=a.data,e=d.length,f=0;e>f;f++)c+=d[f]*d[f];return Math.sqrt(c)},jscv.math.eigJacobi=function(a,b){var c=a.depth;if(c>1)throw new Error("Input is a matrix of arrays of numbers. Only matrices of numbers are supported in jscv.math.eigJacobi");if(!jscv.math.isSymmetric(a,b))throw new Error("jscv.math.eigJacobi only works with symmetric matrices");void 0==b&&(b=jscv.DEFAULT_ZERO_THRESHOLD_FLOAT64),a=jscv.utility.convertMatType(a,jscv.float64);for(var d,e,f,g=function(a){for(var b=a.nRow,c=a.nCol,d=0,e=0,f=0;b>f;f++)for(var g=0;c>g;g++)f!=g&&(d+=a.data[e]*a.data[e]),e++;return Math.sqrt(d)},h=function(a,b,c,d){var e,f,g=a.nCol;if(jscv.utility.isZero(a.data[b*g+c],d))e=1,f=0;else{var h=(a.data[c*g+c]-a.data[b*g+b])/(2*a.data[b*g+c]),i=0;i=0>h?-1/(-h+Math.sqrt(1+h*h)):1/(h+Math.sqrt(1+h*h)),e=1/Math.sqrt(1+i*i),f=i*e}return[e,f]},i=function(a,b,c,d,e){for(var f,g,h=a.nCol,i=d*h,j=e*h,k=0;h>k;k++)f=a.data[i],g=a.data[j],a.data[i]=b*f-c*g,a.data[j]=c*f+b*g,i++,j++},j=function(a,b,c,d,e){for(var f,g,h=a.nRow,i=a.nCol,j=d,k=e,l=0;h>l;l++)f=a.data[j],g=a.data[k],a.data[j]=b*f-c*g,a.data[k]=c*f+b*g,j+=i,k+=i},k=jscv.math.identity(a.shape,a.elementalType),l=a.nRow;!jscv.utility.isZero(g(a),b);)for(var m=0;l>m;m++)for(var n=m+1;l>n;n++)d=h(a,m,n,b),e=d[0],f=d[1],i(a,e,f,m,n),j(a,e,f,m,n),j(k,e,f,m,n);var o;o=a.elementalType==jscv.float32?new Float32Array(l):new Float64Array(l);for(var p=0,q=a.nCol,r=0;l>r;r++)o[r]=a.data[p],p+=q+1;return[o,k]},jscv.math.trace=function(a){if(a.depth>1)throw new Error("Input is a matrix of arrays of numbers. Only matrices of numbers are supported in jscv.math.trace");if(a.nRow!=a.nCol)return null;for(var b=0,c=a.nRow,d=a.nCol,e=0,f=0;c>f;f++)b+=a.data[e],e+=d+1;return b},jscv.math.gaussEliminate=function(a){if(a.depth>1)throw new Error("Input is a matrix of arrays of numbers. Only matrices of numbers are supported in jscv.math.gaussEliminate");var b=void 0,c=!1,d=1;arguments.length>d&&"number"==typeof arguments[d]&&(b=arguments[d],d++),arguments.length>d&&(c=arguments[d]),void 0==b&&(b=jscv.DEFAULT_ZERO_THRESHOLD_FLOAT64);var e=jscv.math.gaussEliminate_(a,b,c);return c?[e.echelon,e.rowPermu]:e.echelon},jscv.math.gaussJordanEliminate=function(a,b){if(a.depth>1)throw new Error("Input is a matrix of arrays of numbers. Only matrices of numbers are supported in jscv.math.gaussJordanEliminate");void 0==b&&(b=jscv.DEFAULT_ZERO_THRESHOLD_FLOAT64);for(var c=jscv.math.gaussEliminate(a,b),d=c.nRow,e=c.nCol,f=0,g=0;d>g;g++){for(var h=g,i=f+g;e>h&&jscv.utility.isZero(c.data[i],b);)h++,i++;if(h==e)break;i=f+h;var j=c.data[i];c.data[i]=1,i++;for(var k=h+1;e>k;k++)c.data[i]/=j,i++;for(var l=0,m=0;g>m;m++){var n=l+h;i=f+h;for(var o=c.data[n],k=h;e>k;k++)c.data[n]-=o*c.data[i],n++,i++;l+=e}f+=e}return c},jscv.math.augmentMat=function(a,b,c){if(a.nRow!=b.nRow)throw new Error("Input matrices have different number of rows. They are incompatible for agumenting");if(a.depth!=b.depth)throw new Error("Elements of input matrices are arrays of different size. They are incompatible for augmenting");(void 0==c||jscv.SUPPORT_DATA_TYPE.indexOf(c)<0)&&(c=jscv.utility.findMinSuperType(a.elementalType,b.elementalType));for(var d=a.nRow,e=a.nCol,f=b.nCol,g=a.depth,h=new jscv.coredt.Matrix([d,e+f,g],c),i=0,j=0,k=0;d>k;k++){for(var l=j,m=0;e>m;m++){if(1==g)h.data[l]=jscv.utility.clampValue(a.data[i],c),i++;else for(var n=0;g>n;n++)h.data[l+n]=jscv.utility.clampValue(a.data[i],c),i++;l+=h.stride[1]}j+=h.stride[0]}var o=0;j=e*h.stride[1];for(var k=0;d>k;k++){for(var l=j,m=0;f>m;m++){if(1==g)h.data[l]=jscv.utility.clampValue(b.data[o],c),o++;else for(var n=0;g>n;n++)h.data[l+n]=jscv.utility.clampValue(b.data[o],c),o++;l+=h.stride[1]}j+=h.stride[0]}return h},jscv.math.gaussEliminate_=function(a,b,c,d){if(a.depth>1)throw new Error("Input is a matrix of arrays of numbers. Only matrices of numbers are supported in jscv.math.gaussEliminate_");void 0==b&&(b=jscv.DEFAULT_ZERO_THRESHOLD_FLOAT64),void 0==c&&(c=!1),void 0==d&&(d=!1);var e=jscv.utility.convertMatType(a,jscv.float64),f=null;d&&(f=jscv.math.identity(a.nRow,jscv.float64));var g=a.nRow,h=a.nCol,i=Math.min(g,h),j=null;if(c){j=[];for(var k=0;g>k;k++)j[k]=k}scaleRowArr=[];for(var l=0,m=0;g>m;m++){for(var n=0,o=0;h>o;o++)Math.abs(a.data[l])>n&&(n=Math.abs(a.data[l])),l++;jscv.utility.isZero(n)?scaleRowArr.push(1):scaleRowArr.push(1/n)}for(var p,q,r,s,t=0;i>t;t++){p=t,q=t;for(var u=p*h+t,v=u+h,k=p+1;g>k;k++)Math.abs(e.data[v])*scaleRowArr[k]>Math.abs(e.data[u])*scaleRowArr[p]&&(p=k,u=v),v+=h;if(p!=q){u=p*h+t;for(var w=q*h+t,x=t;h>x;x++)r=e.data[u],e.data[u]=e.data[w],e.data[w]=r,u++,w++;if(d){u=p*g,w=q*g;for(var x=0;t>x;x++)r=f.data[u],f.data[u]=f.data[w],f.data[w]=r,u++,w++}c&&(r=j[q],j[q]=j[p],j[p]=r)}if(!jscv.utility.isZero(e.data[q*h+t],b))for(var w=q*h+t,v=w+h,y=(q+1)*g+t,k=q+1;g>k;k++){s=e.data[v]/e.data[w];for(var z=v+1,A=w+1,x=t+1;h>x;x++)e.data[z]-=s*e.data[A],z++,A++;e.data[v]=0,d&&(f.data[y]=s,y+=g),v+=h}}var B=new Object;return B.echelon=e,B.lower=f,B.rowPermu=j,B},jscv.math.permuteRowMat=function(a,b){var c="The input row permutation array is an invalid permutation";if(b.length!=a.nRow)throw new Error(c);for(var d=a.nCol,e=a.depth,f=a.nRow,g=new jscv.coredt.Matrix(a.shape,a.elementalType),h=[],i=0;f>i;i++)h.push(!1);for(var j,k=0,i=0;i<b.length;i++){if(j=b[i],0>j||j>=f||h[j])throw new Error(c);h[j]=!0;for(var l=j*a.stride[0],m=0;d>m;m++){if(1==e)g.data[k]=a.data[l],k++;else for(var n=0;e>n;n++)g.data[k]=a.data[l+n],k++;l+=a.stride[1]}}return g},jscv.math.luDecomposeGauss=function(a,b){if(a.depth>1)throw new Error("Input is a matrix of arrays of numbers. Only matrices of numbers are supported in jscv.math.luDecomposeGauss");void 0==b&&(b=jscv.DEFAULT_ZERO_THRESHOLD_FLOAT64);var c=jscv.math.gaussEliminate_(a,b,!0,!0),d=new Object;return d.upper=c.echelon,d.lower=c.lower,d.rowPermu=c.rowPermu,d},jscv.math.luDecomposeCrout=function(a,b){if(a.depth>1)throw new Error("Input is a matrix of arrays of numbers. Only matrices of numbers are supported in jscv.math.luDecomposeCrout");void 0==b&&(b=jscv.DEFAULT_ZERO_THRESHOLD_FLOAT64)},jscv.math.mapMatSeq_=function(a,b,c){jscv.SUPPORT_DATA_TYPE.indexOf(c)<0&&(c=a.elementalType);for(var d=new jscv.coredt.Matrix(a.shape,c),e=d.data,f=a.data,g=f.length,h=0;g>h;h++)e[h]=b(f[h],h);return d},jscv.math.mapMatPar_=function(a,b,c){jscv.SUPPORT_DATA_TYPE.indexOf(c)<0&&(c=a.elementalType);var d=new jscv.coredt.Matrix(a.shape,c);return d.data=d.data.mapPar(1,b),d},jscv.math.mapMat_=function(a,b){var c=a.elementalType;jscv.SUPPORT_DATA_TYPE.indexOf(arguments[2])>=0&&(c=arguments[2]);var d=void 0;arguments[arguments.length-1]instanceof jscv.RunConfig_&&(d=arguments[arguments.length-1]);var e=jscv.utility.processUserConfig_(d);return e==jscv.NO_ENFORCE&&(e=a.nRow*a.nCol*a.depth>=jscv.MIN_MATRIX_SIZE_FOR_PARALLEL?jscv.ENFORCE_PARALLEL:jscv.ENFORCE_SEQUENTIAL),e==jscv.ENFORCE_PARALLEL?jscv.math.mapMatPar_(a,b,c):jscv.math.mapMatSeq_(a,b,c)},jscv.math.scalarMulMat=function(a,b){var c=void 0,d=void 0,e=2;arguments.length>e&&!(arguments[e]instanceof jscv.coredt.Matrix||arguments[e]instanceof jscv.RunConfig_)&&(d=arguments[e],e++),arguments.length>e&&arguments[e]instanceof jscv.coredt.Matrix&&(c=arguments[e]),jscv.SUPPORT_DATA_TYPE.indexOf(d)<0&&(d=a.elementalType),void 0==c||jscv.math.haveSameDimension(a,c)||(c=void 0);var f=void 0;arguments[arguments.length-1]instanceof jscv.RunConfig_&&(f=arguments[arguments.length-1]);var g=jscv.utility.processUserConfig_(f);g==jscv.NO_ENFORCE&&(g=a.nRow*a.nCol*a.depth>=jscv.MIN_MATRIX_SIZE_FOR_PARALLEL?jscv.ENFORCE_PARALLEL:jscv.ENFORCE_SEQUENTIAL);var h=function(e,f){var g=1;void 0!=c&&(g=c.data[f]);var h=a.data[f];return g&&(h*=b),jscv.utility.clampValue(h,d)};return jscv.math.mapMat_(a,h,d,g)},jscv.math.addWeightedMat=function(a,b){if(!jscv.math.haveSameDimension(a,b))throw new Error("Cannot add two matrices of different sizes");var c=void 0,d=void 0,e=0,f=0,g=0,h=2;arguments.length>h&&"number"==typeof arguments[h]&&(e=arguments[h],h++),arguments.length>h&&"number"==typeof arguments[h]&&(f=arguments[h],h++),arguments.length>h&&"number"==typeof arguments[h]&&(g=arguments[h],h++),arguments.length>h&&!(arguments[h]instanceof jscv.coredt.Matrix||arguments[h]instanceof jscv.RunConfig_)&&(d=arguments[h],h++),arguments.length>h&&arguments[h]instanceof jscv.coredt.Matrix&&(c=arguments[h]),jscv.SUPPORT_DATA_TYPE.indexOf(d)<0&&(d=a.elementalType,a.elementalType!=b.elementalType&&(d=jscv.utility.findMinSuperType(a.elementalType,b.elementalType))),void 0==c||jscv.math.haveSameDimension(a,c)||(c=void 0);var i=void 0;arguments[arguments.length-1]instanceof jscv.RunConfig_&&(i=arguments[arguments.length-1]);var j=jscv.utility.processUserConfig_(i);j==jscv.NO_ENFORCE&&(j=a.nRow*a.nCol*a.depth>=jscv.MIN_MATRIX_SIZE_FOR_PARALLEL?jscv.ENFORCE_PARALLEL:jscv.ENFORCE_SEQUENTIAL);var k=function(h,i){var j=1;void 0!=c&&(j=c.data[i]);var k=a.data[i];return j&&(k=e*a.data[i]+f*b.data[i]+g),jscv.utility.clampValue(k,d)};return jscv.math.mapMat_(a,k,d,j)},jscv.math.applyBinaryOperatorMat_=function(a,b,c){if(!jscv.math.haveSameDimension(b,c))throw new Error("jscv.math.applyBinaryOperatorMat_ : The two matrices do not have compatible dimension");var d=void 0,e=void 0,f=3;arguments.length>f&&!(arguments[f]instanceof jscv.coredt.Matrix||arguments[f]instanceof jscv.RunConfig_)&&(e=arguments[f],f++),arguments.length>f&&arguments[f]instanceof jscv.coredt.Matrix&&(d=arguments[f]),jscv.SUPPORT_DATA_TYPE.indexOf(e)<0&&(e=b.elementalType,b.elementalType!=c.elementalType&&(e=jscv.utility.findMinSuperType(b.elementalType,c.elementalType))),void 0==d||jscv.math.haveSameDimension(b,d)||(d=void 0);var g=void 0;arguments[arguments.length-1]instanceof jscv.RunConfig_&&(g=arguments[arguments.length-1]);var h=jscv.utility.processUserConfig_(g);h==jscv.NO_ENFORCE&&(h=b.nRow*b.nCol*b.depth>=jscv.MIN_MATRIX_SIZE_FOR_PARALLEL?jscv.ENFORCE_PARALLEL:jscv.ENFORCE_SEQUENTIAL);var i=function(f,g){var h=1;void 0!=d&&(h=d.data[g]);var i=b.data[g];return h&&(i=a(i,c.data[g])),jscv.utility.clampValue(i,e)};return jscv.math.mapMat_(b,i,e,h)},jscv.math.addMat=function(){for(var a=function(a,b){return a+b},b=[a],c=0;c<arguments.length;c++)b.push(arguments[c]);return result=jscv.math.applyBinaryOperatorMat_.apply(null,b)},jscv.math.subMat=function(){for(var a=function(a,b){return a-b},b=[a],c=0;c<arguments.length;c++)b.push(arguments[c]);return jscv.math.applyBinaryOperatorMat_.apply(null,b)},jscv.math.absSubMat=function(){for(var a=function(a,b){var c=a-b;return 0>c&&(c=-c),c},b=[a],c=0;c<arguments.length;c++)b.push(arguments[c]);return jscv.math.applyBinaryOperatorMat_.apply(null,b)},jscv.math.elementwiseMulMat=function(){for(var a=function(a,b){return a*b},b=[a],c=0;c<arguments.length;c++)b.push(arguments[c]);return jscv.math.applyBinaryOperatorMat_.apply(null,b)},jscv.math.elementwiseDivMat=function(){for(var a=function(a,b){return a/b},b=[a],c=0;c<arguments.length;c++)b.push(arguments[c]);return jscv.math.applyBinaryOperatorMat_.apply(null,b)},jscv.math.bitwiseAndMat=function(){for(var a=function(a,b){return a&b},b=[a],c=0;c<arguments.length;c++)b.push(arguments[c]);return jscv.math.applyBinaryOperatorMat_.apply(null,b)},jscv.math.bitwiseOrMat=function(){for(var a=function(a,b){return a|b},b=[a],c=0;c<arguments.length;c++)b.push(arguments[c]);return jscv.math.applyBinaryOperatorMat_.apply(null,b)},jscv.math.bitwiseXorMat=function(){for(var a=function(a,b){return a^b},b=[a],c=0;c<arguments.length;c++)b.push(arguments[c]);return jscv.math.applyBinaryOperatorMat_.apply(null,b)},jscv.math.convolveMat=function(){var a,b=arguments.length,c=arguments[0],d=[],e=0;arguments[1]instanceof jscv.coredt.Matrix?(a=arguments[1],e=2):(d=arguments[1],"number"==typeof d&&(d=[d]),a=arguments[2],e=3);var f,g,h,i=0;g=-1,h=-1,e>=b||jscv.SUPPORT_DATA_TYPE.indexOf(arguments[e])<0?f=jscv.utility.findMinSuperType(c.elementalType,a.elementalType):(f=arguments[e],e++),b>e&&(arguments[e]instanceof Array?(g=arguments[e][0],h=arguments[e][1],e++):arguments[e]instanceof jscv.coredt.Point?(h=arguments[e].x,g=arguments[e].y,e++):"number"==typeof arguments[e]&&(g=arguments[e],e++,b>e&&"number"==typeof arguments[e]&&(h=arguments[e],e++)));var j=void 0;b>e&&"string"==typeof arguments[e]&&(j=arguments[e],e++),b>e&&(i=arguments[e]),(void 0==j||jscv.SUPPORT_BORDER_TYPE.indexOf(j)<0)&&(i=0,j=jscv.BORDER_REPLICATE),i=j!=jscv.BORDER_CONSTANT?0:jscv.utility.clampValue(i,f),c.nRow,c.nCol;var k=c.depth,l=a.nRow,m=a.nCol;if((0>g||0>h)&&(g=l-1>>1,h=m-1>>1),k>1&&0==d.length)for(var n=0;k>n;n++)d.push(n);var o=void 0;arguments[b-1]instanceof jscv.RunConfig_&&(o=arguments[b-1]);var p=jscv.utility.processUserConfig_(o);if(p==jscv.NO_ENFORCE){var q=c.nRow*c.nCol;k>1&&(consolutionSize*=d.length),p=q>=jscv.MIN_MATRIX_SIZE_FOR_PARALLEL?jscv.ENFORCE_PARALLEL:jscv.ENFORCE_SEQUENTIAL}return p==jscv.ENFORCE_SEQUENTIAL?jscv.math.convolveMatSeq_(c,d,a,f,g,h,j,i):jscv.math.convolveMatPar_(c,d,a,f,g,h,j,i)},jscv.math.computeSumProduct_=function(a,b,c,d,e){for(var f=0,g=0,h=b-d*a.stride[0]-e,i=0;i<c.nRow;i++){for(var j=h,k=0;k<c.nCol;k++)f+=a.data[j]*c.data[g],g++,j++;h+=a.stride[0]}return f},jscv.math.computeSumProduct3d_=function(a,b,c,d,e){for(var f=0,g=0,h=b-d*a.stride[0]-e*a.stride[1],i=0;i<c.nRow;i++){for(var j=h,k=0;k<c.nCol;k++)f+=a.data[j]*c.data[g],g++,j+=a.stride[1];h+=a.stride[0]}return f},jscv.math.convolveMatSeq_=function(a,b,c,d,e,f,g,h){var i,j=a.depth,k=a.nRow,l=a.nCol,m=e,n=c.nRow-1-e,o=f,p=c.nCol-1-f,q=[m,n,o,p],r=jscv.utility.copyMakeBorder(a,q,g,h);if(i=1==j||j>1&&b.length==j?new jscv.coredt.Matrix(a.shape,d):jscv.utility.convertMatType(a,d),1==j)for(var s=0,t=m*r.stride[0]+o,u=0;k>u;u++){for(var v=t,w=0;l>w;w++)i.data[s]=jscv.utility.clampValue(jscv.math.computeSumProduct_(r,v,c,e,f),d),s++,v++;t+=r.stride[0]}else for(var x=0;x<b.length;x++)for(var y=b[x],z=y,t=y+m*r.stride[0]+o*r.stride[1],u=0;k>u;u++){for(var s=z,v=t,w=0;l>w;w++){var A=jscv.utility.clampValue(jscv.math.computeSumProduct3d_(r,v,c,e,f),d);i.data[s]=A,s+=i.stride[1],v+=r.stride[1]}z+=i.stride[0],t+=r.stride[0]}return i},jscv.math.computeSumProductPar_=function(a,b,c,d,e,f){for(var g=0,h=d.length,i=d[0].length,j=0;h>j;j++)for(var k=0;i>k;k++)g+=a[b+j-e][c+k-f]*d[j][k];return g},jscv.math.computeSumProduct3dPar_=function(a,b,c,d,e,f,g){for(var h=0,i=e.length,j=e[0].length,k=0;i>k;k++)for(var l=0;j>l;l++)h+=a[b+k-f][c+l-g][d]*e[k][l];return h},jscv.math.convolveMatPar_=function(a,b,c,d,e,f,g,h){var i=a.depth;a.nRow,a.nCol;var j=e,k=c.nRow-1-e,l=f,m=c.nCol-1-f,n=[j,k,l,m],o=jscv.utility.copyMakeBorder(a,n,g,h),p=[];if(i>1){for(var q=0;i>q;q++)p.push(!1);for(var r=0;r<b.length;r++){var s=b[r];p[s]=!0}}var t,u=a.getNdView(),v=o.getNdView(),w=c.getNdView(),x=function(a,b,c){return jscv.utility.clampValue(jscv.math.computeSumProductPar_(v,b+j,c+l,w,e,f),d)},y=function(a,b,c,g){return p[g]?jscv.utility.clampValue(jscv.math.computeSumProduct3dPar_(v,b+j,c+l,g,w,e,f),d):u[b][c][g]},z=new jscv.coredt.Matrix(a.shape,d),A=z.getNdView();return t=1==i?A.mapPar(2,x):A.mapPar(3,y),new jscv.coredt.Matrix(a.shape,d,TypedObject.storage(t).buffer)},jscv.math.mulMat=function(a,b){if(1!=a.depth||1!=b.depth)throw new Error("Inputs are matrices of arrays of numbers. Only matrices of numbers are supported in jscv.math.mulMat");if(a.nCol!=b.nRow)throw new Error("Matrices have dimensions incompatible for multiplication");var c=void 0;arguments[2]instanceof jscv.RunConfig_||(c=arguments[2]),jscv.SUPPORT_DATA_TYPE.indexOf(c)<0&&(c=a.elementalType,a.elementalType!=b.elementalType&&(c=jscv.utility.findMinSuperType(a.elementalType,b.elementalType)));var d=void 0;arguments[arguments.length-1]instanceof jscv.RunConfig_&&(d=arguments[arguments.length-1]);var e=jscv.utility.processUserConfig_(d);return e==jscv.NO_ENFORCE&&(e=a.nRow*b.nCol>=jscv.MIN_MATRIX_SIZE_FOR_PARALLEL?jscv.ENFORCE_PARALLEL:jscv.ENFORCE_SEQUENTIAL),e==jscv.ENFORCE_PARALLEL?jscv.math.mulMatPar_(a,b,c):jscv.math.mulMatSeq_(a,b,c)},jscv.math.mulMatSeq_=function(a,b,c){for(var d=a.nRow,e=b.nCol,f=a.nCol,g=new jscv.coredt.Matrix(d,e,c),h=0,i=0;d>i;i++)for(var j=0;e>j;j++){for(var k=0,l=0;f>l;l++)k+=a.data[i*a.nCol+l]*b.data[l*b.nCol+j];g.data[h]=jscv.utility.clampValue(k,c),h++}return g},jscv.math.mulMatPar_=function(a,b,c){var d=600,e=a.nRow,f=b.nCol,g=a.nCol,h=[],i=!1;if(g>=d){for(var j=0;g>j;j++)h[j]=j;i=!0}var k=a.getNdView(),l=b.getNdView(),m=function(a,b,d){if(i)return h.reducePar(function(a,e){return jscv.utility.clampValue(k[b][a]*l[a][d]+k[b][e]*l[e][d],c)});for(var e=0,f=0;g>f;f++)e+=k[b][f]*l[f][d];return jscv.utility.clampValue(e,c)},n=new jscv.coredt.Matrix(e,f,c),o=n.getNdView(),p=o.mapPar(2,m);return new jscv.coredt.Matrix(e,f,c,TypedObject.storage(p).buffer)},jscv.math.forwardSubstitute=function(a,b,c){if(a.depth>1||b.depth>1)throw new Error("Inputs are matrices of arrays of numbers. Only matrices of numbers are supported in jscv.math.forwardSubstitute");if(a.nRow!=b.nRow)throw new Error("Input matrices have incompatible dimensions");void 0==c&&(c=jscv.DEFAULT_ZERO_THRESHOLD_FLOAT64),a.nRow;for(var d=a.nCol,e=b.nRow,f=b.nCol,g=new jscv.coredt.Matrix(d,f,jscv.float64),h=new jscv.coredt.Matrix(e,1,jscv.float64),i=new jscv.coredt.Matrix(d,1,jscv.float64),j=0;f>j;j++){for(var k=j,l=0;e>l;l++)h.data[l]=b.data[k],k+=f;if(i=jscv.math.forwardSubstituteVect(a,h,c),null==i)return null;k=j;for(var l=0;d>l;l++)g.data[k]=i.data[l],k+=g.nCol}return g},jscv.math.forwardSubstituteVect=function(a,b,c){if(a.depth>1||b.depth>1)throw new Error("Inputs are matrices of arrays of numbers. Only matrices of numbers are supported in jscv.math.forwardSubstituteVect");if(b.nCol>1)throw new Error("The right hand side must be a vector in jscv.math.forwardSubstituteVect");if(a.nRow!=b.nRow)throw new Error("Input matrix and vector have incompatible dimensions");void 0==c&&(c=jscv.DEFAULT_ZERO_THRESHOLD_FLOAT64);for(var d,e,f=new jscv.coredt.Matrix(a.nCol,1,jscv.float64,0),g=Math.min(a.nRow,a.nCol),h=a.nRow,i=a.nCol,j=0,k=0;g>k;k++){d=a.data[j+k],e=b.data[k];for(var l=j,m=0;k>m;m++)e-=a.data[l]*f.data[m],l++;if(jscv.utility.isZero(d,c)){if(!jscv.utility.isZero(e,c))return null;f.data[k]=0}else f.data[k]=e/d;j+=i}if(h>i)for(var j=g*i,k=g;h>k;k++){d=0;for(var n=j,m=0;i>m;m++)d+=a.data[n]*f.data[m],n++;if(!jscv.utility.isZero(d-b.data[k],c))return null;j+=i}return f},jscv.math.backSubstitute=function(a,b,c){if(a.depth>1||b.depth>1)throw new Error("Inputs are matrices of arrays of numbers. Only matrices of numbers are supported in jscv.math.backSubstitute");if(a.nRow!=b.nRow)throw new Error("Input matrices have incompatible dimensions");void 0==c&&(c=jscv.DEFAULT_ZERO_THRESHOLD_FLOAT64),a.nRow;for(var d=a.nCol,e=b.nRow,f=b.nCol,g=new jscv.coredt.Matrix(d,f,jscv.float64),h=new jscv.coredt.Matrix(e,1,jscv.float64),i=new jscv.coredt.Matrix(d,1,jscv.float64),j=0;f>j;j++){for(var k=j,l=0;e>l;l++)h.data[l]=b.data[k],k+=f;if(i=jscv.math.backSubstituteVect(a,h,c),null==i)return null;k=j;for(var l=0;d>l;l++)g.data[k]=i.data[l],k+=g.nCol}return g},jscv.math.backSubstituteVect=function(a,b,c){if(a.depth>1||b.depth>1)throw new Error("Inputs are matrices of arrays of numbers. Only matrices of numbers are supported in jscv.math.backSubstituteVect");if(1!=b.nCol)throw new Error("The right hand side must be a vector in jscv.math.backSubstituteVect");if(a.nRow!=b.nRow)throw new Error("Input matrix and vector have incompatible dimensions");void 0==c&&(c=jscv.DEFAULT_ZERO_THRESHOLD_FLOAT64);for(var d,e,f=new jscv.coredt.Matrix(a.nCol,1,jscv.float64,0),g=a.nRow,h=a.nCol,i=Math.min(h,g),j=(i-1)*h,k=i-1;k>=0;k--){d=a.data[j+k],e=b.data[k];for(var l=j+k+1,m=k+1;i>m;m++)e-=a.data[l]*f.data[m],l++;if(jscv.utility.isZero(d,c)){if(!jscv.utility.isZero(e,c))return null;f.data[k]=0}else f.data[k]=e/d;j-=h}if(g>h){var j=i*h;for(row=i;g>row;row++){d=0;var n=j;for(col=0;h>col;col++)d+=a.data[n]*f.data[col],n++;if(!jscv.utility.isZero(d-b.data[row]))return null;j+=h}}return f},jscv.math.linalgSolveLu=function(a,b,c){if(!(a.hasOwnProperty("upper")&&a.hasOwnProperty("lower")&&a.hasOwnProperty("rowPermu")))throw new Error("Invalid object for representing an LU decomposition");var d=a.upper,e=a.lower,f=a.rowPermu;if(d.depth>1||e.depth>1||b.depth>1)throw new Error("Inputs are matrices of arrays of numbers. Only matrices of numbers are supported in jscv.math.linalgSolveLu");if(e.nRow!=b.nRow||e.nCol!=d.nRow)throw new Error("Input matrices have incompatible dimensions");void 0==c&&(c=jscv.DEFAULT_ZERO_THRESHOLD_FLOAT64),b=jscv.math.permuteRowMat(b,f);var g=jscv.math.forwardSubstitute(e,b,c);if(null==g)return null;var h=jscv.math.backSubstitute(d,g);return h},jscv.math.linalgSolveGauss=function(a,b,c){if(a.depth>1||b.depth>1)throw new Error("Inputs are matrices of arrays of numbers. Only matrices of numbers are supported in jscv.math.linalgSolve");if(a.nRow!=b.nRow)throw new Error("Input matrices have incompatible dimensions");void 0==c&&(c=jscv.DEFAULT_ZERO_THRESHOLD_FLOAT64);var d=jscv.math.augmentMat(a,b,jscv.float64),e=a.nCol,f=b.nCol,g=a.nRow;return a=jscv.utility.getSubMat(d,[0,g-1,0,e-1]),b=jscv.utility.getSubMat(d,[0,g-1,e,e+f-1]),jscv.math.backSubstitute(a,b,c)},jscv.math.linalgSolve=function(a,b){var c=void 0,d=jscv.GENERAL_MAT,e=jscv.LU_METHOD,f=2;if(arguments.length>f&&"number"==typeof arguments[f]&&(c=arguments[f],f++),a.hasOwnProperty("lower")&&b.hasOwnProperty("upper")&&b.hasOwnProperty("rowPermu"))return jscv.math.linalgSolveLu(a,b,c);if(!(a instanceof jscv.coredt.Matrix))throw new Error("Invalid data type for left hand side matrix in jscv.math.linalgSolve");if(a.depth>1||b.depth>1)throw new Error("Inputs are matrices of arrays of numbers. Only matrices of numbers are supported in jscv.math.linalgSolve");if(a.nRow!=b.nRow)throw new Error("Input matrices have incompatible dimensions");if(arguments.length>f&&"string"==typeof arguments[f]&&(d=arguments[f],f++),arguments.length>f&&arguments instanceof Object&&(e=arguments[f]),d==jscv.LOWER_TRAPEZOIDAL_MAT)return jscv.math.forwardSubstitute(a,b,c);if(d==jscv.UPPER_TRAPEZOIDAL_MAT)return jscv.math.backSubstitute(a,b,c);if(d==jscv.POSITIVE_DEFINITE_MAT){var g=jscv.math.cholesky(a,c);if(null==g)throw new Error("Input left-hand side matrix does not have Cholesky decomposition");var h=jscv.math.createLuObjectFromCholeskyMat(g);return jscv.math.linalgSolveLu(h,b,c)}if(JSON.stringify(e)==JSON.stringify(jscv.GAUSS_METHOD))return jscv.math.linalgSolveGauss(a,b,c);var h=jscv.math.luDecomposeGauss(a,c);return jscv.math.linalgSolveLu(h,b,c)},jscv.math.utility={},jscv.math.createLuObjectFromCholeskyMat=function(a){var b={};b.lower=new jscv.coredt.Matrix(a),b.upper=jscv.math.transposeMat(b.lower);for(var c=[],d=a.nRow,e=0;d>e;e++)c[e]=e;return b.rowPermu=c,b},jscv.math.getSubMat=function(a){var b="Incorrect argument lists to jscv.math.getSubMat",c="Invalid top left and bottom right points of a sub-matrix";if(a.depth>1)throw new Error("Input is a matrix of arrays of numbers. Only matrices of numbers are supported in jscv.math.getSubMat");var d=1,e=void 0;arguments.length>d&&arguments[d]instanceof jscv.coredt.Type&&(e=arguments[d],d++),(void 0==e||jscv.SUPPORT_DATA_TYPE.indexOf(e)<0)&&(e=a.elementalType);var f=0,g=0,h=0,i=0;if(d>=arguments.length)throw new Error(b);if(void 0!==arguments[d].length){if("number"!=typeof arguments[d][0]||"number"!=typeof arguments[d][1]||"number"!=typeof arguments[d][2]||"number"!=typeof arguments[d][2])throw new Error(b);f=arguments[d][0],g=arguments[d][1],h=arguments[d][2],i=arguments[d][3]}else{if("number"!=typeof arguments[d])throw new Error(b);if(arguments.length-d<4)throw new Error(b);if("number"!=typeof arguments[d+1]||"number"!=typeof arguments[d+2]||"number"!=typeof arguments[d+3])throw new Error(b);f=arguments[d],g=arguments[d+1],h=arguments[d+2],i=arguments[d+3]}if(0>f||0>g||0>h||0>i||f>g||h>i||g>=a.nRow||i>=a.nCol)throw new Error(c);for(var j=g-f+1,k=i-h+1,l=new jscv.coredt.Matrix([j,k,a.depth],e),m=f*a.nCol+h,n=0,o=f;g>=o;o++){for(var p=m,q=h;i>=q;q++)l.data[n]=jscv.utility.clampValue(a.data[p],e),n++,p++;m+=a.nCol}return l},jscv.math.utility.findNumSwapToIdentity_=function(a){for(var b=a.length,c=0,d=0;b>c;){for(;a[c]!=c;){d++;var e=a[c];a[c]=a[e],a[e]=e}c++}return d},jscv.utility.copyMakeBorder=function(a,b,c,d){var e=0,f=0,g=0,h=0;b.length>0&&(e=b[0]),b.length>1&&(f=b[1]),b.length>2&&(g=b[2]),b.length>3&&(h=b[3]),(void 0==e||0>e)&&(e=0),(void 0==f||0>f)&&(f=0),(void 0==g||0>g)&&(g=0),(void 0==h||0>h)&&(h=0),b=[e,f,g,h];var i=a;a instanceof jscv.coredt.Image&&(i=a.data);var j=i.depth,k=new Array,l=new Array;if(void 0==c&&(c=jscv.BORDER_CONSTANT,d=0),void 0==d&&(d=0),"string"==typeof c)for(var m=0;j>m;m++)k.push(c);else k=c;if("number"==typeof d)for(var m=0;j>m;m++)l.push(d);else l=d;for(var m=0;j>m;m++)(m>=k.length||jscv.SUPPORT_BORDER_TYPE.indexOf(k[m])<0)&&(k[m]=jscv.BORDER_CONSTANT,l[m]=0);var n,o,p=i.nRow,q=i.nCol,r=p+e+f,s=q+g+h;a instanceof jscv.coredt.Image?(n=new jscv.coredt.Image(s,r,a.elementalType,a.colorMode),o=n.data):(n=new jscv.coredt.Matrix([r,s,j],a.elementalType),o=n);for(var t=r-f,u=s-h,v=e*o.stride[0],w=g*o.stride[1],x=0,y=e;t>y;y++){for(var z=v+w,A=g;u>A;A++){if(1==j)o.data[z]=i.data[x],x++;else for(var m=0;j>m;m++)o.data[z+m]=i.data[x],x++;z+=o.stride[1]}v+=o.stride[0]}if(1==j)jscv.utility.fillBorderMat(o,b,k[0],l[0]);else for(var m=0;j>m;m++)jscv.utility.fillBorderMat(o,m,b,k[m],l[m]);return n},jscv.utility.fillBorderMat=function(){var a=arguments[0],b=0,c=1;c<arguments.length&&"number"==typeof arguments[c]&&(b=arguments[c],c++,(0>b||b>=a.depth)&&(b=0));var d=0,e=0,f=0,g=0;c<arguments.length&&arguments[c]instanceof Array&&(arguments[c].length>0&&(d=arguments[c][0]),arguments[c].length>1&&(e=arguments[c][1]),arguments[c].length>2&&(f=arguments[c][2]),arguments[c].length>3&&(g=arguments[c][3]),c++,(void 0==d||0>d)&&(d=0),(void 0==e||0>e)&&(e=0),(void 0==f||0>f)&&(f=0),(void 0==g||0>g)&&(g=0));var h=void 0,i=void 0;c<arguments.length&&(h=arguments[c],c++),c<arguments.length&&h==jscv.BORDER_CONSTANT&&(i=arguments[c]),(void 0==h||jscv.SUPPORT_BORDER_TYPE.indexOf(h)<0)&&(h=jscv.BORDER_CONSTANT),h==jscv.BORDER_CONSTANT&&void 0==i&&(i=0),i=jscv.utility.clampValue(i,a.elementalType);var j=[d,e,f,g];if(h==jscv.BORDER_CONSTANT)return jscv.utility.fillBorderMatConstant_(a,b,j,i),void 0;if(h==jscv.BORDER_REPLICATE)return jscv.utility.fillBorderMatReplicate_(a,b,j),void 0;if(h==jscv.BORDER_WRAP)return jscv.utility.fillBorderMatWrap_(a,b,j),void 0;
if(h==jscv.BORDER_REFLECT||h==jscv.BORDER_REFLECT_101){var k=!1;return h==jscv.BORDER_REFLECT_101&&(k=!0),jscv.utility.fillBorderMatReflect_(a,b,j,k),void 0}},jscv.utility.fillBorderMatConstant_=function(a,b,c,d){var e=a.nRow,f=a.nCol,g=a.depth,h=c[0],i=c[1],j=c[2],k=c[3],l=0;g>1&&(l=b);for(var m=0;h>m;m++){for(var n=l,o=0;f>o;o++)a.data[n]=d,n+=a.stride[1];l+=a.stride[0]}l=0,g>1&&(l=b),l+=(e-i)*a.stride[0];for(var m=e-i;e>m;m++){for(var n=l,o=0;f>o;o++)a.data[n]=d,n+=a.stride[1];l+=a.stride[0]}var p=e-i;l=0,g>1&&(l=b),l+=h*a.stride[0];for(var m=h;p>m;m++){for(var n=l,o=0;j>o;o++)a.data[n]=d,n+=a.stride[1];l+=a.stride[0]}l=0,g>1&&(l=b),l+=h*a.stride[0]+(f-k)*a.stride[1];for(var m=h;p>m;m++){for(var n=l,o=f-k;f>o;o++)a.data[n]=d,n+=a.stride[1];l+=a.stride[0]}},jscv.utility.fillBorderMatReplicate_=function(a,b,c){for(var d=a.nRow,e=a.nCol,f=a.depth,g=c[0],h=c[1],i=c[2],j=c[3],k=0;d>k;k++)for(var l=0;i>l;l++)g>k?1==f?a.set(a.get(g,i),k,l):a.set(a.get(g,i,b),k,l,b):k>=d-h?1==f?a.set(a.get(d-h-1,i),k,l):a.set(a.get(d-h-1,i,b),k,l,b):1==f?a.set(a.get(k,i),k,l):a.set(a.get(k,i,b),k,l,b);for(var m=e-j-1,k=0;d>k;k++)for(var l=e-j;e>l;l++)g>k?1==f?a.set(a.get(g,m),k,l):a.set(a.get(g,m,b),k,l,b):k>=d-h?1==f?a.set(a.get(d-h-1,m),k,l):a.set(a.get(d-h-1,m,b),k,l,b):1==f?a.set(a.get(k,m),k,l):a.set(a.get(k,m,b),k,l,b);for(var k=0;g>k;k++)for(var l=i;m>=l;l++)1==f?a.set(a.get(g,l),k,l):a.set(a.get(g,l,b),k,l,b);for(var n=d-h-1,k=d-h;d>k;k++)for(var l=i;m>=l;l++)1==f?a.set(a.get(n,l),k,l):a.set(a.get(n,l,b),k,l,b)},jscv.utility.fillBorderMatWrap_=function(a,b,c){for(var d=a.nRow,e=a.nCol,f=a.depth,g=c[0],h=c[1],i=c[2],j=c[3],k=d-h,l=e-j,m=g;k>m;m++)for(var n=l-1,o=i-1;o>=0;o--,n--)1==f?a.set(a.get(m,n),m,o):a.set(a.get(m,n,b),m,o,b);for(var m=g;k>m;m++)for(var n=i,o=l;e>o;o++,n++)1==f?a.set(a.get(m,n),m,o):a.set(a.get(m,n,b),m,o,b);for(var p=k-1,m=g-1;m>=0;m--,p--)for(var o=0;e>o;o++)1==f?a.set(a.get(p,o),m,o):a.set(a.get(p,o,b),m,o,b);p=g;for(var m=k;d>m;m++,p++)for(var o=0;e>o;o++)1==f?a.set(a.get(p,o),m,o):a.set(a.get(p,o,b),m,o,b)},jscv.utility.fillBorderMatReflect_=function(a,b,c,d){for(var e=a.nRow,f=a.nCol,g=a.depth,h=c[0],i=c[1],j=c[2],k=c[3],l=f-k,m=e-i,n=h;m>n;n++){var o=j;d&&l>j+1&&(o=j+1);for(var p=j-1;p>=0;p--,o++)o>=l&&(o=d?p+2:p+1),1==g?a.set(a.get(n,o),n,p):a.set(a.get(n,o,b),n,p,b)}for(var n=h;m>n;n++){var q=l-1;d&&l-2>=j&&(q=l-2);for(var r=l;f>r;r++,q--)j>q&&(q=d?r-2:r-1),1==g?a.set(a.get(n,q),n,r):a.set(a.get(n,q,b),n,r,b)}var s=h;d&&m>h+1&&(s=h+1);for(var t=h-1;t>=0;t--,s++)for(s>=m&&(s=d?t+2:t+1),w=0;f>w;w++)1==g?a.set(a.get(s,w),t,w):a.set(a.get(s,w,b),t,w,b);var u=m-1;d&&m-2>=h&&(u=m-2);for(var v=m;e>v;v++,u--){h>u&&(u=d?v-2:v-1);for(var w=0;f>w;w++)1==g?a.set(a.get(u,w),v,w):a.set(a.get(u,w,b),v,w,b)}},jscv.utility.drawPoint=function(){var a,b,c=1,d="#000000";if(arguments.length<2)throw new Error("drawPoint requires at least two arguments");if(arguments.length>4)throw new Error("Too many arguments to drawPoint");a=arguments[0],b=arguments[1],3==arguments.length?d=arguments[2]:4==arguments.length&&(d=arguments[2],c=arguments[3]);var e=b.context;e.beginPath(),e.arc(a.x,a.y,c,0,2*Math.PI),e.fillStyle=d,e.lineWidth=1,e.fill(),e.closePath()},jscv.utility.drawPoints=function(){var a,b,c,d;if(arguments.length<2)throw new Error("drawPoints requires at least two arguments");if(arguments.length>4)throw new Error("Too many arguments to drawPoints");a=arguments[0],b=arguments[1],3==arguments.length?c=arguments[2]:4==arguments.length&&(c=arguments[2],d=arguments[3]);for(var e=b.context,f=0;f<a.length;f++){var g=a[f];e.beginPath();var h=1;void 0!=d&&1==d.length?h=d[0]:void 0!=d&&d.length>1&&(h=d[f]),e.arc(g.x,g.y,h,0,2*Math.PI),e.fillStyle=void 0!=c&&1==c.length?c[0]:void 0==c?"#000000":c[f],e.fill(),e.closePath()}},jscv.utility.drawCircle=function(){var a,b,c=1,d="#000000";if(arguments.length<2)throw new Error("drawCircle requires at least two arguments");if(arguments.length>4)throw new Error("Too many arguments to drawCircle");a=arguments[0],b=arguments[1],3==arguments.length?d=arguments[2]:4==arguments.length&&(d=arguments[2],c=arguments[3]);var e=b.context;e.beginPath(),e.arc(a.center.x,a.center.y,a.radius,0,2*Math.PI),e.strokeStyle=d,e.lineWidth=c,e.stroke(),e.closePath()},jscv.utility.drawCircles=function(){var a,b,c,d;if(arguments.length<2)throw new Error("drawCircles requires at least two arguments");if(arguments.length>4)throw new Error("Too many arguments to drawCircles");a=arguments[0],b=arguments[1],3==arguments.length?c=arguments[2]:4==arguments.length&&(c=arguments[2],d=arguments[3]);for(var e=b.context,f=0;f<a.length;f++){e.beginPath();var g=a[f];e.arc(g.center.x,g.center.y,g.radius,0,2*Math.PI),e.strokeStyle=void 0!=c&&1==c.length?c[0]:void 0==c?"#000000":c[f],e.lineWidth=1,void 0!=d&&1==d.length?e.lineWidth=wdithList[0]:void 0!=d&&d.length>1&&(e.lineWidth=d[f]),e.stroke(),e.closePath()}},jscv.utility.drawLine=function(){var a,b,c=1,d="#000000";if(arguments.length<2)throw new Error("drawLine requires at least two arguments");if(arguments.length>4)throw new Error("Too many arguments to drawLine");a=arguments[0],b=arguments[1],3==arguments.length?d=arguments[2]:4==arguments.length&&(d=arguments[2],c=arguments[3]);var e=b.context;e.beginPath(),e.moveTo(a.startPoint.x,a.startPoint.y),e.lineTo(a.endPoint.x,a.endPoint.y),e.lineWidth=c,e.strokeStyle=d,e.stroke(),e.closePath()},jscv.utility.drawLines=function(){var a,b,c,d;if(arguments.length<2)throw new Error("drawCircles requires at least two arguments");if(arguments.length>4)throw new Error("Too many arguments to drawLines");a=arguments[0],b=arguments[1],3==arguments.length?c=arguments[2]:4==arguments.length&&(c=arguments[2],d=arguments[3]);for(var e=b.context,f=0;f<a.length;f++){var g=a[f];e.beginPath(),e.moveTo(g.startPoint.x,g.startPoint.y),e.lineTo(g.endPoint.x,g.endPoint.y),e.strokeStyle=void 0!=c&&1==c.length?c[0]:void 0==c?"#000000":c[f],e.lineWidth=1,void 0!=d&&1==d.length?e.lineWidth=wdithList[0]:void 0!=d&&d.length>1&&(e.lineWidth=d[f]),e.stroke(),e.closePath()}},jscv.utility.drawContour=function(){var a,b,c,d=1,e="#000000";if(arguments.length<2)throw new Error("drawContour requires at least two arguments");if(arguments.length>4)throw new Error("Too many arguments to drawContour");if(a=arguments[0]instanceof jscv.coredt.ContourNode?arguments[0].contour:arguments[0],b=arguments[1],3==arguments.length?e=arguments[2]:4==arguments.length&&(e=arguments[2],d=arguments[3]),a.approxMethod==jscv.CHAIN_APPROX_SIMPLE)c=a.seqData;else{var f=jscv.cv.convertContourApprox(a,jscv.CHAIN_APPROX_SIMPLE);c=f.seqData}var g=b.context;g.beginPath(),g.moveTo(a.origin.x,a.origin.y);for(var h=1;h<c.length;h++){var i=c[h];g.lineTo(i.x,i.y)}g.lineWidth=d,g.strokeStyle=e,g.stroke(),g.closePath()},jscv.utility.drawContours=function(){var a,b,c,d,e;if(arguments.length<2)throw new Error("drawContours requires at least two arguments");if(arguments.length>4)throw new Error("Too many arguments to drawContours");a=arguments[0][0]instanceof jscv.coredt.ContourNode?arguments[0].map(function(a){return a.contour}):arguments[0],b=arguments[1],3==arguments.length?d=arguments[2]:4==arguments.length&&(d=arguments[2],e=arguments[3]);for(var f=0;f<a.length;f++){var c,g=a[f];if(g.approxMethod==jscv.CHAIN_APPROX_SIMPLE)c=g.seqData;else{var h=jscv.cv.convertContourApprox(g,jscv.CHAIN_APPROX_SIMPLE);c=h.seqData}var i=b.context;i.beginPath(),i.moveTo(g.origin.x,g.origin.y);for(var j=0;j<c.length;j++){var k=c[j];i.lineTo(k.x,k.y)}i.strokeStyle=void 0!=d&&1==d.length?d[0]:void 0==d?"#000000":d[f],i.lineWidth=1,void 0!=e&&1==e.length?i.lineWidth=wdithList[0]:void 0!=e&&e.length>1&&(i.lineWidth=e[f]),i.stroke(),i.closePath()}},jscv.utility.findMinSuperType=function(a,b){if(!(jscv.SUPPORT_DATA_TYPE.indexOf(a)>=0&&jscv.SUPPORT_DATA_TYPE.indexOf(b)>=0))throw new TypeError("Not supported types");if(a==b)return a;var c=a.byteLength,d=b.byteLength;if(a==jscv.uint8Clamped&&b==jscv.uint8||a==jscv.uint8&&b==jscv.uint8Clamped)return jscv.uint8Clamped;if(a.isFloat&&b.isFloat||a.isSignedInt&&b.isSignedInt||a.isUnsignedInt&&b.isUnsignedInt)return c>d?a:b;if(a.isFloat||b.isFloat){var e=a,f=b;b.isFloat&&(e=b,f=a);for(var g=f.byteLength,h=jscv.FLOAT_TYPE.indexOf(e);h<jscv.FLOAT_TYPE.length-1&&jscv.FLOAT_TYPE[h].byteLength<g;)h++;return jscv.FLOAT_TYPE[h]}var i=a,f=b;b.isSignedInt&&(i=b,f=a);for(var h=jscv.SIGNED_INT_TYPE.indexOf(i),j=f.byteLength;h<jscv.SIGNED_INT_TYPE.length-1&&jscv.SIGNED_INT_TYPE[h].byteLength<=j;)h++;return jscv.SIGNED_INT_TYPE[h]},jscv.utility.clampValue=function(a,b){if(b.isFloat)return a;if(a=Math.floor(a),b.isUnsignedInt&&0>=a)return 0;b.byteLength<<3;var c=jscv.utility.getMaxIntVal(b),d=jscv.utility.getMinIntVal(b);return a>c?c:d>a?d:a},jscv.utility.isZero=function(a,b){return void 0==b&&(b=jscv.DEFAULT_ZERO_THRESHOLD_FLOAT64),Math.abs(a)>b?!1:!0},jscv.utility.getMaxIntVal=function(a){var b=a.byteLength<<3;return a.isUnsignedInt?16>=b?(1<<b)-1:Math.pow(2,b)-1:16>=b?(1<<b-1)-1:Math.pow(2,b-1)-1},jscv.utility.getMinIntVal=function(a){if(a.isUnsignedInt)return 0;var b=a.byteLength<<3;return 16>=b?-(1<<b-1):-Math.pow(2,b-1)},jscv.utility.getJsArrayType=function(a){return a==jscv.uint8Clamped?Uint8ClampedArray:a==jscv.uint8?Uint8Array:a==jscv.uint16?Uint16Array:a==jscv.uint32?Uint32Array:a==jscv.int8?Int8Array:a==jscv.int16?Int16Array:a==jscv.int32?Int32Array:a==jscv.float32?Float32Array:Float64Array},jscv.utility.getTypedObjectArrayType=function(a){return a==jscv.uint8Clamped?TypedObject.uint8Clamped:a==jscv.uint8?TypedObject.uint8:a==jscv.uint16?TypedObject.uint16:a==jscv.uint32?TypedObject.uint32:a==jscv.int8?TypedObject.int8:a==jscv.int16?TypedObject.int16:a==jscv.int32?TypedObject.int32:a==jscv.float32?TypedObject.float32:TypedObject.float64},jscv.utility.writeToCanvasData=function(a,b){a.colorMode!=jscv.COLOR_RGBA&&(a=jscv.imgproc.convertColor(a,jscv.COLOR_RGBA));var c=a.data.data,d=c.length;if(d!=c.length)throw new Error("The size of canvas data is different from the size of the jscv.coredt.Image object.");for(var e=0;d>e;e++)b[e]=c[e]},jscv.utility.loadLocalImage=function(a,b){var c=this,d=document.createElement("img");d.src=a,d.onload=function(){var a=document.createElement("canvas"),e=a.getContext("2d");e.drawImage(d,0,0),c[b]=new jscv.coredt.Image(a.width,a.height,e.getImageData(0,0,a.width,a.height).data.buffer)}},jscv.utility.copyMatData=function(a,b){for(var c=a.nRow,d=a.nCol,e=a.depth,f=0,g=0;c>g;g++)for(var h=0;d>h;h++)if(1==e)a.data[f]=jscv.utility.clampValue(b[g][h],a.elementalType),f++;else for(var i=0;e>i;i++)a.data[f]=jscv.utility.clampValue(b[g][h][i],a.elementalType),f++},jscv.utility.fillMat=function(a,b){a.nRow,a.nCol;var c=a.depth;if(b.hasOwnProperty("length")&&(1==b.length&&(b=b[0]),b.hasOwnProperty("length")&&b.length!=c))throw new Error("Array length does not match matrix depth");if("number"==typeof b)b=jscv.utility.clampValue(b,a.elementalType);else if(b.hasOwnProperty("length"))for(var d=0;d<b.length;d++)b[d]=jscv.utility.clampValue(b[d],a.elementalType);if(c>1&&"number"==typeof b){for(var e=new Array,f=0;c>f;f++)e[f]=b;b=e}for(var g=a.data,h=g.length,i=0;h>i;)if(1==c)g[i]=b,i++;else for(var j=0;c>j;j++)g[i]=b[j],i++},jscv.utility.createMat=function(a,b,c){var d=new jscv.coredt.Matrix(a,b);return jscv.utility.fillMat(d,c),d},jscv.utility.equalPoints=function(a,b){var c=1e-10;return Math.abs(a.x-b.x)>c||Math.abs(a.y-b.y)>c?!1:!0},jscv.utility.findPointInd=function(a,b){for(var c=0;c<a.length;c++)if(jscv.utility.equalPoints(a[c],b))return c;return-1},jscv.utility.findArrDirection=function(a,b,c){var d=0;return b>a&&(d+=1),c>b&&(d+=1),a>c&&(d+=1),2==d?1:-1},jscv.utility.convertMatType=function(a,b){if(jscv.SUPPORT_DATA_TYPE.indexOf(b)<0&&(b=a.elementalType),a.elementalType==b)return new jscv.coredt.Matrix(a);var c=new jscv.coredt.Matrix(a.shape,b),d=c.data;a.data;for(var e=0;e<d.length;e++)d[e]=jscv.utility.clampValue(a.data[e],b);return c},jscv.utility.webCamSuccess=function(a){return successCallback=function(b){navigator.mozGetUserMedia?a.video.mozSrcObject=b:a.video.src=window.webkitURL?window.webkitURL.createObjectURL(b):b,a.video.play()}},jscv.utility.webCamError=function(a){alert("Error accessing webcam!",a)},jscv.utility.Media=function(){function a(){if(!(arguments.length>0))throw new Error("Media requires at least 1 argument");return this.canvas=arguments[0],this.context=this.canvas.getContext("2d"),arguments.length>1&&(this.video=arguments[1]),this}return a}(),jscv.utility.initWebcam=function(a){navigator.getUserMedia=navigator.getUserMedia||navigator.webkitGetUserMedia||navigator.mozGetUserMedia,navigator.getUserMedia&&navigator.getUserMedia({video:!0},jscv.utility.webCamSuccess(a),jscv.utility.webCamError)},jscv.utility.getWebcamInputRaw=function(a){return webCamVideo=a.video,a.context.drawImage(webCamVideo,0,0,webCamVideo.videoWidth,webCamVideo.videoHeight,0,0,a.canvas.width,a.canvas.height),a.context.getImageData(0,0,a.canvas.width,a.canvas.height)},jscv.utility.getWebcamInput=function(a){var b=jscv.utility.getWebcamInputRaw(a),c=b.width,d=b.height,e=new jscv.coredt.Image(c,d,jscv.uint8Clamped,b.data.buffer);return e},jscv.utility.drawToCanvasRaw=function(a,b){b.context.putImageData(a,0,0)},jscv.utility.drawToCanvas=function(a,b){var c=b.context.createImageData(b.canvas.width,b.canvas.height);jscv.utility.writeToCanvasData(a,c.data),jscv.utility.drawToCanvasRaw(c,b)};